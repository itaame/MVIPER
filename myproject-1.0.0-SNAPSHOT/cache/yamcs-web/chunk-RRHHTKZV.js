import{a as we,c as Ie,d as zt,e as Xt}from"./chunk-J6RUEXVW.js";import{$c as yt,$e as xe,Aa as a,Ab as dt,Ac as N,Af as Y,Ba as s,Bc as L,Be as se,Bf as kt,Ca as D,Cc as le,Da as w,Dc as Ct,E as Xe,Ea as Q,Eb as ut,Ec as C,Ef as Vt,Fa as P,Fb as vt,Fc as te,Ga as f,Gb as _e,Gc as A,Gf as Yt,H as Qe,Ha as d,Hb as he,He as Et,I as ge,Ia as at,Ib as ft,Ie as xt,Ja as rt,Jc as _t,Kc as k,Ke as bt,Le as Mt,Lf as y,Lg as Ht,N as E,Nc as V,Ne as Ot,Nf as ce,O as x,P as Ze,Pa as lt,Qa as st,Qf as qt,Ra as b,Rf as $t,Sa as r,Ta as oe,Tf as X,Ua as $,Uf as q,V as G,We as Ee,Xc as ht,Xe as Tt,Ya as R,Ye as Dt,Za as Be,Zf as me,_c as ye,_e as wt,a as je,ab as ct,b as Ge,ba as c,bb as _,bf as be,cb as h,cf as It,cg as Te,da as v,eb as mt,ef as Pt,f as I,fa as et,ff as Me,ga as S,he as ve,hf as Oe,id as St,if as Ft,ih as M,kg as jt,lg as Z,ma as u,mf as Rt,mg as Gt,mh as Ut,nb as Ce,nf as Nt,ng as Qt,of as Lt,oh as O,pb as pt,pf as K,ph as De,qa as m,qb as ae,qc as gt,qf as At,qg as Bt,qh as Jt,rh as Kt,sa as tt,te as B,ue as W,va as g,ve as Se,wa as it,wc as re,we as H,xa as nt,xe as U,xg as Wt,ya as ot,yc as T,ye as z,za as o,ze as J}from"./chunk-MTJQDUEX.js";var Ue=(i,t)=>ge(We).canActivate(i,t);var We=class i{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().hasSystemPrivilege("ReadEvents")?!0:(this.router.navigate(["/403"],{queryParams:{page:e.url}}),!1)}canActivateChild(t,e){return this.canActivate(t,e)}static{this.\u0275fac=function(e){return new(e||i)(Qe(De),Qe(_e))}}static{this.\u0275prov=Xe({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Pe=class i{constructor(t,e,n,l){this.dialogRef=t;this.yamcs=n;this.data=l;this.severityOptions=[{id:"INFO",label:"INFO"},{id:"WATCH",label:"WATCH"},{id:"WARNING",label:"WARNING"},{id:"DISTRESS",label:"DISTRESS"},{id:"CRITICAL",label:"CRITICAL"},{id:"SEVERE",label:"SEVERE"}];this.form=e.group({message:["",T.required],severity:"INFO",time:[y.toISOString(n.getMissionTime()),T.required]})}save(){this.yamcs.yamcsClient.createEvent(this.yamcs.instance,{message:this.form.value.message,severity:this.form.value.severity,time:y.toISOString(this.form.value.time)}).then(t=>this.dialogRef.close(t))}static{this.\u0275fac=function(e){return new(e||i)(v(B),v(ht),v(M),v(W))}}static{this.\u0275cmp=S({type:i,selectors:[["app-create-event-dialog"]],decls:21,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","message","rows","3"],["formControlName","severity",3,"options"],["formControlName","time","step","1",3,"showNow"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Create event"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"label"),r(5," Message "),s(6,"textarea",2),a(),s(7,"br"),o(8,"label"),r(9," Severity "),s(10,"br")(11,"ya-select",3),a(),s(12,"br"),o(13,"label"),r(14," Event time "),s(15,"ya-date-time-input",4),a()()(),o(16,"mat-dialog-actions",5)(17,"ya-button",6),r(18,"CANCEL"),a(),o(19,"ya-button",7),f("click",function(){return n.save()}),r(20,"SAVE"),a()()),e&2&&(c(3),m("formGroup",n.form),c(8),m("options",n.severityOptions),c(4),m("showNow",!0),c(4),m("disabled",!n.form.valid))},dependencies:[O,A,re,N,L,k,V,H,U,J,z,Y,ce,q],encapsulation:2,changeDetection:0})}};var Zt="INFO",ei=[],Re=class i{constructor(t,e,n,l){this.dialogRef=t;this.yamcs=e;this.messageService=n;this.data=l;this.form=new le({name:new C("",T.required),filter:new C(""),severity:new C(Zt,T.required),source:new C(ei),shared:new C(!1,T.required)});this.form.patchValue({filter:l.filter||void 0,severity:l.severity,source:l.source})}save(){let{value:t}=this.form;this.yamcs.yamcsClient.createQuery(this.yamcs.instance,"events",{name:t.name,shared:t.shared??!1,query:{filter:t.filter??void 0,source:t.source??ei,severity:t.severity??Zt}}).then(e=>this.dialogRef.close(e)).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||i)(v(B),v(M),v(K),v(W))}}static{this.\u0275cmp=S({type:i,selectors:[["app-create-event-query-dialog"]],decls:37,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","name","type","text"],[1,"half-break"],["formControlName","filter"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","shared"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Save query"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"div",2),r(5," Name "),s(6,"input",3),a(),s(7,"hr",4),o(8,"div",2),r(9," Query "),s(10,"ya-filter-textarea",5),a(),s(11,"hr",4),o(12,"label"),r(13," Severity "),s(14,"br"),o(15,"ya-select",6),s(16,"ya-option",7)(17,"ya-option",8)(18,"ya-option",9)(19,"ya-option",10)(20,"ya-option",11)(21,"ya-option",12),a()(),s(22,"hr",4),o(23,"label"),r(24," Source "),s(25,"br")(26,"ya-multi-select",13),a(),s(27,"hr",4),o(28,"div",2),r(29," Share with other users "),s(30,"br")(31,"mat-slide-toggle",14),a()()(),o(32,"mat-dialog-actions",15)(33,"ya-button",16),r(34,"CANCEL"),a(),o(35,"ya-button",17),f("click",function(){return n.save()}),r(36,"SAVE"),a()()),e&2&&(c(3),m("formGroup",n.form),c(23),m("options",n.data.sourceOptions),c(9),m("disabled",!n.form.valid))},dependencies:[O,A,re,N,L,k,V,H,U,J,z,se,Y,me,Z,X,q],encapsulation:2,changeDetection:0})}};function ui(i,t){i&1&&r(0,` -
`)}function vi(i,t){if(i&1&&s(0,"ya-highlight",0),i&2){let e=d();m("text",e.summary)("term",e.highlight)}}function fi(i,t){if(i&1&&s(0,"br")(1,"ya-highlight",0),i&2){let e=d(2);c(),m("text",e.detail)("term",e.highlight)}}function gi(i,t){if(i&1){let e=P();o(0,"ya-icon-action",1),f("click",function(){E(e);let l=d();return x(l.toggleExpanded())}),a(),u(1,fi,2,2),_(2,"async")}if(i&2){let e=d();c(),g(h(2,1,e.expanded$)?1:-1)}}var Ne=class i{constructor(){this.expanded$=new I(!1)}ngOnInit(){if(this.message!==null&&this.message!==void 0){let t=this.message.indexOf(`
`);t===-1?this.summary=this.message:(this.summary=this.message.substring(0,t),t+1<this.message.length&&(this.detail=this.message.substring(t+1)))}}toggleExpanded(){this.expanded$.next(!this.expanded$.value)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=S({type:i,selectors:[["app-event-message"]],inputs:{message:"message",highlight:"highlight"},decls:3,vars:3,consts:[[3,"text","term"],["icon","more_horiz",3,"click"]],template:function(e,n){e&1&&u(0,ui,1,0)(1,vi,1,2,"ya-highlight",0)(2,gi,3,3),e&2&&(g(n.summary===null||n.summary===void 0?0:-1),c(),g(n.summary!==null&&n.summary!==void 0?1:-1),c(),g(n.detail?2:-1))},dependencies:[O,ae,Te,kt],encapsulation:2,changeDetection:0})}};var Ci=()=>({level:"info",tooltip:"Info"}),_i=()=>({level:"watch",tooltip:"Watch"}),hi=()=>({level:"warning",tooltip:"Warning"}),yi=()=>({level:"distress",tooltip:"Distress"}),Si=()=>({level:"critical",tooltip:"Critical"}),Ei=()=>({level:"severe",tooltip:"Severe"}),xi=()=>({level:"severe",tooltip:"Error"});function bi(i,t){i&1&&Q(0)}function Mi(i,t){if(i&1&&u(0,bi,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,Ci))}}function Oi(i,t){i&1&&Q(0)}function Ti(i,t){if(i&1&&u(0,Oi,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,_i))}}function Di(i,t){i&1&&Q(0)}function wi(i,t){if(i&1&&u(0,Di,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,hi))}}function Ii(i,t){i&1&&Q(0)}function Pi(i,t){if(i&1&&u(0,Ii,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,yi))}}function Fi(i,t){i&1&&Q(0)}function Ri(i,t){if(i&1&&u(0,Fi,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,Si))}}function Ni(i,t){i&1&&Q(0)}function Li(i,t){if(i&1&&u(0,Ni,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,Ei))}}function Ai(i,t){i&1&&Q(0)}function ki(i,t){if(i&1&&u(0,Ai,1,0,"ng-container",1),i&2){d();let e=b(8);m("ngTemplateOutlet",e)("ngTemplateOutletContext",R(2,xi))}}function Vi(i,t){if(i&1&&(Ze(),o(0,"svg",2),s(1,"rect",3)(2,"rect",4)(3,"rect",5)(4,"rect",6)(5,"rect",7),a()),i&2){let e=t.level,n=t.tooltip,l=d();tt("grayscale",l.grayscale),m("ngClass",e)("matTooltip",n)}}var Le=class i{constructor(){this.grayscale=!1}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=S({type:i,selectors:[["app-event-severity"]],inputs:{severity:"severity",grayscale:"grayscale"},decls:9,vars:1,consts:[["img",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["width","29","height","5","viewBox","0 0 58 10",3,"ngClass","matTooltip"],["x","0","width","10","height","10",1,"r1"],["x","12","width","10","height","10",1,"r2"],["x","24","width","10","height","10",1,"r3"],["x","36","width","10","height","10",1,"r4"],["x","48","width","10","height","10",1,"r5"]],template:function(e,n){if(e&1&&u(0,Mi,1,3,"ng-container")(1,Ti,1,3,"ng-container")(2,wi,1,3,"ng-container")(3,Pi,1,3,"ng-container")(4,Ri,1,3,"ng-container")(5,Li,1,3,"ng-container")(6,ki,1,3,"ng-container")(7,Vi,6,4,"ng-template",null,0,mt),e&2){let l;g((l=n.severity)==="INFO"?0:l==="WATCH"?1:l==="WARNING"?2:l==="DISTRESS"?3:l==="CRITICAL"?4:l==="SEVERE"?5:l==="ERROR"?6:-1)}},dependencies:[ye,Ce,pt],styles:["svg[_ngcontent-%COMP%]{display:inline-block}.info[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.watch[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%]{fill:#ff8c00}.watch.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%]{fill:#a0a0a0}.watch[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.warning[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%]{fill:#ff8c00}.warning.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .warning.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%]{fill:#a0a0a0}.warning[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.distress[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%]{fill:red}.distress.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .distress.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .distress.grayscale[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%]{fill:#a0a0a0}.distress[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.critical[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%]{fill:red}.critical.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .critical.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .critical.grayscale[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .critical.grayscale[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%]{fill:#a0a0a0}.critical[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#ccc}.severe[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:red}.severe.grayscale[_ngcontent-%COMP%]   .r1[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r2[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r3[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r4[_ngcontent-%COMP%], .severe.grayscale[_ngcontent-%COMP%]   .r5[_ngcontent-%COMP%]{fill:#a0a0a0}@media print{svg[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}"],changeDetection:0})}};var Yi=["*"],qi=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),ni=i=>({c:i}),pe=class i{constructor(t){this.yamcs=t}static{this.\u0275fac=function(e){return new(e||i)(v(M))}}static{this.\u0275cmp=S({type:i,selectors:[["app-events-page-tabs"]],ngContentSelectors:Yi,decls:13,vars:12,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/events","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/events/queries","routerLinkActive","",3,"active","queryParams"],[2,"flex","1 1 auto"],[1,"actions"]],template:function(e,n){if(e&1&&(at(),o(0,"nav",3)(1,"a",4,0),r(3," Query "),a(),o(4,"a",5,1),r(6," Saved queries "),a(),s(7,"div",6),o(8,"div",7),rt(9),a()(),o(10,"mat-tab-nav-panel",null,2),s(12,"router-outlet"),a()),e&2){let l=b(2),p=b(5),Je=b(11);m("mat-stretch-tabs",!1)("tabPanel",Je),c(),m("routerLinkActiveOptions",R(7,qi))("active",l.isActive)("queryParams",Be(8,ni,n.yamcs.context)),c(3),m("active",p.isActive)("queryParams",Be(10,ni,n.yamcs.context))}},dependencies:[O,vt,he,ft,Rt,Lt,Nt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}.actions[_ngcontent-%COMP%]{display:flex;align-items:center}"],changeDetection:0})}};var Ae=class i{constructor(t,e,n){this.dialogRef=t;this.yamcs=e;this.data=n;this.downloadURL$=new I(null);this.form=new Ct({start:new te(null),stop:new te(null),severity:new te(null,T.required),filter:new te(null),source:new te([]),delimiter:new te(null,T.required)});this.form.setValue({start:n.start?y.toISOString(n.start):"",stop:n.stop?y.toISOString(n.stop):"",filter:n.filter||"",source:n.source,severity:n.severity,delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){let t={delimiter:this.form.value.delimiter,severity:this.form.value.severity};if(this.form.value.start&&(t.start=y.toISOString(this.form.value.start)),this.form.value.stop&&(t.stop=y.toISOString(this.form.value.stop)),this.form.value.filter&&(t.filter=this.form.value.filter),this.form.value.source.length){let n=this.form.value.source;t.source=n}let e=this.yamcs.yamcsClient.getEventsDownloadURL(this.yamcs.instance,t);this.downloadURL$.next(e)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(v(B),v(M),v(W))}}static{this.\u0275cmp=S({type:i,selectors:[["ng-component"]],decls:45,vars:6,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formGroup"],[1,"label"],["formControlName","start"],[1,"half-break"],["formControlName","stop"],["formControlName","filter"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","delimiter"],["id","COMMA","label","Comma"],["id","SEMICOLON","label","Semicolon"],["id","TAB","label","Tab"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","link","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Export events"),a(),o(2,"mat-dialog-content",1)(3,"form",2)(4,"div",3),r(5," Start "),s(6,"ya-date-time-input",4),a(),s(7,"hr",5),o(8,"div",3),r(9," Stop "),s(10,"ya-date-time-input",6),a(),s(11,"hr",5),o(12,"div",3),r(13," Query "),s(14,"ya-filter-textarea",7),a(),s(15,"hr",5),o(16,"div",3),r(17," Severity "),s(18,"br"),o(19,"ya-select",8),s(20,"ya-option",9)(21,"ya-option",10)(22,"ya-option",11)(23,"ya-option",12)(24,"ya-option",13)(25,"ya-option",14),a()(),s(26,"hr",5),o(27,"div",3),r(28," Source "),s(29,"br")(30,"ya-multi-select",15),a(),s(31,"hr",5),o(32,"div",3),r(33," CSV column delimiter "),s(34,"br"),o(35,"ya-select",16),s(36,"ya-option",17)(37,"ya-option",18)(38,"ya-option",19),a()()()(),o(39,"mat-dialog-actions",20)(40,"ya-button",21),r(41,"CANCEL"),a(),o(42,"ya-download-button",22),_(43,"async"),f("click",function(){return n.closeDialog()}),r(44," DOWNLOAD "),a()()),e&2&&(c(3),m("formGroup",n.form),c(27),m("options",n.data.sourceOptions),c(12),m("link",h(43,4,n.downloadURL$))("disabled",!n.form.valid))},dependencies:[O,ae,A,N,L,k,V,H,U,J,z,Y,ce,$t,me,Z,X,q],encapsulation:2})}};function de(i,t,e,n){let l=t.label+' = ""',p=ve(i.state,l,e,n);p.selection={anchor:e+l.length-1},i.dispatch(p)}function oi(i,t,e,n){i.dispatch(ve(i.state,t.label+" = ",e,n))}function ai(i,t,e,n){i.dispatch(ve(i.state,t.label+" = ",e,n))}function ze(i,t,e,n){i.dispatch(ve(i.state,t.label+" ",e,n))}var ri=[{label:"message",type:"method",info:"Filter on event message",apply:de},{label:"seqNumber",type:"method",info:"Filter on event sequence number",apply:ai},{label:"severity",type:"method",info:"Filter on event severity (info, watch, warning, distress, critical, severe)",apply:oi},{label:"source",type:"method",info:"Filter on event source",apply:de},{label:"type",type:"method",info:"Filter on event type",apply:de},{section:"Exclude events",label:"-message",type:"method",info:"Exclude events based on message",apply:de},{section:"Exclude events",label:"-seqNumber",type:"method",info:"Exclude events based on sequence number",apply:ai},{section:"Exclude events",label:"-severity",type:"method",info:"Exclude events based on severity (info, watch, warning, distress, critical, severe)",apply:oi},{section:"Exclude events",label:"-source",type:"method",info:"Exclude events based on source",apply:de},{section:"Exclude events",label:"-type",type:"method",info:"Exclude events based on type",apply:de},{section:"Logical operators",label:"AND",type:"constant",apply:ze},{section:"Logical operators",label:"OR",type:"constant",apply:ze},{section:"Logical operators",label:"NOT",type:"constant",apply:ze}];var ke=class{constructor(t){this.watermarkObserver=t;this.dirty=!1;this.archiveEvents=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(t){this.archiveEvents=this.archiveEvents.concat(t),this.dirty=!0}addRealtimeEvent(t){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveEvents=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let t=this.realtimeBuffer.filter(n=>n!==void 0);return this.archiveEvents.concat(t).sort((n,l)=>{let p=-n.generationTime.localeCompare(l.generationTime);return p===0&&(p=-n.source.localeCompare(l.source)),p!==0?p:l.seqNumber-n.seqNumber})}compact(t){let e=this.snapshot();e.length=Math.min(t,e.length),this.reset(),this.archiveEvents=e,this.dirty=!0}};var Ve=class extends gt{constructor(e,n){super();this.yamcs=e;this.pageSize=100;this.blockHasMore=!1;this.events$=new I([]);this.sources$=new I([]);this.loading$=new I(!1);this.streaming$=new I(!1);this.syncSubscription=n.sync(()=>{this.eventBuffer.dirty&&!this.loading$.getValue()&&(this.emitEvents(),this.eventBuffer.dirty=!1)}),this.eventBuffer=new ke(()=>{this.blockHasMore=!0,this.eventBuffer.compact(500)})}connect(){return this.events$}emitEvents(){this.events$.next(this.eventBuffer.snapshot())}loadEvents(e){return this.loading$.next(!0),this.streaming$.value&&this.realtimeSubscription.sendMessage({instance:this.yamcs.instance,filter:e.filter}),Promise.all([this.yamcs.yamcsClient.getEventSources(this.yamcs.instance),this.loadPage(Ge(je({},e),{limit:this.pageSize+1}))]).then(n=>{let l=n[0],p=n[1];return this.eventBuffer.reset(),this.blockHasMore=!1,this.eventBuffer.addArchiveData(p),this.sources$.next(l),this.emitEvents(),p}).catch(n=>{throw this.eventBuffer.reset(),n}).finally(()=>{this.loading$.next(!1)})}hasMore(){return this.offscreenRecord!=null&&!this.blockHasMore}loadPage(e){return this.options=e,this.yamcs.yamcsClient.getEvents(this.yamcs.instance,e).then(n=>(n.length>this.pageSize?(n.splice(n.length-1,1),this.offscreenRecord=n[n.length-1]):this.offscreenRecord=null,n))}async loadMoreData(e){if(this.offscreenRecord)return this.loadPage(Ge(je({},e),{stop:this.offscreenRecord.generationTime,limit:this.pageSize+1})).then(n=>{this.eventBuffer.addArchiveData(n),this.emitEvents()})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createEventSubscription({instance:this.yamcs.instance,filter:this.options.filter},e=>{this.addEventSource(e),!this.loading$.getValue()&&this.matchesFilter(e)&&this.eventBuffer.addRealtimeEvent(e)})}addEventSource(e){if(e.source){for(let n of this.sources$.value)if(n===e.source)return;this.sources$.next([...this.sources$.value,e.source].sort((n,l)=>n.toLowerCase().localeCompare(l.toLocaleLowerCase())))}}matchesFilter(e){if(this.options){if(this.options.source&&e.source!==this.options.source)return!1;if(this.options.severity)switch(this.options.severity){case"SEVERE":case"ERROR":if(e.severity==="CRITICAL")return!1;case"CRITICAL":if(e.severity==="DISTRESS")return!1;case"DISTRESS":if(e.severity==="WARNING")return!1;case"WARNING":if(e.severity==="WATCH")return!1;case"WATCH":if(e.severity==="INFO")return!1}}return!0}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.events$.complete(),this.sources$.complete(),this.loading$.complete(),this.streaming$.complete()}};var ji=["searchFilter"];function Gi(i,t){if(i&1){let e=P();o(0,"ya-page-button",7),f("clicked",function(){E(e);let l=d();return x(l.createEvent())}),r(1," Create event "),a()}}function Qi(i,t){if(i&1){let e=P();o(0,"ya-page-button",8),f("clicked",function(){E(e);let l=d();return x(l.stopStreaming())}),r(1," Stop streaming "),a()}}function Bi(i,t){if(i&1){let e=P();o(0,"ya-page-button",9),f("clicked",function(){E(e);let l=d();return x(l.startStreaming())}),r(1," Start streaming "),a()}}function Wi(i,t){if(i&1){let e=P();s(0,"ya-date-time-input",51)(1,"ya-date-time-input",52),o(2,"ya-button",50),f("click",function(){E(e);let l=d(2);return x(l.applyCustomDates())}),r(3," Apply "),a()}if(i&2){let e=d(2);c(2),m("disabled",e.filterForm.invalid)}}function Hi(i,t){if(i&1){let e=P();o(0,"ya-button",53),f("click",function(){E(e);let l=d(2);return x(l.jumpToNow())}),r(1,"Jump to now"),a()}}function Ui(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"the last hour"),a(),r(4," ending at "),o(5,"b"),r(6),_(7,"datetime"),a(),r(8," (Mission Time) "),a()),i&2){let e=d(2);c(6),oe(h(7,1,e.validStop))}}function zi(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"the last 6 hours"),a(),r(4," ending at "),o(5,"b"),r(6),_(7,"datetime"),a(),r(8," (Mission Time) "),a()),i&2){let e=d(2);c(6),oe(h(7,1,e.validStop))}}function Ji(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"the last 24 hours"),a(),r(4," ending at "),o(5,"b"),r(6),_(7,"datetime"),a(),r(8," (Mission Time) "),a()),i&2){let e=d(2);c(6),oe(h(7,1,e.validStop))}}function Ki(i,t){i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"all time"),a()())}function Xi(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3),_(4,"datetime"),a(),r(5," to "),o(6,"b"),r(7),_(8,"datetime"),a(),r(9," (Mission Time) "),a()),i&2){let e=d(2);c(3),oe(h(4,2,e.validStart)),c(4),oe(h(8,4,e.validStop))}}function Zi(i,t){i&1&&s(0,"ya-dots")}function en(i,t){i&1&&(o(0,"div",32),r(1," Listening for events "),s(2,"ya-dots",54),a())}function tn(i,t){if(i&1){let e=P();r(0," \xA0 "),o(1,"a",55),f("click",function(l){return E(e),d(2),b(16).doSearch(),x(l.preventDefault())}),r(2," Apply filter "),a(),r(3," . ")}}function nn(i,t){if(i&1&&(o(0,"ya-table-top"),r(1," The search filter has changed. "),u(2,tn,4,0),_(3,"async"),a()),i&2){d();let e=b(16);c(2),g(h(3,1,e.errorState$)?-1:2)}}function on(i,t){i&1&&(o(0,"th",56),r(1,"Severity"),a())}function an(i,t){if(i&1&&(o(0,"td",57),s(1,"app-event-severity",58),a()),i&2){let e=t.$implicit;c(),m("severity",e.severity)}}function rn(i,t){i&1&&(o(0,"th",56),r(1,"Message"),a())}function ln(i,t){if(i&1&&(o(0,"td",59),s(1,"app-event-message",60),a()),i&2){let e=t.$implicit,n=d(2);c(),m("message",e.message)("highlight",n.filterForm.value.filter)}}function sn(i,t){i&1&&(o(0,"th",56),r(1,"Type"),a())}function cn(i,t){if(i&1&&s(0,"ya-highlight",61),i&2){let e=d().$implicit,n=d(2);m("text",e.type)("term",n.filterForm.value.filter)}}function mn(i,t){i&1&&r(0," - ")}function pn(i,t){if(i&1&&(o(0,"td",57),u(1,cn,1,2,"ya-highlight",61)(2,mn,1,0),a()),i&2){let e=t.$implicit;c(),g(e.type?1:2)}}function dn(i,t){i&1&&(o(0,"th",56),r(1,"Source"),a())}function un(i,t){if(i&1&&s(0,"ya-highlight",61),i&2){let e=d().$implicit,n=d(2);m("text",e.source)("term",n.filterForm.value.filter)}}function vn(i,t){i&1&&r(0," - ")}function fn(i,t){if(i&1&&(o(0,"td",57),u(1,un,1,2,"ya-highlight",61)(2,vn,1,0),a()),i&2){let e=t.$implicit;c(),g(e.source?1:2)}}function gn(i,t){i&1&&(o(0,"th",56),r(1,"Generation time"),a())}function Cn(i,t){if(i&1&&(o(0,"td",62),r(1),_(2,"datetime"),a()),i&2){let e=t.$implicit;c(),$(" ",h(2,1,e.generationTime)||"-"," ")}}function _n(i,t){i&1&&(o(0,"th",56),r(1,"Reception time"),a())}function hn(i,t){if(i&1&&(o(0,"td",62),r(1),_(2,"datetime"),a()),i&2){let e=t.$implicit;c(),$(" ",h(2,1,e.receptionTime)||"-"," ")}}function yn(i,t){i&1&&(o(0,"th",56),r(1,"Sequence number"),a())}function Sn(i,t){if(i&1&&(o(0,"td",57),r(1),a()),i&2){let e,n=t.$implicit;c(),$(" ",(e=n.seqNumber)!==null&&e!==void 0?e:"-"," ")}}function En(i,t){if(i&1&&(o(0,"th",56),r(1),a()),i&2){let e=d().$implicit;c(),$(" ",e.label," ")}}function xn(i,t){if(i&1&&r(0),i&2){let e,n=d().$implicit,l=d().$implicit;$(" ",(e=n.extra[l.id])!==null&&e!==void 0?e:"-"," ")}}function bn(i,t){i&1&&r(0," - ")}function Mn(i,t){if(i&1&&(o(0,"td",57),u(1,xn,1,1)(2,bn,1,0),a()),i&2){let e=t.$implicit;c(),g(e.extra?1:2)}}function On(i,t){if(i&1&&(D(0,47),u(1,En,2,1,"th",37)(2,Mn,3,1,"td",38),w()),i&2){let e=t.$implicit;m("cdkColumnDef",e.id)}}function Tn(i,t){i&1&&s(0,"tr",63)}function Dn(i,t){if(i&1&&s(0,"tr",64),i&2){let e=t.$implicit;m("ngClass",e.severity)}}function wn(i,t){if(i&1){let e=P();o(0,"div",6)(1,"app-events-page-tabs")(2,"ya-button",10),f("click",function(){E(e);let l=d();return x(l.clearQuery())}),r(3," Clear query "),a(),o(4,"ya-button",11),f("click",function(){E(e);let l=d();return x(l.openSaveQueryDialog())}),r(5," Save query "),a()(),o(6,"form",12)(7,"div",13)(8,"ya-select",14),s(9,"ya-option",15)(10,"ya-option",16)(11,"ya-option",17)(12,"ya-option",18)(13,"ya-option",19),a(),u(14,Wi,4,1),o(15,"ya-search-filter2",20,0),f("typedValue",function(l){E(e);let p=d();return x(p.parseQuery(l))}),a(),o(17,"ya-select",21),s(18,"ya-option",22)(19,"ya-option",23)(20,"ya-option",24)(21,"ya-option",25)(22,"ya-option",26)(23,"ya-option",27),a(),s(24,"ya-multi-select",28),_(25,"async"),u(26,Hi,2,0,"ya-button"),o(27,"mat-slide-toggle",29),r(28," Multiline "),a()()(),o(29,"div",30)(30,"div"),u(31,Ui,9,3,"span")(32,zi,9,3,"span")(33,Ji,9,3,"span")(34,Ki,4,0,"span")(35,Xi,10,6,"span"),a(),s(36,"div",31),u(37,Zi,1,0,"ya-dots"),_(38,"async"),u(39,en,3,0,"div",32),_(40,"async"),o(41,"ya-button",33),f("click",function(){E(e);let l=d();return x(l.exportEvents())}),r(42,"Export CSV"),a(),s(43,"ya-column-chooser",34,1),a(),u(45,nn,4,3,"ya-table-top"),o(46,"table",35),D(47,36),u(48,on,2,0,"th",37)(49,an,2,1,"td",38),w(),D(50,39),u(51,rn,2,0,"th",37)(52,ln,2,2,"td",40),w(),D(53,41),u(54,sn,2,0,"th",37)(55,pn,3,1,"td",38),w(),D(56,42),u(57,dn,2,0,"th",37)(58,fn,3,1,"td",38),w(),D(59,43),u(60,gn,2,0,"th",37)(61,Cn,3,3,"td",44),w(),D(62,45),u(63,_n,2,0,"th",37)(64,hn,3,3,"td",44),w(),D(65,46),u(66,yn,2,0,"th",37)(67,Sn,2,1,"td",38),w(),nt(68,On,3,1,"ng-container",47,it),u(70,Tn,1,0,"tr",48),_(71,"async"),u(72,Dn,1,1,"tr",49),_(73,"async"),a(),o(74,"mat-toolbar"),s(75,"span",31),o(76,"ya-button",50),f("click",function(){E(e);let l=d();return x(l.loadMoreData())}),r(77,"Load more"),a(),s(78,"span",31),a()()}if(i&2){let e,n=b(16),l=b(44),p=d();c(2),m("disabled",!p.isClearQueryEnabled()),c(4),m("formGroup",p.filterForm),c(8),g(p.filterForm.value.interval==="CUSTOM"?14:-1),c(),m("completions",p.completions)("expanded",p.multilineControl.value),c(9),m("options",h(25,18,p.sourceOptions$)),c(2),g(p.filterForm.value.interval!=="CUSTOM"?26:-1),c(),m("disableRipple",!0)("formControl",p.multilineControl),c(4),g((e=p.appliedInterval)==="PT1H"?31:e==="PT6H"?32:e==="P1D"?33:e==="NO_LIMIT"?34:e==="CUSTOM"?35:-1),c(6),g(h(38,20,p.dataSource.loading$)?37:-1),c(2),g(h(40,22,p.dataSource.streaming$)?39:-1),c(4),m("columns",p.columns),c(2),g(n.dirty()?45:-1),c(),m("dataSource",p.dataSource),c(22),ot(p.extraColumns),c(2),m("cdkHeaderRowDef",h(71,24,l.displayedColumns$)),c(2),m("cdkRowDefColumns",h(73,26,l.displayedColumns$)),c(4),m("disabled",!p.dataSource.hasMore())}}var ue="PT1H",Ye=class i{constructor(t,e,n,l,p,Je,Yn,mi,pi){this.yamcs=t;this.authService=e;this.dialog=n;this.messageService=p;this.router=Je;this.route=Yn;this.filter=G();this.severity=G();this.source=G([],{transform:Ut});this.interval=G();this.customStart=G();this.customStop=G();this.parseFilterSubscription=G.required();this.searchFilter=et.required("searchFilter");this.completions=ri;this.filterForm=new le({filter:new C(null),severity:new C("INFO"),source:new C([]),interval:new C(ue),customStart:new C(null),customStop:new C(null)});this.multilineControl=new C(!1);this.columns=[{id:"severity",label:"Severity",visible:!0},{id:"gentime",label:"Generation time",alwaysVisible:!0},{id:"message",label:"Message",alwaysVisible:!0},{id:"source",label:"Source",visible:!0},{id:"type",label:"Type",visible:!0},{id:"rectime",label:"Reception time"},{id:"seqNumber",label:"Sequence number"}];this.extraColumns=[];this.sourceOptions$=new I([]);this.downloadURL$=new I(null);mi.setTitle("Events");let Ke=l.getConfig().events;if(Ke){this.extraColumns=Ke.extraColumns||[];for(let ne of this.extraColumns)for(let F=0;F<this.columns.length;F++)if(this.columns[F].id===ne.after){this.columns.splice(F+1,0,ne);break}}t.yamcsClient.getEventSources(t.instance).then(ne=>{for(let F of ne)this.sourceOptions$.next([...this.sourceOptions$.value,{id:F,label:F}])}),this.dataSource=new Ve(t,pi),this.dataSource.sources$.subscribe(ne=>{this.sourceOptions$.next(ne.map(F=>({id:F,label:F})))})}isClearQueryEnabled(){let t=this.filterForm.value;return this.searchFilter().empty()||t.severity!=="INFO"||t.source?.length}ngOnInit(){this.parseFilterSubscription().addMessageListener(t=>{t.errorMessage?this.searchFilter().addErrorMark(t.errorMessage,{beginLine:t.beginLine,beginColumn:t.beginColumn,endLine:t.endLine,endColumn:t.endColumn}):this.searchFilter().clearErrorMark()}),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.forEach(t=>{this.loadData()}),this.filterForm.get("severity").valueChanges.forEach(t=>{this.loadData()}),this.filterForm.get("source").valueChanges.forEach(t=>{this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(t=>{if(t==="CUSTOM"){let e=this.validStart||this.yamcs.getMissionTime(),n=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(y.toISOString(e)),this.filterForm.get("customStop").setValue(y.toISOString(n))}else t==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=t,this.loadData()):t&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,t),this.appliedInterval=t,this.loadData())})}ngAfterViewInit(){(this.filter()||"").indexOf(`
`)!==-1&&this.multilineControl.setValue(!0)}initializeOptions(){if(this.filter()){let t=this.filter();this.filterForm.get("filter").setValue(t)}if(this.severity()){let t=this.severity();this.filterForm.get("severity").setValue(t)}if(this.source()){let t=this.source();this.filterForm.get("source").setValue(t)}if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=this.customStart();this.filterForm.get("customStart").setValue(t),this.validStart=y.toDate(t);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=y.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=ue,this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,ue)}jumpToNow(){let t=this.filterForm.controls.interval.value;t==="NO_LIMIT"?this.filterForm.get("interval").setValue(ue):t==="CUSTOM"?this.filterForm.get("interval").setValue(ue):t&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=y.subtractDuration(this.validStop,t),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){let{controls:t}=this.filterForm;this.validStart=y.toDate(t.customStart.value),this.validStop=y.toDate(t.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){let{controls:t}=this.filterForm;this.updateURL();let e={severity:t.severity.value};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString());let n=t.filter.value;n&&(e.filter=n);let l=t.source.value;l?.length&&(e.source=l),this.dataSource.loadEvents(e).catch(p=>this.messageService.showError(p))}loadMoreData(){let{controls:t}=this.filterForm,e={severity:t.severity.value};this.validStart&&(e.start=this.validStart.toISOString());let n=t.filter.value;n&&(e.filter=n);let l=t.source.value;l?.length&&(e.source=l),this.dataSource.loadMoreData(e).catch(p=>this.messageService.showError(p))}updateURL(){let{controls:t}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:t.filter.value||null,severity:t.severity.value,source:t.source.value?t.source.value:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?t.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?t.customStop.value:null},queryParamsHandling:"merge"})}clearQuery(){this.filterForm.reset({severity:"INFO",source:[],interval:ue})}openSaveQueryDialog(){let{controls:t}=this.filterForm;this.dialog.open(Re,{width:"800px",data:{severity:t.severity.value,filter:this.searchFilter().getTypedValue(),source:t.source.value,sourceOptions:this.sourceOptions$.value}}).afterClosed().subscribe(e=>{e&&this.messageService.showInfo("Query saved")})}parseQuery(t){this.parseFilterSubscription().sendMessage({resource:"events",filter:t})}mayWriteEvents(){return this.authService.getUser().hasSystemPrivilege("WriteEvents")}createEvent(){this.dialog.open(Pe,{width:"400px"}).afterClosed().subscribe(e=>{e&&this.jumpToNow()})}exportEvents(){let{controls:t}=this.filterForm;this.dialog.open(Ae,{width:"800px",data:{severity:t.severity.value,start:this.validStart,stop:this.validStop,filter:t.filter.value,source:t.source.value,sourceOptions:this.sourceOptions$.value}})}ngOnDestroy(){this.parseFilterSubscription().cancel()}static{this.\u0275fac=function(e){return new(e||i)(v(M),v(De),v(Se),v(Yt),v(K),v(_e),v(ut),v(dt),v(At))}}static{this.\u0275cmp=S({type:i,selectors:[["ng-component"]],viewQuery:function(e,n){e&1&&lt(n.searchFilter,ji,5),e&2&&st()},inputs:{filter:[1,"filter"],severity:[1,"severity"],source:[1,"source"],interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"],parseFilterSubscription:[1,"parseFilterSubscription"]},decls:9,vars:5,consts:[["searchFilter",""],["columnChooser",""],["icon","add_circle_outline"],["matTooltip","Pause streaming events","icon","pause"],["icon","play_arrow"],["matTooltip","Jump to now","icon","refresh",3,"clicked"],[1,"panel-content"],["icon","add_circle_outline",3,"clicked"],["matTooltip","Pause streaming events","icon","pause",3,"clicked"],["icon","play_arrow",3,"clicked"],["appearance","text","icon","clear",3,"click","disabled"],["appearance","text","icon","save",3,"click"],[3,"formGroup"],[1,"filter-bar","query",2,"margin-top","16px"],["icon","access_time","formControlName","interval"],["id","PT1H","label","Last hour"],["id","PT6H","label","Last 6 hours"],["id","P1D","label","Last 24 hours"],["id","NO_LIMIT","label","No limit"],["id","CUSTOM","label","Custom","group","true"],["formControlName","filter","placeholder","Search events",2,"flex","1 1 auto","margin-right","7px",3,"typedValue","completions","expanded"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],[3,"disableRipple","formControl"],[1,"table-actions"],[2,"flex","1 1 auto"],[2,"text-align","right","flex","1 1 150px"],["appearance","text","icon","download",3,"click"],["preferenceKey","events","appearance","text","icon","view_columns",3,"columns"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","severity"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","message"],["mat-cell","","class","mono message expand",4,"cdkCellDef"],["cdkColumnDef","type"],["cdkColumnDef","source"],["cdkColumnDef","gentime"],["mat-cell","","style","white-space: nowrap",4,"cdkCellDef"],["cdkColumnDef","rectime"],["cdkColumnDef","seqNumber"],[3,"cdkColumnDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"ngClass",4,"cdkRowDef","cdkRowDefColumns"],[3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click"],["fontSize","16px"],["href","",1,"ya-link",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"severity"],["mat-cell","",1,"mono","message","expand"],[3,"message","highlight"],[3,"text","term"],["mat-cell","",2,"white-space","nowrap"],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Events \xA0\xA0\xA0 "),u(3,Gi,2,0,"ya-page-button",2)(4,Qi,2,0,"ya-page-button",3),_(5,"async"),u(6,Bi,2,0,"ya-page-button",4),o(7,"ya-page-icon-button",5),f("clicked",function(){return n.jumpToNow()}),a()(),u(8,wn,79,28,"div",6),a()),e&2&&(c(3),g(n.mayWriteEvents()?3:-1),c(),g(h(5,3,n.dataSource.streaming$)?4:6),c(4),g(n.dataSource?8:-1))},dependencies:[Ne,pe,Le,Ie,we,O,Ce,ae,A,N,L,_t,k,V,Ot,Et,xt,bt,Mt,se,Ee,xe,be,Me,Oe,St,ye,Y,Vt,ce,qt,Te,Z,X,Gt,Qt,Bt,q,Wt,Ht],styles:[".filter-bar.query[_ngcontent-%COMP%]{height:unset}.table-status[_ngcontent-%COMP%]{background-color:var(--y-background-color);height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.ya-data-table[_ngcontent-%COMP%]   td.mat-mdc-cell.message[_ngcontent-%COMP%]{white-space:pre-wrap}.WATCH[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .WARNING[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--y-warning-color)!important}.ERROR[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .DISTRESS[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .CRITICAL[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .SEVERE[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--y-error-color)!important}"],changeDetection:0})}};var li="INFO",si=[],qe=class i{constructor(t,e,n,l){this.dialogRef=t;this.yamcs=e;this.messageService=n;this.data=l;this.form=new le({name:new C("",T.required),filter:new C(""),severity:new C(li,T.required),source:new C(si),shared:new C(!1,T.required)});let{query:p}=l;this.form.patchValue({name:p.name,filter:p.query.filter||void 0,severity:p.query.severity,source:p.query.source,shared:p.shared})}save(){let{value:t}=this.form,e=this.data.query.id;this.yamcs.yamcsClient.editQuery(this.yamcs.instance,"events",e,{name:t.name,shared:t.shared??!1,query:{filter:t.filter??void 0,source:t.source??si,severity:t.severity??li}}).then(n=>this.dialogRef.close(n)).catch(n=>this.messageService.showError(n))}static{this.\u0275fac=function(e){return new(e||i)(v(B),v(M),v(K),v(W))}}static{this.\u0275cmp=S({type:i,selectors:[["app-edit-event-query-dialog"]],decls:37,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","name","type","text"],[1,"half-break"],["formControlName","filter"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","shared"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Edit query"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"div",2),r(5," Name "),s(6,"input",3),a(),s(7,"hr",4),o(8,"div",2),r(9," Query "),s(10,"ya-filter-textarea",5),a(),s(11,"hr",4),o(12,"label"),r(13," Severity "),s(14,"br"),o(15,"ya-select",6),s(16,"ya-option",7)(17,"ya-option",8)(18,"ya-option",9)(19,"ya-option",10)(20,"ya-option",11)(21,"ya-option",12),a()(),s(22,"hr",4),o(23,"label"),r(24," Source "),s(25,"br")(26,"ya-multi-select",13),a(),s(27,"hr",4),o(28,"div",2),r(29," Share with other users "),s(30,"br")(31,"mat-slide-toggle",14),a()()(),o(32,"mat-dialog-actions",15)(33,"ya-button",16),r(34,"CANCEL"),a(),o(35,"ya-button",17),f("click",function(){return n.save()}),r(36,"SAVE"),a()()),e&2&&(c(3),m("formGroup",n.form),c(23),m("options",n.data.sourceOptions),c(9),m("disabled",!n.form.valid))},dependencies:[O,A,re,N,L,k,V,H,U,J,z,se,Y,me,Z,X,q],encapsulation:2,changeDetection:0})}};var In=(i,t,e,n)=>({filter:i,severity:t,source:e,c:n});function Pn(i,t){i&1&&(o(0,"th",11),r(1,"Name"),a())}function Fn(i,t){if(i&1&&(o(0,"td",12)(1,"a",13),r(2),a()()),i&2){let e=t.$implicit,n=d();c(),m("queryParams",ct(2,In,e.query.filter,e.query.severity,e.query.source,n.yamcs.context)),c(),$(" ",e.name," ")}}function Rn(i,t){i&1&&(o(0,"th",14),r(1,"Visibility"),a())}function Nn(i,t){if(i&1&&(o(0,"td",12),r(1),a()),i&2){let e=t.$implicit;c(),$(" ",e.shared?"Shared":"Private"," ")}}function Ln(i,t){i&1&&s(0,"th",15)}function An(i,t){if(i&1){let e=P();o(0,"td",12)(1,"ya-more")(2,"button",16),f("click",function(){let l=E(e).$implicit,p=d();return x(p.openEditQueryDialog(l))}),r(3,"Edit query"),a(),o(4,"button",16),f("click",function(){let l=E(e).$implicit,p=d();return x(p.openDeleteQueryDialog(l))}),r(5,"Delete query"),a()()()}}function kn(i,t){i&1&&s(0,"tr",17)}function Vn(i,t){i&1&&s(0,"tr",18)}var $e=class i{constructor(t,e,n){this.yamcs=t;this.messageService=e;this.dialog=n;this.displayedColumns=["name","visibility","actions"];this.dataSource=new Ft;this.sourceOptions=[];this.refreshTable(),t.yamcsClient.getEventSources(t.instance).then(l=>{this.sourceOptions=l.map(p=>({id:p,label:p}))})}refreshTable(){this.yamcs.yamcsClient.getQueries(this.yamcs.instance,"events").then(t=>this.dataSource.data=t).catch(t=>this.messageService.showError(t))}openEditQueryDialog(t){this.dialog.open(qe,{width:"800px",data:{query:t,sourceOptions:this.sourceOptions}}).afterClosed().subscribe(e=>{e&&(this.refreshTable(),this.messageService.showInfo("Query updated"))})}openDeleteQueryDialog(t){confirm(`Are you sure you want to delete query ${t.name}`)&&this.yamcs.yamcsClient.deleteQuery(this.yamcs.instance,"events",t.id).then(()=>this.refreshTable()).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||i)(v(M),v(K),v(Se))}}static{this.\u0275cmp=S({type:i,selectors:[["app-event-query-list"]],decls:17,vars:3,consts:[[1,"panel-content"],["mat-table","",1,"ya-data-table","expand",2,"margin-top","16px",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","style","min-width: 200px",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","visibility"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",2,"min-width","200px"],["mat-cell",""],["routerLink","/events",3,"queryParams"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Events"),a(),o(3,"div",0),s(4,"app-events-page-tabs"),o(5,"table",1),D(6,2),u(7,Pn,2,0,"th",3)(8,Fn,3,7,"td",4),w(),D(9,5),u(10,Rn,2,0,"th",6)(11,Nn,2,1,"td",4),w(),D(12,7),u(13,Ln,1,0,"th",8)(14,An,6,0,"td",4),w(),u(15,kn,1,0,"tr",9)(16,Vn,1,0,"tr",10),a()()()),e&2&&(c(5),m("dataSource",n.dataSource),c(10),m("matHeaderRowDef",n.displayedColumns),c(),m("matRowDefColumns",n.displayedColumns))},dependencies:[we,Ie,pe,O,he,yt,Ee,Dt,It,wt,Tt,Pt,xe,be,Me,Oe,jt],encapsulation:2})}};var ci=(i,t)=>{let n=ge(M).yamcsClient.createParseFilterSubscription({resource:"events",filter:""},()=>null);return new Promise((l,p)=>{n.addReplyListener(()=>{l(n)})})};var Ua=[{path:"",canActivate:[Jt,zt],canActivateChild:[Kt],runGuardsAndResolvers:"always",component:Xt,children:[{path:"",pathMatch:"full",component:Ye,canActivate:[Ue],resolve:{parseFilterSubscription:ci}},{path:"queries",component:$e,canActivate:[Ue]}]}];export{Ua as ROUTES};
