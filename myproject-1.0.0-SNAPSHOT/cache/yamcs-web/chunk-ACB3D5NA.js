import{a as ve}from"./chunk-UBMLYMMH.js";import{a as Ke}from"./chunk-EIWKOY65.js";import{a as kt}from"./chunk-MGVY23XK.js";import"./chunk-GB6VNHLO.js";import{a as X,c as Z,d as wt,e as Et}from"./chunk-J6RUEXVW.js";import{$c as ct,$e as se,Aa as o,Ac as N,Af as B,Ba as u,Bc as P,Bg as Ce,Ca as y,Cc as mt,Da as T,Dc as be,Eb as ae,Ec as we,Fa as w,Fb as ot,Fc as te,Ga as A,Gc as H,Ha as c,Hb as z,Ib as lt,Kc as $,Lf as b,Lg as Q,N as x,Nc as F,Nf as Ne,O as g,Of as vt,Og as bt,Pf as ht,Ra as ie,Sa as l,T as q,Ta as V,Ua as f,Uf as J,V as Ae,Va as L,We as le,Xc as De,Xe as re,Ya as tt,Yc as K,Ye as me,Yf as xt,Za as k,_c as oe,_e as ce,_f as gt,ag as St,ba as m,bb as h,bf as pe,cb as S,cf as de,da as v,db as it,eb as nt,ef as _e,f as U,ff as ue,ga as D,hf as fe,id as st,if as Le,ih as E,jd as pt,ka as O,kg as At,lh as Pe,m as Se,ma as d,mf as _t,mg as yt,nf as ut,of as ft,oh as I,pg as Tt,ph as He,qa as _,qb as at,qc as rt,qh as Dt,rf as R,rh as It,sa as ze,sb as ye,t as et,te as Ie,ue as Ee,va as p,ve as dt,vf as Ct,wb as ne,wc as Te,we as ke,xe as Me,ye as Ve,za as a,ze as Oe}from"./chunk-MTJQDUEX.js";var Lt=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),$e=t=>({c:t}),Y=class t{constructor(n){this.yamcs=n}static{this.\u0275fac=function(e){return new(e||t)(v(E))}}static{this.\u0275cmp=D({type:t,selectors:[["app-alarms-page-tabs"]],decls:16,vars:20,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["rlc","routerLinkActive"],["rld","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/alarms","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/alarms/pending","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","/alarms/history","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","/alarms/log","routerLinkActive","",3,"active","queryParams"]],template:function(e,i){if(e&1&&(a(0,"nav",5)(1,"a",6,0),l(3," Active "),o(),a(4,"a",7,1),l(6," Pending "),o(),a(7,"a",8,2),l(9," History "),o(),a(10,"a",9,3),l(12," Action log "),o()(),a(13,"mat-tab-nav-panel",null,4),u(15,"router-outlet"),o()),e&2){let r=ie(2),s=ie(5),C=ie(8),M=ie(11),G=ie(14);_("mat-stretch-tabs",!1)("tabPanel",G),m(),_("routerLinkActiveOptions",tt(11,Lt))("active",r.isActive)("queryParams",k(12,$e,i.yamcs.context)),m(3),_("active",s.isActive)("queryParams",k(14,$e,i.yamcs.context)),m(3),_("active",C.isActive)("queryParams",k(16,$e,i.yamcs.context)),m(3),_("active",M.isActive)("queryParams",k(18,$e,i.yamcs.context))}},dependencies:[I,ot,z,lt,_t,ft,ut],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}};function Nt(t,n){if(t&1){let e=w();u(0,"ya-date-time-input",14)(1,"ya-date-time-input",15),a(2,"ya-button",16),A("click",function(){x(e);let r=c();return g(r.applyCustomDates())}),l(3,"Apply"),o()}if(t&2){let e=c();m(2),_("disabled",e.filterForm.invalid)}}function Pt(t,n){if(t&1){let e=w();a(0,"ya-button",17),A("click",function(){x(e);let r=c();return g(r.jumpToNow())}),l(1,"Jump to now"),o()}}function Ht(t,n){t&1&&(a(0,"th",18),l(1,"Time"),o())}function $t(t,n){if(t&1&&(a(0,"td",19),l(1),h(2,"datetime"),o()),t&2){let e=n.$implicit;m(),V(S(2,1,e.time))}}function Ft(t,n){t&1&&(a(0,"th",18),l(1,"User"),o())}function Rt(t,n){if(t&1&&(a(0,"td",19),l(1),o()),t&2){let e=n.$implicit;m(),V(e.user||"-")}}function Bt(t,n){t&1&&(a(0,"th",18),l(1,"Action"),o())}function Yt(t,n){if(t&1&&(a(0,"td",19),u(1,"ya-action-log-summary",20),o()),t&2){let e=n.$implicit;m(),_("text",e.summary)}}function Gt(t,n){t&1&&u(0,"th",21)}function Ut(t,n){t&1&&u(0,"td",19)}function qt(t,n){t&1&&u(0,"tr",22)}function jt(t,n){t&1&&u(0,"tr",23)}var Fe=class t extends R{constructor(e,i){super();this.yamcs=e;this.route=i;this.interval=Ae();this.customStart=Ae();this.customStop=Ae();this.filterForm=new mt({interval:new we("NO_LIMIT"),customStart:new we(null),customStop:new we(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new Le;this.setTitle("Alarm action log")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(e=>{if(e==="CUSTOM"){let i=new Date,r=this.validStart||i,s=this.validStop||i;this.filterForm.get("customStart").setValue(b.toISOString(r)),this.filterForm.get("customStop").setValue(b.toISOString(s))}else e==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=e,this.loadData()):e&&(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,e),this.appliedInterval=e,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=this.customStart();this.filterForm.get("customStart").setValue(e),this.validStart=b.toDate(e);let i=this.customStop();this.filterForm.get("customStop").setValue(i),this.validStop=b.toDate(i)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:e}=this.filterForm;this.validStart=b.toDate(e.customStart.value),this.validStop=b.toDate(e.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let e={service:"AlarmsApi"};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,e).then(i=>this.dataSource.data=i.records||[]).catch(i=>this.messageService.showError(i))}updateURL(){let{controls:e}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?e.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?e.customStop.value:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(i){return new(i||t)(v(E),v(ae))}}static{this.\u0275cmp=D({type:t,selectors:[["app-alarms-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},features:[O],decls:25,vars:7,consts:[[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"text"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Alarms"),o(),a(3,"div",0),u(4,"app-alarms-page-tabs"),a(5,"form",1)(6,"div",2),u(7,"ya-select",3),d(8,Nt,4,1)(9,Pt,2,0,"ya-button"),o()(),a(10,"table",4),y(11,5),d(12,Ht,2,0,"th",6)(13,$t,3,3,"td",7),T(),y(14,8),d(15,Ft,2,0,"th",6)(16,Rt,2,1,"td",7),T(),y(17,9),d(18,Bt,2,0,"th",6)(19,Yt,2,1,"td",7),T(),y(20,10),d(21,Gt,1,0,"th",11)(22,Ut,1,0,"td",7),T(),d(23,qt,1,0,"tr",12)(24,jt,1,0,"tr",13),o()()()),i&2&&(m(5),_("formGroup",r.filterForm),m(2),_("options",r.intervalOptions),m(),p(r.filterForm.value.interval==="CUSTOM"?8:-1),m(),p(r.filterForm.value.interval!=="CUSTOM"?9:-1),m(),_("dataSource",r.dataSource),m(13),_("matHeaderRowDef",r.displayedColumns),m(),_("matRowDefColumns",r.displayedColumns))},dependencies:[Y,Z,X,I,H,N,P,$,F,le,me,de,ce,re,_e,se,pe,ue,fe,Ct,B,Ne,J,Q],encapsulation:2,changeDetection:0})}};function Wt(t,n){if(t&1&&l(0),t&2){let e=c(2);f(" /",e.data.alarms[0].id.name," ")}}function zt(t,n){if(t&1&&(l(0),d(1,Wt,1,1)),t&2){let e=c();f(" ",e.data.alarms[0].id.namespace," "),m(),p(e.data.alarms[0].id.name?1:-1)}}function Kt(t,n){if(t&1&&l(0),t&2){let e=c();f(" ",e.data.alarms.length," selected alarms. ")}}var Be=class t{constructor(n,e,i,r){this.dialogRef=n;this.yamcs=i;this.data=r;this.formGroup=e.group({comment:void 0})}async acknowledge(){let n=this.data.alarms,e=this.formGroup.get("comment").value;for(let i of n){let r={};e&&(r.comment=e);let s=i.id.namespace+(i.id.name?"/"+i.id.name:"");this.yamcs.yamcsClient.acknowledgeAlarm(this.yamcs.instance,this.yamcs.processor,s,i.seqNum,r)}this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||t)(v(Ie),v(De),v(E),v(Ee))}}static{this.\u0275cmp=D({type:t,selectors:[["app-acknowledge-alarm-dialog"]],decls:15,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),l(1,"Acknowledge"),o(),a(2,"mat-dialog-content")(3,"p"),d(4,zt,2,2)(5,Kt,1,1),o(),a(6,"form",1)(7,"label"),l(8," Comment "),u(9,"textarea",2),o()()(),a(10,"mat-dialog-actions",3)(11,"ya-button",4),l(12,"CANCEL"),o(),a(13,"ya-button",5),A("click",function(){return i.acknowledge()}),l(14," OK "),o()()),e&2&&(m(4),p(i.data.alarms.length===1?4:-1),m(),p(i.data.alarms.length!==1?5:-1),m(),_("formGroup",i.formGroup),m(7),_("disabled",!i.formGroup.valid))},dependencies:[I,H,Te,N,P,$,F,ke,Me,Oe,Ve,B],encapsulation:2,changeDetection:0})}};var Jt=t=>({c:t});function Qt(t,n){if(t&1&&(a(0,"div",0),l(1,"Parameter"),o(),a(2,"div",1)(3,"a",4),l(4),o()()),t&2){let e=c();m(3),_("routerLink","/telemetry/parameters/"+e.alarm.id.namespace+"/"+e.alarm.id.name)("queryParams",k(4,Jt,e.yamcs.context)),m(),L(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function Xt(t,n){if(t&1&&l(0),t&2){let e=c(2);L(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function Zt(t,n){if(t&1&&l(0),t&2){let e=c(2);f(" ",e.alarm.id.namespace," ")}}function ei(t,n){if(t&1&&(a(0,"div",0),l(1,"Event"),o(),a(2,"div",1),d(3,Xt,1,2)(4,Zt,1,1),o()),t&2){let e=c();m(3),p(e.alarm.id.name?3:4)}}function ti(t,n){t&1&&(a(0,"span"),l(1,"\u2193"),o())}function ii(t,n){t&1&&(a(0,"span"),l(1,"\u2191"),o())}function ni(t,n){t&1&&(a(0,"span"),l(1,"\u2193"),o())}function ai(t,n){t&1&&(a(0,"span"),l(1,"\u2191"),o())}function oi(t,n){if(t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),l(3,"Trigger value"),o(),a(4,"div",1),u(5,"app-alarm-level",5),l(6),h(7,"value"),d(8,ti,2,0,"span")(9,ii,2,0,"span"),o(),u(10,"br")(11,"mat-divider"),a(12,"div",0),l(13,"Live value"),o(),a(14,"div",1)(15,"ya-expirable",6),u(16,"app-alarm-level",5),l(17),h(18,"value"),d(19,ni,2,0,"span")(20,ai,2,0,"span"),o()()),t&2){let e=n,i=c();m(5),_("level",i.alarm.severity)("grayscale",!0),m(),f(" \xA0",S(7,11,e.triggerValue.engValue)," "),m(2),p(e.triggerValue.rangeCondition==="LOW"?8:-1),m(),p(e.triggerValue.rangeCondition==="HIGH"?9:-1),m(6),_("pval",e.currentValue),m(),_("level",e.currentValue.monitoringResult)("grayscale",!0),m(),f(" \xA0",S(18,13,e.currentValue.engValue)," "),m(2),p(e.currentValue.rangeCondition==="LOW"?19:-1),m(),p(e.currentValue.rangeCondition==="HIGH"?20:-1)}}function li(t,n){t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),l(3,"Trigger event"),o(),a(4,"div",1),l(5),o()),t&2&&(m(5),f(" ",n.triggerEvent.message," "))}function ri(t,n){if(t&1&&(a(0,"blockquote",7),l(1),o()),t&2){let e=c(2);m(),f(" ",e.alarm.acknowledgeInfo.acknowledgeMessage," ")}}function mi(t,n){if(t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),l(3),o(),a(4,"div",1),l(5),h(6,"datetime"),d(7,ri,2,1,"blockquote",7),o()),t&2){let e=c();m(3),f("Acknowledged by ",e.alarm.acknowledgeInfo.acknowledgedBy,""),m(2),f(" On ",S(6,3,e.alarm.acknowledgeInfo.acknowledgeTime)," "),m(2),p(e.alarm.acknowledgeInfo.acknowledgeMessage?7:-1)}}function ci(t,n){if(t&1&&(a(0,"blockquote",7),l(1),o()),t&2){let e=c(2);m(),f(" ",e.alarm.shelveInfo.shelveMessage," ")}}function si(t,n){if(t&1&&(a(0,"div",0),l(1,"Shelve expiration"),o(),a(2,"div",1),l(3),h(4,"datetime"),o()),t&2){let e=c(2);m(3),f(" ",S(4,1,e.alarm.shelveInfo.shelveExpiration)," ")}}function pi(t,n){if(t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),l(3),o(),a(4,"div",1),l(5),h(6,"datetime"),d(7,ci,2,1,"blockquote",7),o(),d(8,si,5,3)),t&2){let e=c();m(3),f("Shelved by ",e.alarm.shelveInfo.shelvedBy,""),m(2),f(" On ",S(6,4,e.alarm.shelveInfo.shelveTime)," "),m(2),p(e.alarm.shelveInfo.shelveMessage?7:-1),m(),p(e.alarm.shelveInfo.shelveExpiration?8:-1)}}function di(t,n){if(t&1){let e=w();a(0,"ya-button",12),A("click",function(){x(e);let r=c(2);return g(r.acknowledgeAlarm.emit(r.alarm))}),l(1," ACKNOWLEDGE "),o()}}function _i(t,n){if(t&1){let e=w();a(0,"ya-button",13),A("click",function(){x(e);let r=c(2);return g(r.shelveAlarm.emit(r.alarm))}),l(1,"SHELVE"),o()}}function ui(t,n){if(t&1){let e=w();a(0,"ya-button",14),A("click",function(){x(e);let r=c(2);return g(r.unshelveAlarm.emit(r.alarm))}),l(1,"UNSHELVE"),o()}}function fi(t,n){if(t&1){let e=w();a(0,"div",3),d(1,di,2,0,"ya-button",8)(2,_i,2,0,"ya-button",9)(3,ui,2,0,"ya-button",10),a(4,"ya-button",11),A("click",function(){x(e);let r=c();return g(r.clearAlarm.emit(r.alarm))}),l(5,"CLEAR"),o()()}if(t&2){let e=c();m(),p(!e.alarm.shelveInfo&&!e.alarm.acknowledged?1:-1),m(),p(e.alarm.shelveInfo?-1:2),m(),p(e.alarm.shelveInfo?3:-1)}}var Ye=class t{constructor(n){this.yamcs=n;this.mayControl=!1;this.acknowledgeAlarm=new q;this.shelveAlarm=new q;this.unshelveAlarm=new q;this.clearAlarm=new q}static{this.\u0275fac=function(e){return new(e||t)(v(E))}}static{this.\u0275cmp=D({type:t,selectors:[["app-alarm-detail"]],inputs:{alarm:"alarm",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm",clearAlarm:"clearAlarm"},decls:17,vars:12,consts:[[1,"block-title"],[1,"block"],[3,"level"],[1,"action-bar"],[1,"ya-link",3,"routerLink","queryParams"],[3,"level","grayscale"],[3,"pval"],[2,"border-left","4px solid #eee","padding-left","1em","font-style","italic"],["icon","notifications_off"],["icon","timer"],["icon","timer_off"],["icon","clear_all",3,"click"],["icon","notifications_off",3,"click"],["icon","timer",3,"click"],["icon","timer_off",3,"click"]],template:function(e,i){if(e&1&&(d(0,Qt,5,6)(1,ei,5,1),a(2,"div",0),l(3,"Severity"),o(),a(4,"div",1),u(5,"app-alarm-level",2),l(6),o(),a(7,"div",0),l(8,"Violations"),o(),a(9,"div",1),l(10),h(11,"number"),o(),d(12,oi,21,15)(13,li,6,1)(14,mi,8,5)(15,pi,9,6)(16,fi,6,3,"div",3)),e&2){let r,s;p(i.alarm.type==="PARAMETER"?0:-1),m(),p(i.alarm.type==="EVENT"?1:-1),m(4),_("level",i.alarm.severity),m(),f(" ",i.alarm.severity,`
`),m(4),f(" ",S(11,10,i.alarm.violations),`
`),m(2),p((r=i.alarm.parameterDetail)?12:-1,r),m(),p((s=i.alarm.eventDetail)?13:-1,s),m(),p(i.alarm.acknowledgeInfo?14:-1),m(),p(i.alarm.shelveInfo?15:-1),m(),p(i.mayControl&&!i.alarm.readonly?16:-1)}},dependencies:[ve,I,ne,z,pt,B,xt,Q,Ce],encapsulation:2,changeDetection:0})}};function Ci(t,n){t&1&&(a(0,"mat-icon",0),l(1,"timer"),o())}function vi(t,n){t&1&&(a(0,"mat-icon",1),l(1,"pending"),o())}function hi(t,n){t&1&&(a(0,"mat-icon",2),l(1,"check_circle_outline"),o())}function xi(t,n){t&1&&(a(0,"mat-icon",3),l(1,"notifications_none"),o())}function gi(t,n){if(t&1&&d(0,hi,2,0,"mat-icon",2)(1,xi,2,0,"mat-icon",3),t&2){let e=c(2);p(e.alarm.acknowledged?0:1)}}function Si(t,n){t&1&&(a(0,"mat-icon",4),l(1,"check_circle"),o())}function Ai(t,n){t&1&&(a(0,"mat-icon",5),l(1," notification_important "),o())}function yi(t,n){if(t&1&&d(0,Si,2,0,"mat-icon",4)(1,Ai,2,0,"mat-icon",5),t&2){let e=c(2);p(e.alarm.acknowledged?0:1)}}function Ti(t,n){if(t&1&&d(0,vi,2,0,"mat-icon",1)(1,gi,2,1)(2,yi,2,1),t&2){let e=c();p(e.alarm.pending?0:e.alarm.processOK?1:2)}}var Ge=class t{static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=D({type:t,selectors:[["app-alarm-state-icon"]],inputs:{alarm:"alarm"},decls:2,vars:1,consts:[["matTooltip","Shelved"],["matTooltip","Pending"],["matTooltip","RTN, acknowledged"],["matTooltip","RTN, unacknowledged",1,"unacked"],["matTooltip","Active, acknowledged"],["matTooltip","Active, unacknowledged",1,"unacked"]],template:function(e,i){e&1&&d(0,Ci,2,0,"mat-icon",0)(1,Ti,3,1),e&2&&p(i.alarm.shelveInfo?0:1)},dependencies:[I,K,oe],encapsulation:2})}};var Xe=t=>({c:t});function bi(t,n){t&1&&(a(0,"th",19),l(1,"Alarm type"),o())}function wi(t,n){t&1&&(a(0,"mat-icon",21),l(1,"event_note"),o())}function Di(t,n){t&1&&(a(0,"mat-icon",21),l(1,"toll"),o())}function Ii(t,n){if(t&1&&(a(0,"td",20),d(1,wi,2,0,"mat-icon",21)(2,Di,2,0,"mat-icon",21),l(3),h(4,"titlecase"),o()),t&2){let e=n.$implicit;m(),p(e.type==="EVENT"?1:-1),m(),p(e.type==="PARAMETER"?2:-1),m(),f(" ",S(4,3,e.type||"-")," ")}}function Ei(t,n){t&1&&(a(0,"th",19),l(1,"Alarm name"),o())}function ki(t,n){if(t&1&&(a(0,"a",22),l(1),o()),t&2){let e=c(2).$implicit,i=c();_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",k(4,Xe,i.yamcs.context)),m(),L(" ",e.id.namespace,"/",e.id.name," ")}}function Mi(t,n){if(t&1&&l(0),t&2){let e=c(2).$implicit;L(" ",e.id.namespace,"/",e.id.name," ")}}function Vi(t,n){if(t&1&&d(0,ki,2,6,"a",22)(1,Mi,1,2),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function Oi(t,n){if(t&1&&(a(0,"a",22),l(1),o()),t&2){let e=c(2).$implicit,i=c();_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",k(3,Xe,i.yamcs.context)),m(),f(" ",e.id.namespace," ")}}function Li(t,n){if(t&1&&l(0),t&2){let e=c(2).$implicit;f(" ",e.id.namespace," ")}}function Ni(t,n){if(t&1&&d(0,Oi,2,5,"a",22)(1,Li,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function Pi(t,n){if(t&1&&(a(0,"a",22),l(1),o()),t&2){let e=c(2).$implicit,i=c();_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",k(3,Xe,i.yamcs.context)),m(),f(" ",e.id.name," ")}}function Hi(t,n){if(t&1&&l(0),t&2){let e=c(2).$implicit;f(" ",e.id.name," ")}}function $i(t,n){if(t&1&&d(0,Pi,2,5,"a",22)(1,Hi,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function Fi(t,n){if(t&1&&(a(0,"td",20),d(1,Vi,2,1)(2,Ni,2,1)(3,$i,2,1),o()),t&2){let e=n.$implicit;m(),p(e.id.namespace&&e.id.name?1:-1),m(),p(e.id.namespace&&!e.id.name?2:-1),m(),p(!e.id.namespace&&e.id.name?3:-1)}}function Ri(t,n){t&1&&(a(0,"th",23),l(1,"State"),o())}function Bi(t,n){if(t&1&&(a(0,"td",24),u(1,"app-alarm-state-icon",25),o()),t&2){let e=n.$implicit;m(),_("alarm",e)}}function Yi(t,n){t&1&&(a(0,"th",19),l(1,"Alarm time"),o())}function Gi(t,n){if(t&1&&(a(0,"td",20)(1,"span",26),h(2,"datetime"),u(3,"app-ago",27),o()()),t&2){let e=n.$implicit;m(),_("matTooltip",S(2,2,e.triggerTime)),m(2),_("time",e.triggerTime)}}function Ui(t,n){t&1&&(a(0,"th",23),l(1,"Severity"),o())}function qi(t,n){if(t&1&&(a(0,"td",24),u(1,"app-alarm-level",28),o()),t&2){let e=n.$implicit;m(),_("level",e.severity)("grayscale",e.pending)}}function ji(t,n){t&1&&(a(0,"th",19),l(1,"Trip value"),o())}function Wi(t,n){t&1&&(a(0,"span"),l(1,"\u2193"),o())}function zi(t,n){t&1&&(a(0,"span"),l(1,"\u2191"),o())}function Ki(t,n){if(t&1&&(l(0),h(1,"value"),d(2,Wi,2,0,"span")(3,zi,2,0,"span")),t&2){let e=n;f(" ",S(1,3,e.triggerValue.engValue)," "),m(2),p(e.triggerValue.rangeCondition==="LOW"?2:-1),m(),p(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function Ji(t,n){t&1&&l(0),t&2&&f(" ",n.triggerEvent.message||"-"," ")}function Qi(t,n){if(t&1&&(a(0,"td",29),d(1,Ki,4,5)(2,Ji,1,1),o()),t&2){let e,i,r=n.$implicit;m(),p((e=r.parameterDetail)?1:-1,e),m(),p((i=r.eventDetail)?2:-1,i)}}function Xi(t,n){t&1&&(a(0,"th",19),l(1,"Live value"),o())}function Zi(t,n){t&1&&(a(0,"span"),l(1,"\u2193"),o())}function en(t,n){t&1&&(a(0,"span"),l(1,"\u2191"),o())}function tn(t,n){if(t&1&&(l(0),h(1,"value"),d(2,Zi,2,0,"span")(3,en,2,0,"span")),t&2){let e=n;f(" ",S(1,3,e.currentValue.engValue)," "),m(2),p(e.currentValue.rangeCondition==="LOW"?2:-1),m(),p(e.currentValue.rangeCondition==="HIGH"?3:-1)}}function nn(t,n){t&1&&l(0),t&2&&f(" ",n.triggerEvent.message||"-"," ")}function an(t,n){if(t&1&&(a(0,"td",29),d(1,tn,4,5)(2,nn,1,1),o()),t&2){let e,i,r=n.$implicit;m(),p((e=r.parameterDetail)?1:-1,e),m(),p((i=r.eventDetail)?2:-1,i)}}function on(t,n){t&1&&(a(0,"th",19),l(1,"Violations"),o())}function ln(t,n){if(t&1&&(a(0,"td",20),l(1),h(2,"number"),o()),t&2){let e=n.$implicit;m(),V(S(2,1,e.violations))}}function rn(t,n){t&1&&u(0,"th",30)}function mn(t,n){if(t&1){let e=w();a(0,"ya-more")(1,"button",31),A("click",function(){x(e);let r=c().$implicit,s=c();return g(s.acknowledgeAlarm.emit(r))}),l(2," Acknowledge... "),o(),a(3,"button",31),A("click",function(){x(e);let r=c().$implicit,s=c();return g(s.shelveAlarm.emit(r))}),l(4," Shelve... "),o(),a(5,"button",31),A("click",function(){x(e);let r=c().$implicit,s=c();return g(s.unshelveAlarm.emit(r))}),l(6," Unshelve "),o()()}if(t&2){let e=c().$implicit;m(),_("disabled",e.shelveInfo||e.acknowledged),m(2),_("disabled",e.shelveInfo),m(2),_("disabled",!e.shelveInfo)}}function cn(t,n){if(t&1&&(a(0,"td",20),d(1,mn,7,3,"ya-more"),o()),t&2){let e=n.$implicit,i=c();m(),p(i.mayControl&&!e.readonly&&!e.pending?1:-1)}}function sn(t,n){t&1&&u(0,"tr",32)}function pn(t,n){if(t&1){let e=w();a(0,"tr",33),A("click",function(){let r=x(e).$implicit,s=c();return g(s.toggleOne(r))}),o()}if(t&2){let e=n.$implicit,i=c();ze("selected",i.selection.isSelected(e))("hide",i.hideAlarm(e))}}function dn(t,n){t&1&&l(0,"-")}var he=class t extends R{constructor(e){super();this.yamcs=e;this.displayedColumns=["state","severity","time","alarm","type","trip_value","live_value","actions"];this.view="standard";this.mayControl=!1;this.acknowledgeAlarm=new q;this.shelveAlarm=new q;this.unshelveAlarm=new q;this.tableTrackerFn=(e,i)=>`${i.triggerTime}__${i.id.namespace}__${i.id.name}__${i.seqNum}`}ngOnInit(){this.view==="pending"&&this.displayedColumns.splice(this.displayedColumns.length-1,0,"violations")}toggleOne(e){(!this.selection.isSelected(e)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(e),this.openDetailPane()}hideAlarm(e){if(this.view==="pending")return!e.pending;if(this.view==="standard")return e.pending||!!e.shelveInfo;if(this.view==="all")return e.pending;if(this.view==="unacknowledged")return e.pending||!!e.shelveInfo||e.acknowledged;if(this.view==="acknowledged")return e.pending||!!e.shelveInfo||!e.acknowledged;if(this.view==="shelved")return e.pending||!e.shelveInfo}static{this.\u0275fac=function(i){return new(i||t)(v(E))}}static{this.\u0275cmp=D({type:t,selectors:[["app-alarms-table"]],inputs:{dataSource:"dataSource",selection:"selection",view:"view",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm"},features:[O],decls:32,vars:6,consts:[["dash",""],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["matColumnDef","type"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","state"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","time"],["matColumnDef","severity"],["matColumnDef","trip_value"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","live_value"],["matColumnDef","violations"],["matColumnDef","actions"],["mat-header-cell","","style","width: 100%",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","hide","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[2,"vertical-align","middle"],[3,"routerLink","queryParams"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"alarm"],[3,"matTooltip"],[3,"time"],[3,"level","grayscale"],["mat-cell","",1,"wrap200"],["mat-header-cell","",2,"width","100%"],["mat-menu-item","",3,"click","disabled"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(i,r){i&1&&(a(0,"table",1),y(1,2),d(2,bi,2,0,"th",3)(3,Ii,5,5,"td",4),T(),y(4,5),d(5,Ei,2,0,"th",3)(6,Fi,4,3,"td",4),T(),y(7,6),d(8,Ri,2,0,"th",7)(9,Bi,2,1,"td",8),T(),y(10,9),d(11,Yi,2,0,"th",3)(12,Gi,4,4,"td",4),T(),y(13,10),d(14,Ui,2,0,"th",7)(15,qi,2,2,"td",8),T(),y(16,11),d(17,ji,2,0,"th",3)(18,Qi,3,2,"td",12),T(),y(19,13),d(20,Xi,2,0,"th",3)(21,an,3,2,"td",12),T(),y(22,14),d(23,on,2,0,"th",3)(24,ln,3,3,"td",4),T(),y(25,15),d(26,rn,1,0,"th",16)(27,cn,2,1,"td",4),T(),d(28,sn,1,0,"tr",17)(29,pn,1,4,"tr",18),o(),d(30,dn,1,0,"ng-template",null,0,nt)),i&2&&(ze("hide",r.dataSource.isEmpty()),_("dataSource",r.dataSource)("trackBy",r.tableTrackerFn),m(28),_("matHeaderRowDef",r.displayedColumns),m(),_("matRowDefColumns",r.displayedColumns))},dependencies:[kt,ve,Ge,I,ne,ye,z,K,ct,le,me,de,ce,re,_e,se,pe,ue,fe,oe,At,Q,Ce],styles:[".hide[_ngcontent-%COMP%]{display:none}td[_ngcontent-%COMP%]{cursor:pointer}"]})}};var xe=class extends rt{constructor(e,i){super();this.yamcs=e;this.pendingOnly=i;this.alarms$=new U([]);this.filteredAlarms$=new U([]);this.loading$=new U(!1);this.alarmsByName={};this.filter=null;this.unacknowledgedAlarms$=this.alarms$.pipe(Se(r=>r.filter(s=>!s.shelveInfo&&!s.acknowledged))),this.acknowledgedAlarms$=this.alarms$.pipe(Se(r=>r.filter(s=>!s.shelveInfo&&s.acknowledged))),this.shelvedAlarms$=this.alarms$.pipe(Se(r=>r.filter(s=>!!s.shelveInfo)))}connect(){return this.filteredAlarms$}setFilter(e){this.filter=e||null}loadAlarms(){this.loading$.next(!0),this.yamcs.yamcsClient.getActiveAlarms(this.yamcs.instance,this.yamcs.processor).then(e=>{this.loading$.next(!1);for(let i of e)this.processAlarm(i);this.updateSubject()}),this.alarmSubscription=this.yamcs.yamcsClient.createAlarmSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,includePending:!0},e=>{this.processAlarm(e),this.updateSubject()})}updateSubject(){let i=[...Object.values(this.alarmsByName).sort((r,s)=>{let C=r.acknowledged===s.acknowledged?0:r.acknowledged?1:-1;if(C===0){let M=this.getNumericSeverity(r.severity),G=this.getNumericSeverity(s.severity);C=M===G?0:M<G?1:-1}if(C===0){let M=r.id.namespace+"/"+r.id.name,G=s.id.namespace+"/"+s.id.name;C=M.localeCompare(G)}return C})];if(this.alarms$.next(i),this.filter){let r=i.filter(s=>(s.id.namespace+"/"+s.id.name).toLowerCase().indexOf(this.filter)!==-1);this.filteredAlarms$.next(r)}else this.filteredAlarms$.next(i)}getNumericSeverity(e){switch(e){case"WATCH":return 0;case"WARNING":return 1;case"DISTRESS":return 2;case"CRITICAL":return 3;case"SEVERE":return 4;default:return 5}}disconnect(){this.alarms$.complete(),this.filteredAlarms$.complete(),this.loading$.complete(),this.alarmSubscription&&this.alarmSubscription.cancel()}isEmpty(){return!this.filteredAlarms$.getValue().length}processAlarm(e){let i=e.id.namespace+"/"+e.id.name;this.pendingOnly?e.pending?this.alarmsByName[i]=e:delete this.alarmsByName[i]:e.pending?delete this.alarmsByName[i]:e.processOK&&!e.triggered&&e.acknowledged?delete this.alarmsByName[i]:this.alarmsByName[i]=e}};function _n(t,n){if(t&1&&l(0),t&2){let e=c(2);f(" /",e.data.alarms[0].id.name," ")}}function un(t,n){if(t&1&&(l(0),d(1,_n,1,1)),t&2){let e=c();f(" ",e.data.alarms[0].id.namespace," "),m(),p(e.data.alarms[0].id.name?1:-1)}}function fn(t,n){if(t&1&&l(0),t&2){let e=c();f(" ",e.data.alarms.length," selected alarms. ")}}var Ue=class t{constructor(n,e,i,r){this.dialogRef=n;this.yamcs=i;this.data=r;this.durationOptions=[{id:"PT15M",label:"15 minutes"},{id:"PT30M",label:"30 minutes"},{id:"PT1H",label:"1 hour"},{id:"PT2H",label:"2 hours"},{id:"P1D",label:"1 day"},{id:"UNLIMITED",label:"unlimited"}];this.formGroup=e.group({duration:"PT2H",comment:void 0})}async shelve(){let n=this.data.alarms,e=this.formGroup.get("comment").value,i=null;if(this.formGroup.get("duration").value!=="UNLIMITED"){let r=this.formGroup.get("duration").value;i=b.convertDurationToMillis(r)}for(let r of n){let s={};e&&(s.comment=e),i&&(s.shelveDuration=i);let C=r.id.namespace+(r.id.name?"/"+r.id.name:"");this.yamcs.yamcsClient.shelveAlarm(this.yamcs.instance,this.yamcs.processor,C,r.seqNum,s)}this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||t)(v(Ie),v(De),v(E),v(Ee))}}static{this.\u0275cmp=D({type:t,selectors:[["app-shelve-alarm-dialog"]],decls:20,vars:5,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","duration",3,"options"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),l(1,"Shelve"),o(),a(2,"mat-dialog-content")(3,"p"),d(4,un,2,2)(5,fn,1,1),o(),a(6,"form",1)(7,"label"),l(8," Duration "),u(9,"br")(10,"ya-select",2),o(),u(11,"br"),a(12,"label"),l(13," Comment "),u(14,"textarea",3),o()()(),a(15,"mat-dialog-actions",4)(16,"ya-button",5),l(17,"CANCEL"),o(),a(18,"ya-button",6),A("click",function(){return i.shelve()}),l(19,"OK"),o()()),e&2&&(m(4),p(i.data.alarms.length===1?4:-1),m(),p(i.data.alarms.length!==1?5:-1),m(),_("formGroup",i.formGroup),m(4),_("options",i.durationOptions),m(8),_("disabled",!i.formGroup.valid))},dependencies:[I,H,Te,N,P,$,F,ke,Me,Oe,Ve,B,J],encapsulation:2,changeDetection:0})}};function vn(t,n){if(t&1){let e=w();a(0,"ya-page-button",7),A("clicked",function(){x(e);let r=c();return g(r.acknowledgeAlarms(r.selection.selected))}),l(1," Acknowledge "),o()}if(t&2){let e=c();_("disabled",!e.mayControlSelection())}}function hn(t,n){if(t&1){let e=w();a(0,"ya-page-button",8),A("clicked",function(){x(e);let r=c();return g(r.shelveAlarms(r.selection.selected))}),l(1," Shelve "),o()}if(t&2){let e=c();_("disabled",!e.mayControlSelection())}}function xn(t,n){if(t&1){let e=w();a(0,"ya-detail-toolbar"),l(1,"Alarm detail"),o(),a(2,"div",9)(3,"app-alarm-detail",10),A("acknowledgeAlarm",function(r){x(e);let s=c();return g(s.acknowledgeAlarms([r]))})("shelveAlarm",function(r){x(e);let s=c();return g(s.shelveAlarms([r]))})("unshelveAlarm",function(r){x(e);let s=c();return g(s.unshelveAlarms([r]))})("clearAlarm",function(r){x(e);let s=c();return g(s.clearAlarms([r]))}),o()()}if(t&2){let e=c();m(3),_("alarm",n)("mayControl",e.mayControlAlarms())}}function gn(t,n){t&1&&(a(0,"ya-detail-toolbar"),l(1,"Select an alarm"),o())}function Sn(t,n){if(t&1){let e=w();a(0,"div",6),u(1,"app-alarms-page-tabs"),a(2,"dl",11)(3,"dt"),l(4,"Unacknowledged alarms:"),o(),a(5,"dd")(6,"strong"),l(7),h(8,"async"),o()(),a(9,"dt"),l(10,"Acknowledged alarms:"),o(),a(11,"dd")(12,"strong"),l(13),h(14,"async"),o()(),a(15,"dt"),l(16,"Shelved alarms:"),o(),a(17,"dd")(18,"strong"),l(19),h(20,"async"),o()()(),a(21,"form",12)(22,"div",13),u(23,"ya-search-filter",14)(24,"ya-select",15),o()(),a(25,"app-alarms-table",16),h(26,"async"),A("acknowledgeAlarm",function(r){x(e);let s=c();return g(s.acknowledgeAlarms([r]))})("shelveAlarm",function(r){x(e);let s=c();return g(s.shelveAlarms([r]))})("unshelveAlarm",function(r){x(e);let s=c();return g(s.unshelveAlarms([r]))}),o()()}if(t&2){let e,i,r,s=c();m(7),V((e=S(8,9,s.dataSource.unacknowledgedAlarms$))==null?null:e.length),m(6),V((i=S(14,11,s.dataSource.acknowledgedAlarms$))==null?null:i.length),m(6),V((r=S(20,13,s.dataSource.shelvedAlarms$))==null?null:r.length),m(2),_("formGroup",s.filterForm),m(3),_("options",s.viewOptions),m(),_("dataSource",s.dataSource)("selection",s.selection)("view",S(26,15,s.view$))("mayControl",s.mayControlAlarms())}}var qe=class t extends R{constructor(e,i,r,s){super();this.yamcs=e;this.route=i;this.dialog=r;this.authService=s;this.filterForm=new be({filter:new te,view:new te("standard")});this.detailAlarm$=new U(null);this.selection=new Pe((e,i)=>`${i.triggerTime}__${i.id.namespace}__${i.id.name}__${i.seqNum}`,!1,[]);this.viewOptions=[{id:"standard",label:"Standard view (ack & unack)"},{id:"unacknowledged",label:"Unacknowledged alarms"},{id:"acknowledged",label:"Acknowledged alarms"},{id:"shelved",label:"Shelved alarms"},{id:"all",label:"All alarms"}];this.view$=new U("standard");this.setTitle("Alarms"),this.selectionSubscription=this.selection.changed.subscribe(()=>{let C=this.selection.selected;C.length===1?this.detailAlarm$.next(C[0]):this.detailAlarm$.next(null)}),this.dataSource=new xe(this.yamcs,!1),this.dataSource.loadAlarms(),this.alarmsSubscription=this.dataSource.alarms$.subscribe(C=>{this.selection.matchNewValues(C);let M=this.detailAlarm$.value;if(M){for(let G of C)if(this.isSameAlarm(G,M)){this.detailAlarm$.next(G);break}}}),this.initializeOptions(),this.filterForm.get("filter").valueChanges.pipe(et(400)).forEach(C=>{this.filter=C,this.updateURL(),this.dataSource.setFilter(C)}),this.filterForm.get("view").valueChanges.forEach(C=>{this.view$.next(C),this.updateURL(),this.selection.clear()})}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("view")){let i=e.get("view");this.view$.next(i),this.filterForm.get("view").setValue(i)}}isSameAlarm(e,i){return e.seqNum===i.seqNum&&e.id.namespace===i.id.namespace&&e.id.name===i.id.name&&e.triggerTime===i.triggerTime}acknowledgeAlarms(e){this.dialog.open(Be,{width:"400px",data:{alarms:e}}).afterClosed().subscribe(()=>this.selection.clear())}shelveAlarms(e){this.dialog.open(Ue,{width:"400px",data:{alarms:e}}).afterClosed().subscribe(()=>this.selection.clear())}unshelveAlarms(e){for(let i of e){let r=i.id.namespace+(i.id.name?"/"+i.id.name:"");this.yamcs.yamcsClient.unshelveAlarm(this.yamcs.instance,this.yamcs.processor,r,i.seqNum).then(()=>this.selection.clear()).catch(s=>this.messageService.showError(s))}}clearAlarms(e){for(let i of e){let r=i.id.namespace+(i.id.name?"/"+i.id.name:"");this.yamcs.yamcsClient.clearAlarm(this.yamcs.instance,this.yamcs.processor,r,i.seqNum,{})}}mayControlAlarms(){return this.authService.getUser().hasSystemPrivilege("ControlAlarms")}mayControlSelection(){let{selected:e}=this.selection;if(!e.length)return!1;for(let i of e)if(i.readonly)return!1;return!0}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,view:this.view$.value||null},queryParamsHandling:"merge"})}ngOnDestroy(){this.selectionSubscription?.unsubscribe(),this.alarmsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(v(E),v(ae),v(dt),v(He))}}static{this.\u0275cmp=D({type:t,selectors:[["ng-component"]],features:[O],decls:45,vars:6,consts:[[1,"ya-data-table"],["width","1"],[1,"icon16",2,"vertical-align","middle"],["icon","notifications_off",3,"disabled"],["icon","timer",3,"disabled"],[1,"table-wrapper"],[1,"panel-content"],["icon","notifications_off",3,"clicked","disabled"],["icon","timer",3,"clicked","disabled"],[2,"padding","0 16px"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","clearAlarm","alarm","mayControl"],[1,"dl-horizontal"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["formControlName","view",3,"options"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","dataSource","selection","view","mayControl"]],template:function(i,r){if(i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2," Alarms "),a(3,"ya-help"),l(4," An alarm can be in these states: "),a(5,"table",0)(6,"tr")(7,"td",1)(8,"mat-icon",2),l(9," notification_important "),o()(),a(10,"td"),l(11,"The alarm is unacknowledged and the cause of the alarm still exists."),o()(),a(12,"tr")(13,"td")(14,"mat-icon",2),l(15,"notifications_none"),o()(),a(16,"td"),l(17," The alarm is unacknowledged and the cause that generated the alarm no longer exists. "),o()(),a(18,"tr")(19,"td")(20,"mat-icon",2),l(21,"check_circle"),o()(),a(22,"td"),l(23,"The alarm is acknowledged and the cause of the alarm still exists."),o()(),a(24,"tr")(25,"td")(26,"mat-icon",2),l(27,"check_circle_outline"),o()(),a(28,"td"),l(29," The alarm is acknowledged and the cause that generated the alarm no longer exists. "),o()(),a(30,"tr")(31,"td")(32,"mat-icon",2),l(33,"timer"),o()(),a(34,"td"),l(35,"The alarm was shelved."),o()()()(),l(36," \xA0\xA0\xA0 "),d(37,vn,2,1,"ya-page-button",3)(38,hn,2,1,"ya-page-button",4),o(),a(39,"ya-detail-pane"),d(40,xn,4,2),h(41,"async"),d(42,gn,2,0,"ya-detail-toolbar"),o(),a(43,"div",5),d(44,Sn,27,17,"div",6),o()()),i&2){let s;m(37),p(r.mayControlAlarms()?37:-1),m(),p(r.mayControlAlarms()?38:-1),m(2),p((s=S(41,4,r.detailAlarm$))?40:42,s),m(4),p(r.dataSource?44:-1)}},dependencies:[Ye,Y,he,Z,X,I,at,H,N,P,$,F,K,vt,ht,St,yt,Tt,J],styles:[".detail[_ngcontent-%COMP%]{background-color:#fcfcfc;float:right;height:100%;width:450px;overflow:auto;border-left:1px solid #d3d3d3;box-sizing:border-box}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}mat-row[_ngcontent-%COMP%]{cursor:pointer}mat-row[_ngcontent-%COMP%]:hover{background:#fafafa}"],changeDetection:0})}};var Ze=t=>({c:t});function An(t,n){if(t&1){let e=w();u(0,"ya-date-time-input",8)(1,"ya-date-time-input",9),a(2,"ya-button",10),A("click",function(){x(e);let r=c();return g(r.applyCustomDates())}),l(3," Apply "),o()}if(t&2){let e=c();m(2),_("disabled",e.filterForm.invalid)}}function yn(t,n){if(t&1){let e=w();a(0,"ya-button",11),A("click",function(){x(e);let r=c();return g(r.jumpToNow())}),l(1,"Jump to now"),o()}}function Tn(t,n){t&1&&(a(0,"th",29),l(1,"Severity"),o())}function bn(t,n){if(t&1&&(a(0,"td",30),u(1,"app-alarm-level",31),o()),t&2){let e=n.$implicit;m(),_("level",e.severity)("grayscale",!0)}}function wn(t,n){t&1&&(a(0,"th",29),l(1,"Alarm type"),o())}function Dn(t,n){t&1&&(a(0,"mat-icon",32),l(1,"event_note"),o())}function In(t,n){t&1&&(a(0,"mat-icon",32),l(1,"toll"),o())}function En(t,n){if(t&1&&(a(0,"td",30),d(1,Dn,2,0,"mat-icon",32)(2,In,2,0,"mat-icon",32),l(3),h(4,"titlecase"),o()),t&2){let e=n.$implicit;m(),p(e.type==="EVENT"?1:-1),m(),p(e.type==="PARAMETER"?2:-1),m(),f(" ",S(4,3,e.type||"-")," ")}}function kn(t,n){t&1&&(a(0,"th",29),l(1,"Start"),o())}function Mn(t,n){if(t&1&&(a(0,"td",30),l(1),h(2,"datetime"),o()),t&2){let e=n.$implicit;m(),V(S(2,1,e.triggerTime)||"-")}}function Vn(t,n){t&1&&(a(0,"th",29),l(1,"Stop"),o())}function On(t,n){if(t&1&&(a(0,"td",30),l(1),h(2,"datetime"),o()),t&2){let e=n.$implicit;m(),f(" ",S(2,1,e.updateTime)||"-"," ")}}function Ln(t,n){t&1&&(a(0,"th",29),l(1,"Trip value"),o())}function Nn(t,n){t&1&&(a(0,"span"),l(1,"\u2193"),o())}function Pn(t,n){t&1&&(a(0,"span"),l(1,"\u2191"),o())}function Hn(t,n){if(t&1&&(l(0),h(1,"value"),d(2,Nn,2,0,"span")(3,Pn,2,0,"span")),t&2){let e=n;f(" ",S(1,3,e.triggerValue.engValue)," "),m(2),p(e.triggerValue.rangeCondition==="LOW"?2:-1),m(),p(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function $n(t,n){t&1&&l(0),t&2&&f(" ",n.triggerEvent.message||"-"," ")}function Fn(t,n){if(t&1&&(a(0,"td",33),d(1,Hn,4,5)(2,$n,1,1),o()),t&2){let e,i,r=n.$implicit;m(),p((e=r.parameterDetail)?1:-1,e),m(),p((i=r.eventDetail)?2:-1,i)}}function Rn(t,n){t&1&&(a(0,"th",29),l(1,"Alarm name"),o())}function Bn(t,n){if(t&1&&(a(0,"a",34),l(1),o()),t&2){let e=c(2).$implicit,i=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",k(4,Ze,i.yamcs.context)),m(),L(" ",e.id.namespace,"/",e.id.name," ")}}function Yn(t,n){if(t&1&&l(0),t&2){let e=c(2).$implicit;L(" ",e.id.namespace,"/",e.id.name," ")}}function Gn(t,n){if(t&1&&d(0,Bn,2,6,"a",34)(1,Yn,1,2),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function Un(t,n){if(t&1&&(a(0,"a",34),l(1),o()),t&2){let e=c(2).$implicit,i=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",k(3,Ze,i.yamcs.context)),m(),f(" ",e.id.namespace," ")}}function qn(t,n){if(t&1&&l(0),t&2){let e=c(2).$implicit;f(" ",e.id.namespace," ")}}function jn(t,n){if(t&1&&d(0,Un,2,5,"a",34)(1,qn,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function Wn(t,n){if(t&1&&(a(0,"a",34),l(1),o()),t&2){let e=c(2).$implicit,i=c(2);_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",k(3,Ze,i.yamcs.context)),m(),f(" ",e.id.name," ")}}function zn(t,n){if(t&1&&l(0),t&2){let e=c(2).$implicit;f(" ",e.id.name," ")}}function Kn(t,n){if(t&1&&d(0,Wn,2,5,"a",34)(1,zn,1,1),t&2){let e=c().$implicit;p(e.parameterDetail?0:1)}}function Jn(t,n){if(t&1&&(a(0,"td",30),d(1,Gn,2,1)(2,jn,2,1)(3,Kn,2,1),o()),t&2){let e=n.$implicit;m(),p(e.id.namespace&&e.id.name?1:-1),m(),p(e.id.namespace&&!e.id.name?2:-1),m(),p(!e.id.namespace&&e.id.name?3:-1)}}function Qn(t,n){t&1&&(a(0,"th",29),l(1,"Duration"),o())}function Xn(t,n){if(t&1&&(l(0),h(1,"duration")),t&2){let e=c().$implicit,i=c(2);f(" ",S(1,1,i.durationFor(e))||"-"," ")}}function Zn(t,n){if(t&1&&(a(0,"mat-icon",35),l(1,"comment"),o()),t&2){let e=c(2).$implicit;_("matTooltip",e.clearInfo==null?null:e.clearInfo.clearMessage)}}function ea(t,n){if(t&1&&(l(0),d(1,Zn,2,1,"mat-icon",35)),t&2){let e=c().$implicit;f(" (cleared by ",e.clearInfo==null?null:e.clearInfo.clearedBy,") "),m(),p(e.clearInfo!=null&&e.clearInfo.clearMessage?1:-1)}}function ta(t,n){if(t&1&&(a(0,"td",30),d(1,Xn,2,3)(2,ea,2,2),o()),t&2){let e=n.$implicit;m(),p(e.updateTime?1:-1),m(),p(e.clearInfo!=null&&e.clearInfo.clearedBy?2:-1)}}function ia(t,n){t&1&&(a(0,"th",36),l(1,"Violations"),o())}function na(t,n){if(t&1&&(l(0),h(1,"number"),h(2,"number")),t&2){let e=c().$implicit;L(" ",S(1,2,e.violations)," (",it(2,4,e.violations/e.count*100,"1.2-2"),"%) ")}}function aa(t,n){t&1&&l(0," - ")}function oa(t,n){if(t&1&&(a(0,"td",37),d(1,na,3,7)(2,aa,1,0),o()),t&2){let e=n.$implicit;m(),p(e.violations?1:2)}}function la(t,n){t&1&&u(0,"th",38)}function ra(t,n){if(t&1){let e=w();a(0,"ya-text-action",41),A("click",function(){x(e);let r=c().$implicit,s=c(2);return g(s.showChart(r))}),l(1," SHOW CHART "),o()}}function ma(t,n){if(t&1){let e=w();a(0,"ya-text-action",42),A("click",function(){x(e);let r=c().$implicit,s=c(2);return g(s.showData(r))}),l(1," SHOW DATA "),o()}}function ca(t,n){if(t&1&&(a(0,"td",30),d(1,ra,2,0,"ya-text-action",39)(2,ma,2,0,"ya-text-action",40),o()),t&2){let e=n.$implicit;m(),p(e.parameterDetail?1:-1),m(),p(e.parameterDetail?2:-1)}}function sa(t,n){t&1&&u(0,"tr",43)}function pa(t,n){t&1&&u(0,"tr",44)}function da(t,n){if(t&1&&(a(0,"table",5),y(1,12),d(2,Tn,2,0,"th",13)(3,bn,2,2,"td",14),T(),y(4,15),d(5,wn,2,0,"th",13)(6,En,5,5,"td",14),T(),y(7,16),d(8,kn,2,0,"th",13)(9,Mn,3,3,"td",14),T(),y(10,17),d(11,Vn,2,0,"th",13)(12,On,3,3,"td",14),T(),y(13,18),d(14,Ln,2,0,"th",13)(15,Fn,3,2,"td",19),T(),y(16,20),d(17,Rn,2,0,"th",13)(18,Jn,4,3,"td",14),T(),y(19,21),d(20,Qn,2,0,"th",13)(21,ta,3,2,"td",14),T(),y(22,22),d(23,ia,2,0,"th",23)(24,oa,3,1,"td",24),T(),y(25,25),d(26,la,1,0,"th",26)(27,ca,3,2,"td",14),T(),d(28,sa,1,0,"tr",27)(29,pa,1,0,"tr",28),o()),t&2){let e=c();_("dataSource",e.dataSource),m(28),_("matHeaderRowDef",e.displayedColumns),m(),_("matRowDefColumns",e.displayedColumns)}}var je=class t extends R{constructor(e,i){super();this.yamcs=e;this.route=i;this.filterForm=new be({interval:new te("NO_LIMIT"),customStart:new te(null),customStop:new te(null)});this.displayedColumns=["severity","start","stop","duration","alarm","type","triggerValue","violations","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new Le;this.setTitle("Alarm history"),this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(r=>{if(r==="CUSTOM"){let s=new Date,C=this.validStart||s,M=this.validStop||s;this.filterForm.get("customStart").setValue(b.toISOString(C)),this.filterForm.get("customStop").setValue(b.toISOString(M))}else r==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=r,this.loadData()):(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,r),this.appliedInterval=r,this.loadData())})}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=e.get("customStart");this.filterForm.get("customStart").setValue(i),this.validStart=b.toDate(i);let r=e.get("customStop");this.filterForm.get("customStop").setValue(r),this.validStop=b.toDate(r)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=b.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=b.toDate(this.filterForm.value.customStart),this.validStop=b.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(e){this.updateURL();let i={};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAlarms(this.yamcs.instance,i).then(r=>this.dataSource.data=r).catch(r=>this.messageService.showError(r))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}durationFor(e){if(e.updateTime)return b.toDate(e.updateTime).getTime()-b.toDate(e.triggerTime).getTime()}showChart(e){let i=e.triggerTime,r=e.updateTime||e.clearInfo?.clearTime,s,C;r?(s=i,C=r):(s=i,C=Ke(b.toDate(i),1).toISOString()),this.router.navigate(["/telemetry/parameters"+e.parameterDetail?.triggerValue.id.name,"-","chart"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:s,customStop:C}})}showData(e){let i=e.triggerTime,r=e.updateTime||e.clearInfo?.clearTime,s,C;r?(s=i,C=r):(s=i,C=Ke(b.toDate(i),1).toISOString()),this.router.navigate(["/telemetry/parameters"+e.parameterDetail?.triggerValue.id.name,"-","data"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:s,customStop:C}})}static{this.\u0275fac=function(i){return new(i||t)(v(E),v(ae))}}static{this.\u0275cmp=D({type:t,selectors:[["ng-component"]],features:[O],decls:17,vars:6,consts:[[1,"table-wrapper"],[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[2,"flex","1 1 auto"],[3,"disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["matColumnDef","severity"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","triggerValue"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","duration"],["matColumnDef","violations"],["mat-header-cell","","style","text-align: right",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"level","grayscale"],[2,"vertical-align","middle"],["mat-cell","",1,"wrap200"],[3,"routerLink","queryParams"],[3,"matTooltip"],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",1,"expand"],["icon","show_chart"],["icon","view_headline"],["icon","show_chart",3,"click"],["icon","view_headline",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Alarms"),o(),a(3,"div",0)(4,"div",1),u(5,"app-alarms-page-tabs"),a(6,"form",2)(7,"div",3),u(8,"ya-select",4),d(9,An,4,1)(10,yn,2,0,"ya-button"),o()(),d(11,da,30,3,"table",5),a(12,"mat-toolbar"),u(13,"span",6),a(14,"ya-button",7),l(15,"Load more"),o(),u(16,"span",6),o()()()()),i&2&&(m(6),_("formGroup",r.filterForm),m(2),_("options",r.intervalOptions),m(),p(r.filterForm.value.interval==="CUSTOM"?9:-1),m(),p(r.filterForm.value.interval!=="CUSTOM"?10:-1),m(),p(r.dataSource?11:-1),m(3),_("disabled",!0))},dependencies:[ve,Y,Z,X,I,ne,ye,H,N,P,$,F,z,K,le,me,de,ce,re,_e,se,pe,ue,fe,st,oe,B,Ne,J,gt,Q,bt,Ce],encapsulation:2,changeDetection:0})}};var We=class t extends R{constructor(e,i){super();this.authService=e;this.yamcs=i;this.detailAlarm$=new U(null);this.selection=new Pe((e,i)=>`${i.triggerTime}__${i.id.namespace}__${i.id.name}__${i.seqNum}`,!1,[]);this.setTitle("Pending alarms"),this.dataSource=new xe(this.yamcs,!0),this.dataSource.loadAlarms(),this.alarmsSubscription=this.dataSource.alarms$.subscribe(r=>{this.selection.matchNewValues(r);let s=this.detailAlarm$.value;if(s){for(let C of r)if(this.isSameAlarm(C,s)){this.detailAlarm$.next(C);break}}})}isSameAlarm(e,i){return e.seqNum===i.seqNum&&e.id.namespace===i.id.namespace&&e.id.name===i.id.name&&e.triggerTime===i.triggerTime}mayControlAlarms(){return this.authService.getUser().hasSystemPrivilege("ControlAlarms")}ngOnDestroy(){this.alarmsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(v(He),v(E))}}static{this.\u0275cmp=D({type:t,selectors:[["ng-component"]],features:[O],decls:8,vars:3,consts:[[1,"table-wrapper"],[1,"panel-content"],[2,"margin-top","16px"],["view","pending",3,"dataSource","selection","mayControl"]],template:function(i,r){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Alarms"),o(),a(3,"div",0)(4,"div",1),u(5,"app-alarms-page-tabs")(6,"div",2)(7,"app-alarms-table",3),o()()()),i&2&&(m(7),_("dataSource",r.dataSource)("selection",r.selection)("mayControl",r.mayControlAlarms()))},dependencies:[Y,he,Z,X,I],encapsulation:2,changeDetection:0})}};var Sl=[{path:"",canActivate:[Dt,wt],canActivateChild:[It],runGuardsAndResolvers:"always",component:Et,children:[{path:"",pathMatch:"full",component:qe},{path:"pending",component:We},{path:"history",component:je},{path:"log",component:Fe}]}];export{Sl as ROUTES};
