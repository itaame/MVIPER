import{a as at,c as it,d as nt,e as st}from"./chunk-J6RUEXVW.js";import{$e as Y,Aa as n,Ab as N,Ba as r,Ca as C,Da as u,Gf as y,Ha as c,Hb as H,Kg as X,Lg as Z,Ma as w,Na as P,Ng as tt,Oa as M,Sa as o,Ua as p,Ue as v,Ve as F,We as A,Xe as j,Ye as B,Ze as O,_a as I,_e as W,af as G,ba as s,bb as S,bf as Q,cb as T,cf as U,da as d,db as E,df as V,ef as q,f as h,ff as L,ga as x,gf as z,hf as J,if as K,ih as D,ma as l,oh as g,ph as et,qa as f,qb as $,qh as ot,rh as mt,va as b,za as i}from"./chunk-MTJQDUEX.js";var dt=(t,a)=>({c:t,name:a});function ft(t,a){t&1&&(i(0,"th",17),o(1,"Packet"),n())}function _t(t,a){if(t&1&&(i(0,"a",19),o(1),n()),t&2){let e=c().$implicit,m=c(2);f("queryParams",I(2,dt,m.yamcs.context,e.packetName)),s(),p(" ",e.packetName," ")}}function Ct(t,a){if(t&1&&o(0),t&2){let e=c().$implicit;p(" ",e.packetName," ")}}function ut(t,a){if(t&1&&(i(0,"td",18),l(1,_t,2,5,"a",19)(2,Ct,1,1),n()),t&2){let e=c(2);s(),b(e.config.tmArchive?1:2)}}function St(t,a){t&1&&r(0,"td",20)}function Tt(t,a){t&1&&(i(0,"th",21),o(1,"Received"),n())}function ht(t,a){if(t&1&&(i(0,"td",22),o(1),S(2,"deltaWith"),n()),t&2){let e=a.$implicit;s(),p(" ",E(2,1,e.lastReceived,e.lastPacketTime)||"-"," ")}}function bt(t,a){t&1&&r(0,"td",20)}function xt(t,a){t&1&&(i(0,"th",17),o(1,"Packet time"),n())}function vt(t,a){if(t&1&&(i(0,"td",18),o(1),S(2,"datetime"),n()),t&2){let e=a.$implicit;s(),p(" ",T(2,1,e.lastPacketTime)||"-"," ")}}function yt(t,a){t&1&&r(0,"td",20)}function Dt(t,a){t&1&&(i(0,"th",17),o(1,"Packet rate"),n())}function gt(t,a){if(t&1&&(i(0,"td",22),o(1),n()),t&2){let e=a.$implicit;s(),p(" ",e.packetRate," p/s ")}}function Rt(t,a){if(t&1&&(i(0,"td",23),o(1),S(2,"async"),n()),t&2){let e=c(2);s(),p(" ",T(2,1,e.totalPacketRate$)," p/s ")}}function kt(t,a){t&1&&(i(0,"th",17),o(1,"Data rate"),n())}function wt(t,a){if(t&1&&(i(0,"td",22),o(1),S(2,"dataRate"),n()),t&2){let e=a.$implicit;s(),p(" ",T(2,1,e.dataRate)," ")}}function Pt(t,a){if(t&1&&(i(0,"td",23),o(1),S(2,"async"),S(3,"dataRate"),n()),t&2){let e=c(2);s(),p(" ",T(3,3,T(2,1,e.totalDataRate$))," ")}}function Mt(t,a){t&1&&r(0,"th",24)}function It(t,a){t&1&&r(0,"td",18)}function Et(t,a){t&1&&r(0,"td",20)}function $t(t,a){t&1&&r(0,"tr",25)}function Nt(t,a){t&1&&r(0,"tr",26)}function Ht(t,a){t&1&&r(0,"tr",27)}function Ft(t,a){if(t&1&&(i(0,"table",0),C(1,1),l(2,ft,2,0,"th",2)(3,ut,3,1,"td",3)(4,St,1,0,"td",4),u(),C(5,5),l(6,Tt,2,0,"th",6)(7,ht,3,4,"td",7)(8,bt,1,0,"td",4),u(),C(9,8),l(10,xt,2,0,"th",2)(11,vt,3,3,"td",3)(12,yt,1,0,"td",4),u(),C(13,9),l(14,Dt,2,0,"th",2)(15,gt,2,1,"td",7)(16,Rt,3,3,"td",10),u(),C(17,11),l(18,kt,2,0,"th",2)(19,wt,3,3,"td",7)(20,Pt,4,5,"td",10),u(),C(21,12),l(22,Mt,1,0,"th",13)(23,It,1,0,"td",3)(24,Et,1,0,"td",4),u(),l(25,$t,1,0,"tr",14)(26,Nt,1,0,"tr",15)(27,Ht,1,0,"tr",16),n()),t&2){let e=c();f("dataSource",e.dataSource),s(25),f("matHeaderRowDef",e.displayedColumns),s(),f("matRowDefColumns",e.displayedColumns),s(),f("matFooterRowDef",e.displayedColumns)}}var R=class t{constructor(a,e){this.yamcs=a;this.statsByName={};this.dataSource=new K;this.totalPacketRate$=new h(0);this.totalDataRate$=new h(0);this.displayedColumns=["packetName","lastPacketTime","lastReceived","packetRate","dataRate","actions"];this.config=e.getConfig()}ngAfterViewInit(){this.dataSource.sort=this.sort,this.tmstats$&&!this.tmstatsSubscription&&this.yamcs.yamcsClient.getPacketNames(this.yamcs.instance).then(a=>{for(let e of a.packets||[])this.statsByName[e]={packetName:e,packetRate:0,dataRate:0};this.updateData(),this.tmstatsSubscription=this.tmstats$.subscribe(e=>{for(let m of e||[])this.statsByName[m.packetName]=m;this.updateData()})})}updateData(){let a=Object.values(this.statsByName),e=0,m=0;for(let _ of a)e+=Number(_.packetRate),m+=Number(_.dataRate);this.totalPacketRate$.next(e),this.totalDataRate$.next(m),this.dataSource.data=a}ngOnDestroy(){this.tmstatsSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||t)(d(D),d(y))}}static{this.\u0275cmp=x({type:t,selectors:[["app-tmstats-table"]],viewQuery:function(e,m){if(e&1&&w(v,5),e&2){let _;P(_=M())&&(m.sort=_.first)}},inputs:{tmstats$:"tmstats$"},decls:1,vars:1,consts:[["mat-table","","matSort","","matSortActive","packetName","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","packetName"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","lastReceived"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","lastPacketTime"],["matColumnDef","packetRate"],["mat-footer-cell","","style","text-align: right",4,"matFooterCellDef"],["matColumnDef","dataRate"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["routerLink","/telemetry/packets",3,"queryParams"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell","",2,"text-align","right"],["mat-footer-cell","",2,"text-align","right"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(e,m){e&1&&l(0,Ft,28,4,"table",0),e&2&&b(m.dataSource?0:-1)},dependencies:[g,$,H,v,F,A,B,U,W,j,q,O,V,Y,Q,G,L,J,z,X,Z,tt],encapsulation:2,changeDetection:0})}};function At(t,a){if(t&1&&r(0,"app-tmstats-table",1),t&2){let e=c();f("tmstats$",e.tmstats$)}}var k=class t{constructor(a,e,m,_){this.yamcs=a;this.authService=e;this.tmstats$=new h([]);this.config=_.getConfig(),this.user=e.getUser(),m.setTitle(this.yamcs.instance),this.yamcs.processor&&(this.tmstatsSubscription=a.yamcsClient.createTMStatisticsSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor},lt=>this.tmstats$.next(lt.tmstats||[])))}showPackets(){return this.user.hasAnyObjectPrivilegeOfType("ReadPacket")}ngOnDestroy(){this.tmstatsSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||t)(d(D),d(et),d(N),d(y))}}static{this.\u0275cmp=x({type:t,selectors:[["ng-component"]],decls:5,vars:1,consts:[[1,"panel-content"],[3,"tmstats$"]],template:function(e,m){e&1&&(i(0,"app-instance-page")(1,"app-instance-toolbar"),o(2,"Home"),n(),i(3,"div",0),l(4,At,1,1,"app-tmstats-table",1),n()()),e&2&&(s(4),b(m.showPackets()?4:-1))},dependencies:[it,at,g,R],encapsulation:2,changeDetection:0})}};var Se=[{path:"",canActivate:[ot,nt],canActivateChild:[mt],runGuardsAndResolvers:"always",component:st,children:[{path:"",pathMatch:"full",component:k}]}];export{Se as ROUTES};
