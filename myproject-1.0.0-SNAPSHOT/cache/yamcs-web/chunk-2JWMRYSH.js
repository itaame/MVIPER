import{a as ft,c as yt,d as Ie,e as ke}from"./chunk-J6RUEXVW.js";import{$c as Wt,$e as pe,Aa as a,Ab as nt,Ac as ot,Af as G,Ba as d,Bc as rt,C as Lt,Ca as P,Da as F,Dc as qt,E as Pt,Eb as Nt,Ef as ge,Fa as b,Fb as $t,Fc as B,Ga as C,Gb as Rt,Gc as ct,Ha as l,Hb as at,He as ne,I as W,Ib as Bt,Ie as ae,Kc as st,Ke as oe,Lf as k,Lg as $,M as Ft,Ma as Z,N as _,Na as tt,Nc as lt,Nf as Ce,Ng as De,O as g,Oa as et,Og as we,Qf as dt,Ra as V,Sa as c,Ta as S,Ua as x,Uf as Se,V as I,We as re,Xc as zt,Xe as ce,Yc as Ht,Ye as se,Za as U,_c as pt,_e as le,a as It,ah as Me,b as Et,ba as s,bb as f,bf as me,cb as h,cf as de,da as y,db as it,ef as ue,f as A,ff as ve,ga as T,hf as fe,id as Qt,ih as L,jd as Xt,kg as be,lg as xe,ma as m,mf as ye,mg as ut,nf as he,ng as Ae,of as _e,oh as D,pf as O,pg as Te,ph as vt,qa as p,qb as E,qc as jt,qf as Y,qh as Ee,rc as Ut,rh as Oe,sa as N,t as kt,te as Jt,ue as Kt,va as v,vb as Vt,ve as mt,wa as X,wc as Yt,we as Zt,xa as J,xe as te,ya as K,yc as Gt,ye as ee,za as o,ze as ie}from"./chunk-MTJQDUEX.js";function Ve(i,e){if(i&1&&(c(0),f(1,"deltaWith")),i&2){let t=l();x(" (",it(1,1,t.stop,t.start),") ")}}function Ne(i,e){if(i&1&&(o(0,"dt"),c(1),a(),o(2,"dd"),c(3),f(4,"printObj"),a()),i&2){let t=e.$implicit;s(),x("\xA0\xA0",t.key,""),s(2),S(h(4,2,t.value))}}function $e(i,e){if(i&1&&(o(0,"div",0)(1,"dl",1)(2,"dt"),c(3,"Activity ID"),a(),o(4,"dd"),c(5),a(),o(6,"dt"),c(7,"Status"),a(),o(8,"dd"),c(9),a(),o(10,"dt"),c(11,"Started"),a(),o(12,"dd"),c(13),f(14,"datetime"),a(),o(15,"dt"),c(16,"Finished"),a(),o(17,"dd"),c(18),f(19,"datetime"),m(20,Ve,2,4),a(),o(21,"dt"),c(22,"User"),a(),o(23,"dd"),c(24),a()(),o(25,"div",2),d(26,"mat-divider"),a(),o(27,"dl",3)(28,"dt"),c(29,"Activity type"),a(),o(30,"dd"),c(31),a(),o(32,"dt"),c(33,"Arguments"),a(),d(34,"dd"),J(35,Ne,5,4,null,null,X),f(37,"keyvalue"),a()()),i&2){let t,n=e;s(5),S(n.id),s(4),S(n.status),s(4),S(h(14,7,n.start)),s(5),x(" ",(t=h(19,9,n.stop))!==null&&t!==void 0?t:"-"," "),s(2),v(n.stop?20:-1),s(4),S(n.startedBy),s(7),S(n.type),s(4),K(h(37,11,n.args))}}var ht=class i{constructor(e,t){this.yamcs=e;this.messageService=t;this.activityId=I.required();this.activity$=new A(null)}ngOnInit(){let{yamcs:e}=this;e.yamcsClient.getActivity(e.instance,this.activityId()).then(t=>{this.activity$.next(t)}).catch(t=>this.messageService.showError(t))}static{this.\u0275fac=function(t){return new(t||i)(y(L),y(O))}}static{this.\u0275cmp=T({type:i,selectors:[["ng-component"]],inputs:{activityId:[1,"activityId"]},decls:2,vars:3,consts:[[1,"panel-content"],[1,"dl-horizontal","no-lead"],[1,"section-divider"],[1,"dl-horizontal"]],template:function(t,n){if(t&1&&(m(0,$e,38,13,"div",0),f(1,"async")),t&2){let r;v((r=h(1,1,n.activity$))?0:-1,r)}},dependencies:[D,E,Vt,Xt,$,De,Me],encapsulation:2,changeDetection:0})}};var q=class i{constructor(e,t,n){this.dialogRef=e;this.data=n;this.form=t.group({failureReason:["",[Gt.required]]})}async submit(){this.dialogRef.close({failureReason:this.form.value.failureReason})}static{this.\u0275fac=function(t){return new(t||i)(y(Jt),y(zt),y(Kt))}}static{this.\u0275cmp=T({type:i,selectors:[["app-set-failed-dialog"]],decls:13,vars:4,consts:[["filename",""],["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["type","text","formControlName","failureReason"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(t,n){if(t&1){let r=b();o(0,"h2",1),c(1,"Set failed"),a(),o(2,"mat-dialog-content")(3,"form",2)(4,"label"),c(5," Failure reason "),d(6,"input",3,0),a()()(),o(8,"mat-dialog-actions",4)(9,"ya-button",5),c(10,"CANCEL"),a(),o(11,"ya-button",6),C("click",function(){return _(r),g(n.submit())}),c(12,"SUBMIT"),a()()}if(t&2){let r;s(3),p("formGroup",n.form),s(),N("invalid",(r=n.form.get("name"))==null?null:r.invalid),s(7),p("disabled",!n.form.valid)}},dependencies:[D,ct,Yt,ot,rt,st,lt,Zt,te,ie,ee,G],encapsulation:2,changeDetection:0})}};var gt=class i{constructor(){this.synchronizer=W(Y);this.elapsed$=new A(0)}ngOnChanges(){this.syncSubscription?.unsubscribe(),this.activity&&(this.updateState(),this.activity.stop||(this.syncSubscription=this.synchronizer.sync(()=>this.updateState())))}updateState(){if(!this.activity.start)return;let e=new Date(this.activity.start);if(this.activity.stop){let t=new Date(this.activity.stop);this.elapsed$.next(this.millisBetween(e,t))}else{let t=this.millisBetween(e,new Date);this.elapsed$.next(t)}}millisBetween(e,t){return t.getTime()-e.getTime()}ngOnDestroy(){this.syncSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=T({type:i,selectors:[["app-activity-duration"]],inputs:{activity:"activity"},features:[Ft],decls:3,vars:5,template:function(t,n){t&1&&(c(0),f(1,"async"),f(2,"duration")),t&2&&S(h(2,3,h(1,1,n.elapsed$)))},dependencies:[D,E,we],encapsulation:2,changeDetection:0})}};function je(i,e){if(i&1&&(o(0,"mat-icon",0),c(1,"check_circle"),a()),i&2){let t=l();p("matTooltip",t.status)}}function Ue(i,e){if(i&1&&(o(0,"mat-icon",1),c(1,"cached"),a()),i&2){let t=l();p("matTooltip",t.status)}}function Ye(i,e){if(i&1&&(o(0,"mat-icon",2),c(1,"highlight_off"),a()),i&2){let t=l();p("matTooltip",t.status)}}function Ge(i,e){if(i&1&&(o(0,"mat-icon",3),c(1,"cached"),a()),i&2){let t=l();p("matTooltip",t.status)}}function qe(i,e){if(i&1&&(o(0,"mat-icon",4),c(1,"stop_circle"),a()),i&2){let t=l();p("matTooltip",t.status)}}function ze(i,e){if(i&1&&m(0,je,2,1,"mat-icon",0)(1,Ue,2,1,"mat-icon",1)(2,Ye,2,1,"mat-icon",2)(3,Ge,2,1,"mat-icon",3)(4,qe,2,1,"mat-icon",4),i&2){let t=e;v(t.status==="SUCCESSFUL"?0:-1),s(),v(t.status==="RUNNING"?1:-1),s(),v(t.status==="FAILED"?2:-1),s(),v(t.status==="CANCELLED"&&!t.stop?3:-1),s(),v(t.status==="CANCELLED"&&t.stop?4:-1)}}var Ct=class i{constructor(){this.activity=I.required()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=T({type:i,selectors:[["app-activity-icon"]],inputs:{activity:[1,"activity"]},decls:1,vars:1,consts:[[1,"success",3,"matTooltip"],[1,"spin",3,"matTooltip"],[1,"failed",3,"matTooltip"],[1,"warning","spin",3,"matTooltip"],[1,"cancelled",3,"matTooltip"]],template:function(t,n){if(t&1&&m(0,ze,5,5),t&2){let r;v((r=n.activity())?0:-1,r)}},dependencies:[D,Ht,pt],styles:[".success[_ngcontent-%COMP%]{color:#00c752}.warning[_ngcontent-%COMP%]{color:var(--y-warning-color)}.failed[_ngcontent-%COMP%]{color:var(--y-error-color)}.cancelled[_ngcontent-%COMP%]{color:#d3d3d3}.spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yspin 2s infinite linear}@keyframes _ngcontent-%COMP%_yspin{0%{-webkit-transform:rotate(0deg) scaleX(-1);transform:rotate(0) scaleX(-1)}to{-webkit-transform:rotate(359deg) scaleX(-1);transform:rotate(359deg) scaleX(-1)}}"],changeDetection:0})}};var St=class{constructor(e){this.watermarkObserver=e;this.dirty=!1;this.archiveActivities=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(e){this.archiveActivities=this.archiveActivities.concat(e),this.dirty=!0}addRealtimeActivity(e){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=e,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveActivities=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let e=this.archiveActivities;return this.realtimeBuffer.map(t=>{if(!t)return;let n=e.findIndex(r=>r.id==t.id);n===-1?e.push(t):e[n]=t}),e.sort((t,n)=>{let r=-t.start.localeCompare(n.start);return r!==0?r:n.seq-t.seq}),e}compact(e){let t=this.snapshot();t.length=Math.min(e,t.length),this.reset(),this.archiveActivities=t,this.dirty=!0}};var bt=class extends jt{constructor(t,n){super();this.yamcs=t;this.pageSize=100;this.blockHasMore=!1;this.activities$=new A([]);this.loading$=new A(!1);this.streaming$=new A(!1);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitActivities(),this.buffer.dirty=!1)}),this.buffer=new St(()=>{this.blockHasMore=!0,this.buffer.compact(500)})}connect(t){return this.activities$}emitActivities(){let t=this.buffer.snapshot();this.activities$.next(t)}loadActivities(t){return this.loading$.next(!0),Promise.all([this.loadPage(Et(It({},t),{limit:this.pageSize}))]).then(n=>{let r=n[0];return this.loading$.next(!1),this.buffer.reset(),this.blockHasMore=!1,this.buffer.addArchiveData(r),this.emitActivities(),r})}hasMore(){return!!this.continuationToken&&!this.blockHasMore}loadPage(t){return this.options=t,this.yamcs.yamcsClient.getActivities(this.yamcs.instance,t).then(n=>(this.continuationToken=n.continuationToken,n.activities||[]))}loadMoreData(t){this.continuationToken&&this.loadPage(Et(It({},t),{next:this.continuationToken,limit:this.pageSize})).then(n=>{this.buffer.addArchiveData(n)})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createActivitySubscription({instance:this.yamcs.instance},t=>{!this.loading$.getValue()&&this.matchesFilter(t)&&this.buffer.addRealtimeActivity(t)})}matchesFilter(t){return!(this.options&&(this.options.type&&t.type!==this.options.type||this.options.status&&t.status!==this.options.status||this.options.q&&(!t.detail||t.detail.indexOf(this.options.q)===-1)))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(t){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.activities$.complete(),this.loading$.complete(),this.streaming$.complete()}};var Xe=i=>({c:i});function Je(i,e){if(i&1){let t=b();o(0,"ya-page-button",34),C("clicked",function(){_(t);let r=l();return g(r.cancelSelectedActivities())}),c(1," Cancel "),a()}if(i&2){let t=l();p("disabled",!t.isGroupCancelEnabled())}}function Ke(i,e){if(i&1){let t=b();d(0,"ya-date-time-input",35)(1,"ya-date-time-input",36),o(2,"ya-button",33),C("click",function(){_(t);let r=l();return g(r.applyCustomDates())}),c(3,"Apply"),a()}if(i&2){let t=l();s(2),p("disabled",t.filterForm.invalid)}}function Ze(i,e){if(i&1){let t=b();o(0,"ya-button",37),C("click",function(){_(t);let r=l();return g(r.jumpToNow())}),c(1,"Jump to now"),a()}}function ti(i,e){i&1&&d(0,"ya-dots")}function ei(i,e){if(i&1&&(o(0,"span"),c(1," Showing activities from "),o(2,"b"),c(3,"the last hour"),a(),c(4," ending at "),o(5,"b"),c(6),f(7,"datetime"),a(),c(8," (Mission Time) "),a()),i&2){let t=l();s(6),S(h(7,1,t.validStop))}}function ii(i,e){if(i&1&&(o(0,"span"),c(1," Showing activities from "),o(2,"b"),c(3,"the last 6 hours"),a(),c(4," ending at "),o(5,"b"),c(6),f(7,"datetime"),a(),c(8," (Mission Time) "),a()),i&2){let t=l();s(6),S(h(7,1,t.validStop))}}function ni(i,e){if(i&1&&(o(0,"span"),c(1," Showing activities from "),o(2,"b"),c(3,"the last 24 hours"),a(),c(4," ending at "),o(5,"b"),c(6),f(7,"datetime"),a(),c(8," (Mission Time) "),a()),i&2){let t=l();s(6),S(h(7,1,t.validStop))}}function ai(i,e){i&1&&(o(0,"span"),c(1," Showing activities from "),o(2,"b"),c(3,"all time"),a()())}function oi(i,e){if(i&1&&(o(0,"span"),c(1," Showing activities from "),o(2,"b"),c(3),f(4,"datetime"),a(),c(5," to "),o(6,"b"),c(7),f(8,"datetime"),a(),c(9," (Mission Time) "),a()),i&2){let t=l();s(3),S(h(4,2,t.validStart)),s(4),S(h(8,4,t.validStop))}}function ri(i,e){if(i&1){let t=b();o(0,"th",38)(1,"input",39),C("change",function(r){_(t);let u=l();return g(r?u.masterToggle():null)}),a()()}if(i&2){let t=l();s(),p("checked",t.selection.hasValue()&&t.isAllSelected())}}function ci(i,e){if(i&1){let t=b();o(0,"td",40)(1,"input",41),C("click",function(r){return _(t),g(r.stopPropagation())})("change",function(r){let u=_(t).$implicit,w=l();return g(r?w.selection.toggle(u):null)}),a()()}if(i&2){let t=e.$implicit,n=l();s(),p("checked",n.selection.isSelected(t))}}function si(i,e){i&1&&d(0,"th",42)}function li(i,e){if(i&1&&(o(0,"td",43),d(1,"app-activity-icon",44),a()),i&2){let t=e.$implicit;s(),p("activity",t)}}function pi(i,e){i&1&&(o(0,"th",45),c(1,"Id"),a())}function mi(i,e){if(i&1&&(o(0,"td",46)(1,"a",47),c(2),a()()),i&2){let t=e.$implicit,n=l();s(),p("routerLink",t.id)("matTooltip",t.id)("queryParams",U(4,Xe,n.yamcs.context)),s(),x(" ",t.id.substring(0,8)," ")}}function di(i,e){i&1&&(o(0,"th",45),c(1,"Start"),a())}function ui(i,e){if(i&1&&(o(0,"td",48),c(1),f(2,"datetime"),a()),i&2){let t=e.$implicit;s(),x(" ",h(2,1,t.start)," ")}}function vi(i,e){i&1&&(o(0,"th",45),c(1,"Type"),a())}function fi(i,e){if(i&1&&(o(0,"td",48),c(1),a()),i&2){let t=e.$implicit;s(),x(" ",t.type," ")}}function yi(i,e){i&1&&(o(0,"th",45),c(1,"Detail"),a())}function hi(i,e){if(i&1&&(o(0,"td",48),c(1),a()),i&2){let t=e.$implicit;s(),x(" ",t.detail||"-"," ")}}function _i(i,e){i&1&&(o(0,"th",45),c(1,"Duration"),a())}function gi(i,e){if(i&1&&d(0,"app-activity-duration",44),i&2){let t=l().$implicit;p("activity",t)}}function Ci(i,e){i&1&&c(0," - ")}function Si(i,e){if(i&1&&(o(0,"td",48),m(1,gi,1,1,"app-activity-duration",44)(2,Ci,1,0),a()),i&2){let t=e.$implicit;s(),v(t.start?1:2)}}function bi(i,e){i&1&&d(0,"th",49)}function xi(i,e){if(i&1){let t=b();o(0,"ya-more")(1,"button",51),C("click",function(){_(t);let r=l().$implicit,u=l();return g(u.cancelActivity(r))}),c(2," Cancel "),a()()}if(i&2){let t=l().$implicit,n=l();s(),p("disabled",t.stop!==void 0||!n.mayControlActivities())}}function Ai(i,e){i&1&&(o(0,"span",50),c(1),a()),i&2&&(s(),x(" ",e," "))}function Ti(i,e){if(i&1){let t=b();o(0,"ya-button",52),C("click",function(){_(t);let r=l().$implicit,u=l();return g(u.setSuccessful(r))}),c(1,"Set successful"),a(),c(2," \xA0 "),o(3,"ya-button",53),C("click",function(){_(t);let r=l().$implicit,u=l();return g(u.setFailed(r))}),c(4,"Set failed"),a()}}function Di(i,e){if(i&1&&(o(0,"td",48),m(1,xi,3,1,"ya-more")(2,Ai,2,1,"span",50)(3,Ti,5,0),a()),i&2){let t,n=e.$implicit,r=l();s(),v(r.mayControlActivities()?1:-1),s(),v((t=n.failureReason)?2:-1,t),s(),v(n.type==="MANUAL"&&n.status==="RUNNING"&&r.mayControlActivities()?3:-1)}}function wi(i,e){i&1&&d(0,"tr",54)}function Mi(i,e){if(i&1){let t=b();o(0,"tr",55),C("click",function(){let r=_(t).$implicit,u=l();return g(u.toggleOne(r))}),a()}if(i&2){let t=e.$implicit,n=l();N("selected",n.selection.isSelected(t))}}var xt="NO_LIMIT",At=class i{constructor(e,t,n,r,u,w,Mt,Ri){this.yamcs=e;this.authService=t;this.router=n;this.route=r;this.messageService=Mt;this.dialog=Ri;this.filterForm=new qt({status:new B([]),filter:new B,type:new B([]),interval:new B(xt),customStart:new B(null),customStop:new B(null)});this.columns=[{id:"select",label:"",alwaysVisible:!0},{id:"status",label:"Status",alwaysVisible:!0},{id:"id",label:"Id",alwaysVisible:!0},{id:"start",label:"Start",visible:!0},{id:"type",label:"Type",visible:!0},{id:"detail",label:"Detail",visible:!0},{id:"duration",label:"Duration",visible:!0},{id:"actions",label:"",alwaysVisible:!0}];this.typeOptions$=new A([{id:"MANUAL",label:"Manual",icon:"emoji_people"}]);this.statusOptions$=new A([{id:"RUNNING",label:"Running",icon:"cached"},{id:"SUCCESSFUL",label:"Successful",icon:"check_circle"},{id:"CANCELLED",label:"Cancelled",icon:"stop_circle"},{id:"FAILED",label:"Failed",icon:"highlight_off"}]);this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.status=[];this.type=[];this.selection=new Ut(!0,[]);this.tableTrackerFn=(e,t)=>t.id;u.setTitle("Activities"),e.yamcsClient.getExecutors(e.instance).then(M=>{for(let H of M)this.typeOptions$.next([...this.typeOptions$.value,{id:H.type,label:H.displayName,icon:H.icon||"new_label"}])}).catch(M=>this.messageService.showError(M)),this.dataSource=new bt(e,w),this.dataSource.startStreaming(),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe(kt(400)).forEach(M=>{this.filter=M,this.loadData()}),this.filterForm.get("status").valueChanges.forEach(M=>{this.status=M,this.loadData()}),this.filterForm.get("type").valueChanges.forEach(M=>{this.type=M,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(M=>{if(M==="CUSTOM"){let H=this.validStart||this.yamcs.getMissionTime(),Fe=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(k.toISOString(H)),this.filterForm.get("customStop").setValue(k.toISOString(Fe))}else M==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=M,this.loadData()):(this.validStop=e.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,M),this.appliedInterval=M,this.loadData())})}initializeOptions(){let e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("status")&&(this.type=e.getAll("status"),this.filterForm.get("status").setValue(this.status)),e.has("type")&&(this.type=e.getAll("type"),this.filterForm.get("type").setValue(this.type)),e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=e.get("customStart");this.filterForm.get("customStart").setValue(t),this.validStart=k.toDate(t);let n=e.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=k.toDate(n)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=xt,this.validStop=null,this.validStart=null}jumpToNow(){let e=this.filterForm.value.interval;e==="NO_LIMIT"?this.filterForm.get("interval").setValue(xt):e==="CUSTOM"?this.filterForm.get("interval").setValue(xt):(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,e),this.loadData())}applyCustomDates(){this.validStart=k.toDate(this.filterForm.value.customStart),this.validStop=k.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let e={};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.filter&&(e.q=this.filter),this.status.length&&(e.status=this.status),this.type.length&&(e.type=this.type),this.dataSource.loadActivities(e).catch(t=>this.messageService.showError(t))}loadMoreData(){let e={};this.validStart&&(e.start=this.validStart.toISOString()),this.status&&(e.status=this.status),this.filter&&(e.q=this.filter),this.dataSource.loadMoreData(e)}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,status:this.type.length?this.status:null,type:this.type.length?this.type:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}mayControlActivities(){return this.authService.getUser().hasSystemPrivilege("ControlActivities")}isAllSelected(){return!1}masterToggle(){}toggleOne(e){(!this.selection.isSelected(e)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(e)}isGroupCancelEnabled(){for(let e of this.selection.selected)if(!e.stop)return!0;return!1}cancelSelectedActivities(){for(let e of this.selection.selected)e.stop,this.cancelActivity(e)}cancelActivity(e){this.yamcs.yamcsClient.cancelActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}setSuccessful(e){this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}setFailed(e){this.dialog.open(q,{width:"400px",data:{activity:e}}).afterClosed().subscribe(t=>{t&&this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id,{failureReason:t.failureReason}).catch(n=>this.messageService.showError(n))})}static{this.\u0275fac=function(t){return new(t||i)(y(L),y(vt),y(Rt),y(Nt),y(nt),y(Y),y(O),y(mt))}}static{this.\u0275cmp=T({type:i,selectors:[["ng-component"]],decls:60,vars:25,consts:[["columnChooser",""],["icon","cancel",3,"disabled"],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","activities",3,"columns"],["formControlName","status","emptyOption","Any status",3,"options"],["formControlName","type","emptyOption","Any type",3,"options"],["icon","access_time","formControlName","interval",3,"options"],[1,"table-status"],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","status"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","mono",4,"matCellDef"],["matColumnDef","start"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","type"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","detail"],["cdkColumnDef","duration"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],[2,"flex","1 1 auto"],[3,"click","disabled"],["icon","cancel",3,"clicked","disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"activity"],["mat-header-cell",""],["mat-cell","",1,"mono"],[3,"routerLink","matTooltip","queryParams"],["mat-cell",""],["mat-header-cell","",1,"expand"],[1,"alert"],["mat-menu-item","",3,"click","disabled"],["icon","thumb_up",3,"click"],["icon","thumb_down",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,n){if(t&1){let r=b();o(0,"app-instance-page")(1,"app-instance-toolbar"),c(2," Activities \xA0\xA0\xA0 "),m(3,Je,2,1,"ya-page-button",1),a(),o(4,"div",2)(5,"form",3)(6,"div",4),d(7,"ya-search-filter",5)(8,"ya-column-chooser",6,0),a(),o(10,"div",4),d(11,"ya-multi-select",7),f(12,"async"),d(13,"ya-multi-select",8),f(14,"async"),d(15,"ya-select",9),m(16,Ke,4,1)(17,Ze,2,0,"ya-button")(18,ti,1,0,"ya-dots"),f(19,"async"),a()(),o(20,"div",10),m(21,ei,9,3,"span")(22,ii,9,3,"span")(23,ni,9,3,"span")(24,ai,4,0,"span")(25,oi,10,6,"span"),a(),o(26,"table",11),P(27,12),m(28,ri,2,1,"th",13)(29,ci,2,1,"td",14),F(),P(30,15),m(31,si,1,0,"th",16)(32,li,2,1,"td",17),F(),P(33,18),m(34,pi,2,0,"th",19)(35,mi,3,6,"td",20),F(),P(36,21),m(37,di,2,0,"th",19)(38,ui,3,3,"td",22),F(),P(39,23),m(40,vi,2,0,"th",24)(41,fi,2,1,"td",25),F(),P(42,26),m(43,yi,2,0,"th",24)(44,hi,2,1,"td",25),F(),P(45,27),m(46,_i,2,0,"th",24)(47,Si,3,1,"td",25),F(),P(48,28),m(49,bi,1,0,"th",29)(50,Di,4,3,"td",22),F(),m(51,wi,1,0,"tr",30),f(52,"async"),m(53,Mi,1,2,"tr",31),f(54,"async"),a(),o(55,"mat-toolbar"),d(56,"span",32),o(57,"ya-button",33),C("click",function(){return _(r),g(n.loadMoreData())}),c(58,"Load more"),a(),d(59,"span",32),a()()()}if(t&2){let r,u=V(9);s(3),v(n.mayControlActivities()?3:-1),s(2),p("formGroup",n.filterForm),s(3),p("columns",n.columns),s(3),p("options",h(12,15,n.statusOptions$)),s(2),p("options",h(14,17,n.typeOptions$)),s(2),p("options",n.intervalOptions),s(),v(n.filterForm.value.interval==="CUSTOM"?16:-1),s(),v(n.filterForm.value.interval!=="CUSTOM"?17:-1),s(),v(h(19,19,n.dataSource.loading$)?18:-1),s(3),v((r=n.appliedInterval)==="PT1H"?21:r==="PT6H"?22:r==="P1D"?23:r==="NO_LIMIT"?24:r==="CUSTOM"?25:-1),s(5),p("dataSource",n.dataSource)("trackBy",n.tableTrackerFn),s(25),p("matHeaderRowDef",h(52,21,u.displayedColumns$)),s(2),p("matRowDefColumns",h(54,23,u.displayedColumns$)),s(4),p("disabled",!n.dataSource.hasMore())}},dependencies:[gt,Ct,yt,ft,D,E,ct,ot,rt,st,lt,at,ne,ae,oe,Wt,re,se,de,le,ce,ue,pe,me,ve,fe,Qt,pt,G,ge,Ce,dt,be,xe,ut,Te,Se,$],styles:[".table-status[_ngcontent-%COMP%]{background-color:var(--y-background-color);height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.alert[_ngcontent-%COMP%]{color:var(--y-error-color)!important}"],changeDetection:0})}};var z=class i{constructor(){this.yamcs=W(L);this.messageService=W(O);this.activity$=new A(null)}connect(e){let{yamcs:t}=this,n=!1;this.activitySubscription?.cancel(),this.activitySubscription=t.yamcsClient.createActivitySubscription({instance:t.instance},r=>{n&&r.id===e&&this.activity$.next(r)}),t.yamcsClient.getActivity(t.instance,e).then(r=>{this.activity$.next(r),n=!0}).catch(r=>this.messageService.showError(r))}disconnect(){this.activitySubscription?.cancel(),this.activitySubscription=void 0}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Pt({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Ii=["logContainer"],Ei=["top"],Oi=["bottom"];function ki(i,e){if(i&1&&(o(0,"tr")(1,"td",11),c(2),a(),o(3,"td",12),c(4),f(5,"datetime"),a(),o(6,"td",13),c(7),a()()),i&2){let t=e.$implicit,n=e.$index;N("activity",t.source==="ACTIVITY")("service",t.source==="SERVICE")("warning",t.level==="WARNING")("error",t.level==="ERROR"),s(2),S(n+1),s(2),x(" [",it(5,11,t.time,!1),"] "),s(3),S(t.message)}}function Li(i,e){i&1&&(o(0,"tr")(1,"td",14),d(2,"ya-dots"),a()())}function Pi(i,e){i&1&&m(0,Li,3,0,"tr"),i&2&&v(e.stop?-1:0)}var Tt=class i{constructor(e,t,n,r){this.yamcs=e;this.messageService=t;this.syncService=n;this.activityId=I.required();this.archivedLogs=[];this.realtimeLogs=[];this.logs$=new A([]);this.dirty$=new A(!1);this.activity$=r.activity$}ngOnInit(){let{yamcs:e}=this;this.activityLogSubscription=e.yamcsClient.createActivityLogSubscription({instance:e.instance,activity:this.activityId()},t=>{for(let n of this.archivedLogs)if(t.time===n.time&&t.level===n.level&&t.message===n.message&&t.source===n.source)return;this.realtimeLogs.push(t),this.dirty$.next(!0)}),e.yamcsClient.getActivityLog(e.instance,this.activityId()).then(t=>{this.archivedLogs=t.filter(n=>{for(let r of this.realtimeLogs)if(n.time===r.time&&n.level===r.level&&n.message===r.message&&n.source===r.source)return!1;return!0}),this.emitLogs()}).catch(t=>this.messageService.showError(t)),this.syncSubscription=this.syncService.syncFast(()=>{this.dirty$.value&&(this.emitLogs(),this.dirty$.next(!1))})}emitLogs(){if(this.logs$.next([...this.archivedLogs,...this.realtimeLogs]),this.logContainer){let{nativeElement:e}=this.logContainer;Math.abs(e.scrollHeight-e.clientHeight-e.scrollTop)<=1&&setTimeout(()=>{this.bottomAnchor.nativeElement.scrollIntoView()})}}ngOnDestroy(){this.activityLogSubscription?.cancel(),this.syncSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(y(L),y(O),y(Y),y(z))}}static{this.\u0275cmp=T({type:i,selectors:[["ng-component"]],viewQuery:function(t,n){if(t&1&&(Z(Ii,5),Z(Ei,5),Z(Oi,5)),t&2){let r;tt(r=et())&&(n.logContainer=r.first),tt(r=et())&&(n.topAnchor=r.first),tt(r=et())&&(n.bottomAnchor=r.first)}},inputs:{activityId:[1,"activityId"]},decls:17,vars:5,consts:[["logContainer",""],["top",""],["bottom",""],[1,"log-actions"],["icon","vertical_align_top",3,"click"],["icon","vertical_align_bottom",3,"click"],[1,"log-container"],[1,"top"],[1,"logs","mono",2,"width","100%"],[3,"activity","service","warning","error"],[1,"bottom"],["width","1",2,"text-align","right"],["width","1",1,"time",2,"white-space","nowrap"],[1,"message"],["colspan","3"]],template:function(t,n){if(t&1){let r=b();o(0,"div",3)(1,"ya-button",4),C("click",function(){_(r);let w=V(8);return g(w.scrollIntoView())}),c(2,"Jump to top"),a(),o(3,"ya-button",5),C("click",function(){_(r);let w=V(16);return g(w.scrollIntoView())}),c(4," Jump to bottom "),a()(),o(5,"div",6,0),d(7,"div",7,1),o(9,"table",8),J(10,ki,8,14,"tr",9,X),f(12,"async"),m(13,Pi,1,1),f(14,"async"),a(),d(15,"div",10,2),a()}if(t&2){let r;s(10),K(h(12,1,n.logs$)),s(3),v((r=h(14,3,n.activity$))?13:-1,r)}},dependencies:[D,E,G,dt,$],styles:[".log-container[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12);position:absolute;inset:48px 0 0;overflow:auto;padding-left:12px}.log-actions[_ngcontent-%COMP%]{height:24px;margin:12px;display:flex}.log-actions[_ngcontent-%COMP%]   ya-button[_ngcontent-%COMP%]{margin-right:7px}.extra-bar-container[_ngcontent-%COMP%]{padding:12px;border-bottom:1.1px solid rgba(0,0,0,.08)}.extra-bar[_ngcontent-%COMP%]{height:24px;line-height:24px}.separator[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.12)}table.logs[_ngcontent-%COMP%]{line-height:12px}table.logs[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;color:#000000a7;vertical-align:top}table.logs[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{opacity:.8}table.logs[_ngcontent-%COMP%]   tr.service[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}table.logs[_ngcontent-%COMP%]   td.message[_ngcontent-%COMP%]{white-space:pre-wrap}.top[_ngcontent-%COMP%], .bottom[_ngcontent-%COMP%]{visibility:hidden;line-height:0}.warning[_ngcontent-%COMP%]{color:var(--y-warning-color)!important}.error[_ngcontent-%COMP%]{color:var(--y-error-color)!important}"],changeDetection:0})}};function Fi(i,e){if(i&1&&(o(0,"span",1),c(1),a()),i&2){let t=e;N("successful",t.status==="SUCCESSFUL")("running",t.status==="RUNNING")("failed",t.status==="FAILED")("cancelled",t.status==="CANCELLED"),s(),x(" ",t.status," ")}}var Dt=class i{constructor(){this.activity=I.required()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=T({type:i,selectors:[["app-activity-status"]],inputs:{activity:[1,"activity"]},decls:1,vars:1,consts:[[1,"status",3,"successful","running","failed","cancelled"],[1,"status"]],template:function(t,n){if(t&1&&m(0,Fi,2,9,"span",0),t&2){let r;v((r=n.activity())?0:-1,r)}},dependencies:[D],styles:[".status[_ngcontent-%COMP%]{padding:4px;border-radius:2px}.status.successful[_ngcontent-%COMP%]{background:#28a745;color:#fff}.status.failed[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.status.running[_ngcontent-%COMP%], .status.cancelled[_ngcontent-%COMP%]{background:#eee;color:#333}"],changeDetection:0})}};var Ot=i=>({c:i});function Vi(i,e){if(i&1){let t=b();o(0,"ya-page-button",16),C("clicked",function(){_(t);let r=l(),u=l();return g(u.setSuccessful(r))}),c(1," Set successful "),a(),o(2,"ya-page-button",17),C("clicked",function(){_(t);let r=l(),u=l();return g(u.setFailed(r))}),c(3," Set failed "),a()}}function Ni(i,e){if(i&1){let t=b();o(0,"ya-page-button",18),C("clicked",function(){_(t);let r=l(),u=l();return g(u.cancelActivity(r))}),c(1," Cancel "),a()}if(i&2){let t=l();p("disabled",!!t.stop)}}function $i(i,e){if(i&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),d(2,"ya-page-icon-button",4),c(3," Activity details \xA0\xA0\xA0 "),m(4,Vi,4,0)(5,Ni,2,1,"ya-page-button",5),a(),o(6,"div",6)(7,"div",7)(8,"span",8),c(9),a(),d(10,"br"),o(11,"span",9),c(12),a(),d(13,"br"),o(14,"span",9),c(15),f(16,"datetime"),a(),d(17,"br"),a(),o(18,"div",10),d(19,"app-activity-status",11),a()(),o(20,"nav",12,0)(22,"a",13,1),c(24," Activity Log "),a(),o(25,"a",14,2),c(27," Details "),a()(),o(28,"div",15)(29,"mat-tab-nav-panel",null,3),d(31,"router-outlet"),a()()()),i&2){let t=e,n=V(23),r=V(26),u=V(30),w=l();s(2),p("queryParams",U(15,Ot,w.yamcs.context)),s(2),v(t.type==="MANUAL"&&t.status==="RUNNING"&&w.mayControlActivities()?4:-1),s(),v(w.mayControlActivities()?5:-1),s(4),S(t.detail),s(3),x("ID: ",t.id,""),s(3),x("Started ",h(16,13,t.start),""),s(4),p("activity",t),s(),p("mat-stretch-tabs",!1)("tabPanel",u),s(2),p("active",n.isActive)("queryParams",U(17,Ot,w.yamcs.context)),s(3),p("active",r.isActive)("queryParams",U(19,Ot,w.yamcs.context))}}var wt=class i{constructor(e,t,n,r,u,w){this.yamcs=t;this.messageService=n;this.authService=r;this.dialog=u;this.activityService=w;this.activityId=I.required();this.activity$=w.activity$.pipe(Lt(Mt=>{Mt&&e.setTitle(Mt.detail)}))}ngOnInit(){this.activityService.connect(this.activityId())}mayControlActivities(){return this.authService.getUser().hasSystemPrivilege("ControlActivities")}setSuccessful(e){this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}setFailed(e){this.dialog.open(q,{width:"400px",data:{activity:e}}).afterClosed().subscribe(t=>{t&&this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,e.id,{failureReason:t.failureReason}).catch(n=>this.messageService.showError(n))})}cancelActivity(e){this.yamcs.yamcsClient.cancelActivity(this.yamcs.instance,e.id).catch(t=>this.messageService.showError(t))}ngOnDestroy(){this.activityService.disconnect()}static{this.\u0275fac=function(t){return new(t||i)(y(nt),y(L),y(O),y(vt),y(mt),y(z))}}static{this.\u0275cmp=T({type:i,selectors:[["ng-component"]],inputs:{activityId:[1,"activityId"]},decls:2,vars:3,consts:[["tabs",""],["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["routerLink","..","icon","arrow_back",3,"queryParams"],["icon","cancel",3,"disabled"],[1,"activity-header"],[1,"activity-header-left"],[1,"title"],[1,"subtitle"],[1,"activity-header-right"],[3,"activity"],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","log","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","details","routerLinkActive","",3,"active","queryParams"],[1,"tab-content-wrapper"],["icon","thumb_up",3,"clicked"],["icon","thumb_down",3,"clicked"],["icon","cancel",3,"clicked","disabled"]],template:function(t,n){if(t&1&&(m(0,$i,32,21,"app-instance-page"),f(1,"async")),t&2){let r;v((r=h(1,1,n.activity$))?0:-1,r)}},dependencies:[Dt,yt,ft,D,E,$t,at,Bt,ye,_e,he,ut,Ae,$],styles:[".activity-header[_ngcontent-%COMP%]{height:100px;border-bottom:1px solid rgba(0,0,0,.1);display:flex}.activity-header-left[_ngcontent-%COMP%]{flex:1 1 auto;align-self:center;margin-left:24px;margin-right:24px}.activity-header-left[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:larger}.activity-header-left[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:smaller;color:gray}.activity-header-right[_ngcontent-%COMP%]{flex:1 1 auto;align-self:center;text-align:right;margin-left:24px;margin-right:24px}.tab-content-wrapper[_ngcontent-%COMP%]{position:absolute;inset:137px 0 0;overflow:auto}.tab-content-wrapper.noscroll[_ngcontent-%COMP%]{overflow:hidden}"],changeDetection:0})}};var Ka=[{path:"",canActivate:[Ee,Ie],canActivateChild:[Oe],runGuardsAndResolvers:"always",component:ke,children:[{path:"",pathMatch:"full",component:At},{path:":activityId",component:wt,children:[{path:"",pathMatch:"full",redirectTo:"log"},{path:"log",component:Tt},{path:"details",component:ht}]}]}];export{Ka as ROUTES};
