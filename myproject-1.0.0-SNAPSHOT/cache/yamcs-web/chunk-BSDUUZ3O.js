import{a as Ei}from"./chunk-PVFYJZJB.js";import{a as pn}from"./chunk-EIWKOY65.js";import{a as Zn}from"./chunk-PQPBUCGJ.js";import{e as Wn,f as cn,g as Ft,h as Hn,i as Qn,j as Xn,k as Jn}from"./chunk-UVXAE5YP.js";import{a as U,c as W,d as zn,e as Un}from"./chunk-J6RUEXVW.js";import{$c as Ci,$e as et,Aa as r,Ab as oe,Ac as B,Af as A,Ba as s,Bc as w,Be as Oe,Bf as rt,Ca as Q,Cf as Si,D as wn,Da as X,Eb as Qe,Ec as yt,Fa as L,Fc as vt,Fg as se,Ga as g,Gb as ve,Gc as D,Gf as Gn,Ha as h,Hb as J,Hc as fe,He as Xe,Ie as Je,Jc as kn,Ka as si,Kc as E,Ke as Ze,Lc as de,Le as An,Lf as re,Lg as pt,Ma as Se,Mc as fi,Mf as xi,N as b,Na as xe,Nc as V,Ne as Ln,Nf as at,O as S,Oa as Te,Ra as le,Rc as Nn,Sa as l,Sc as De,Ta as ze,Ua as $,Ue as Pe,Uf as qn,Va as En,Ve as Dt,Vf as Vt,W as li,Wc as Ee,We as Ke,X as ht,Xa as Mn,Xc as me,Xe as Et,Ya as pi,Yc as hi,Ye as Mt,Za as R,_c as Me,_e as Pt,a as Ne,aa as Dn,ag as Be,ba as p,bb as k,bd as gi,bf as tt,cb as N,cd as _i,cf as Bt,da as u,db as Pn,dd as Fn,ef as It,eg as Ti,f as j,ff as it,ga as v,gb as we,gd as Rn,hd as bt,hf as nt,id as St,if as Ye,ih as M,jd as te,ka as He,kf as vi,lf as bi,lh as Nt,ma as _,mb as _t,mc as ui,mg as lt,ng as kt,oh as x,pf as H,ph as $n,qa as c,qb as ee,qf as On,qh as Yn,ra as mi,rb as Bn,rf as ot,rh as jn,sa as ne,sb as ci,sc as In,t as Tn,te as Re,tg as wi,uc as Vn,ue as Ae,ug as mt,va as T,ve as yi,vg as st,wa as ye,wc as I,we as Le,xa as pe,xe as xt,ya as ce,yb as di,yc as C,ye as Tt,yg as Ge,za as a,ze as wt,zg as Di}from"./chunk-MTJQDUEX.js";function Ct(n,t,e){let i=Rn(n,e?.in);return i.setTime(i.getTime()+t*Fn),i}var eo=n=>({c:n}),fo=()=>[];function ho(n,t){if(n&1){let e=L();a(0,"th",20)(1,"input",21),g("change",function(o){b(e);let m=h(2);return S(o?m.masterToggle():null)}),r()()}if(n&2){let e=h(2);p(),c("checked",e.selection.hasValue()&&e.isAllSelected())}}function Co(n,t){if(n&1){let e=L();a(0,"td",22)(1,"input",23),g("click",function(o){return b(e),S(o.stopPropagation())})("change",function(o){let m=b(e).$implicit,d=h(2);return S(o?d.selection.toggle(m):null)}),r()()}if(n&2){let e=t.$implicit,i=h(2);p(),c("checked",i.selection.isSelected(e))}}function go(n,t){n&1&&(a(0,"th",24),l(1,"Label"),r())}function _o(n,t){if(n&1&&l(0),n&2){let e=h().$implicit;$(" ",e.name," ")}}function yo(n,t){n&1&&(a(0,"i"),l(1,"(none)"),r())}function vo(n,t){if(n&1&&(a(0,"td",25)(1,"a",26),_(2,_o,1,1)(3,yo,2,0,"i"),r()()),n&2){let e=t.$implicit,i=h(2);p(),c("routerLink",e.id)("queryParams",R(4,eo,i.yamcs.context)),p(),T(e.name?2:-1),p(),T(e.name?-1:3)}}function bo(n,t){n&1&&(a(0,"th",27),l(1,"Description"),r())}function So(n,t){if(n&1&&(a(0,"td",25),l(1),r()),n&2){let e=t.$implicit;p(),$(" ",e.description||"-"," ")}}function xo(n,t){n&1&&(a(0,"th",28),l(1,"Tags"),r())}function To(n,t){if(n&1&&(a(0,"ya-label"),l(1),r()),n&2){let e=t.$implicit;p(),ze(e)}}function wo(n,t){n&1&&l(0," - ")}function Do(n,t){if(n&1&&(a(0,"td",25),pe(1,To,2,1,"ya-label",null,ye),_(3,wo,1,0),r()),n&2){let e=t.$implicit;p(),ce(e.tags||pi(1,fo)),p(2),T(e.tags?-1:3)}}function Eo(n,t){n&1&&(a(0,"th",24),l(1,"Type"),r())}function Mo(n,t){if(n&1&&(a(0,"td",25),l(1),r()),n&2){let e=t.$implicit;p(),$(" ",e.type," ")}}function Po(n,t){n&1&&s(0,"th",29)}function Bo(n,t){n&1&&s(0,"td",25)}function Io(n,t){n&1&&s(0,"tr",30)}function Vo(n,t){if(n&1){let e=L();a(0,"tr",31),g("click",function(){let o=b(e).$implicit,m=h(2);return S(m.toggleOne(o))}),r()}if(n&2){let e=t.$implicit,i=h(2);ne("selected",i.selection.isSelected(e))}}function ko(n,t){if(n&1&&(a(0,"table",3),Q(1,4),_(2,ho,2,1,"th",5)(3,Co,2,1,"td",6),X(),Q(4,7),_(5,go,2,0,"th",8)(6,vo,4,6,"td",9),X(),Q(7,10),_(8,bo,2,0,"th",11)(9,So,2,1,"td",9),X(),Q(10,12),_(11,xo,2,0,"th",13)(12,Do,4,2,"td",14),X(),Q(13,15),_(14,Eo,2,0,"th",8)(15,Mo,2,1,"td",9),X(),Q(16,16),_(17,Po,1,0,"th",17)(18,Bo,1,0,"td",9),X(),_(19,Io,1,0,"tr",18)(20,Vo,1,2,"tr",19),r()),n&2){let e=h();c("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),p(19),c("matHeaderRowDef",e.displayedColumns),p(),c("matRowDefColumns",e.displayedColumns)}}var Mi=class n{constructor(t,e,i){this.yamcs=t;this.messageService=i;this.displayedColumns=["select","name","description","tags","type","actions"];this.tableTrackerFn=(t,e)=>e.id;this.dataSource=new Ye;this.selection=new Nt(this.tableTrackerFn,!0,[]);e.setTitle("Timeline Bands"),this.refreshData()}ngAfterViewInit(){this.dataSource.sort=this.sort}isAllSelected(){let t=this.selection.selected.length,e=this.dataSource.filteredData.length;return t===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}deleteSelectedBands(){if(confirm("Are you sure you want to delete the selected bands?"))for(let t of this.selection.selected)this.deleteBand(t.id,!1)}deleteBand(t,e=!0){(!e||confirm("Are you sure you want to delete the selected band?"))&&this.yamcs.yamcsClient.deleteTimelineBand(this.yamcs.instance,t).then(()=>this.refreshData()).catch(i=>this.messageService.showError(i))}isGroupDeleteEnabled(){return!this.selection.isEmpty()}refreshData(){this.yamcs.yamcsClient.getTimelineBands(this.yamcs.instance).then(t=>{this.selection.matchNewValues(t.bands||[]),this.dataSource.data=t.bands||[]}).catch(t=>this.messageService.showError(t))}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(oe),u(H))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Se(Pe,5),e&2){let o;xe(o=Te())&&(i.sort=o.first)}},decls:9,vars:5,consts:[["routerLink","create","icon","add_circle_outline",3,"queryParams"],["icon","close",3,"clicked","disabled"],[1,"panel-content"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","","class","wrap200",4,"matHeaderCellDef"],["cdkColumnDef","tags"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink","queryParams"],["mat-header-cell","",1,"wrap200"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2," Bands \xA0\xA0\xA0 "),a(3,"ya-page-button",0),l(4," Create band "),r(),a(5,"ya-page-button",1),g("clicked",function(){return i.deleteSelectedBands()}),l(6," Delete "),r()(),a(7,"div",2),_(8,ko,21,4,"table",3),r()()),e&2&&(p(3),c("queryParams",R(3,eo,i.yamcs.context)),p(2),c("disabled",!i.isGroupDeleteEnabled()),p(3),T(i.dataSource?8:-1))},dependencies:[W,U,x,J,Xe,Je,Ze,Pe,Dt,Ke,Mt,Bt,Pt,Et,It,et,tt,it,nt,Ti,lt],encapsulation:2,changeDetection:0})}};var he=class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-create-band-wizard-step"]],inputs:{step:"step"},decls:8,vars:4,consts:[[1,"sub"]],template:function(e,i){e&1&&(a(0,"mat-toolbar",0)(1,"mat-toolbar-row")(2,"span")(3,"span"),l(4,"1. Select band type"),r(),l(5," \xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),a(6,"span"),l(7,"2. Configure band"),r()()()()),e&2&&(p(3),ne("active",i.step==="1"),p(3),ne("active",i.step==="2"))},dependencies:[x,St,bt],styles:["span[_ngcontent-%COMP%]{cursor:default}span[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3}span[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}mat-toolbar.sub[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;font-size:12px}.mat-toolbar-row[_ngcontent-%COMP%]{height:32px;padding:0 24px}.mat-toolbar-multiple-rows[_ngcontent-%COMP%]{min-height:32px}"],changeDetection:0})}};var No=n=>({c:n}),Pi=class n{constructor(t,e,i,o,m){this.yamcs=i;this.messageService=o;this.router=m;t.setTitle("Configure Command Band"),this.form=e.group({name:["",[C.required]],description:"",properties:e.group({})})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:t.name,description:t.description,type:"COMMAND_BAND",shared:!0,properties:t.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(me),u(M),u(H),u(ve))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:29,vars:5,consts:[["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[1,"section-divider"],[1,"action-bar"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Create band"),r(),s(3,"app-create-band-wizard-step",0),a(4,"div",1)(5,"form",2)(6,"label"),l(7," Label "),a(8,"span",3),l(9,"(required)"),r(),s(10,"br")(11,"input",4),r(),s(12,"br"),a(13,"label"),l(14," Description "),a(15,"span",3),l(16,"(optional)"),r(),s(17,"br")(18,"textarea",5),r(),s(19,"br"),a(20,"div",6),s(21,"mat-divider"),r()(),a(22,"p"),l(23,"\xA0"),r(),a(24,"div",7)(25,"ya-button",8),l(26,"Cancel"),r(),a(27,"ya-button",9),g("click",function(){return i.onConfirm()}),l(28," CREATE "),r()()()()),e&2&&(p(5),c("formGroup",i.form),p(20),c("queryParams",R(3,No,i.yamcs.context)),p(2),c("disabled",!i.form.valid))},dependencies:[he,W,U,x,D,I,B,w,E,V,J,te,A],encapsulation:2,changeDetection:0})}};var gt=n=>({c:n}),Bi=class n{constructor(t,e){this.yamcs=e;t.setTitle("Create a band")}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(M))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:50,vars:21,consts:[["routerLink","..","icon","arrow_back",3,"queryParams"],["step","1"],[1,"panel-content"],[1,"category-title"],[1,"band-type-list"],["routerLink","time-ruler",1,"band-type",3,"queryParams"],[1,"card"],[1,"card-title"],[1,"card-content"],["routerLink","item-band",1,"band-type",3,"queryParams"],["routerLink","spacer",1,"band-type",3,"queryParams"],["routerLink","parameter-plot",1,"band-type",3,"queryParams"],["routerLink","parameter-states",1,"band-type",3,"queryParams"],["routerLink","command-band",1,"band-type",3,"queryParams"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),s(2,"ya-page-icon-button",0),l(3," Create band "),r(),s(4,"app-create-band-wizard-step",1),a(5,"div",2)(6,"div",3),l(7,"General"),r(),a(8,"div",4)(9,"a",5)(10,"div",6)(11,"div",7),l(12,"Time ruler"),r(),a(13,"div",8),l(14,"Display absolute time, formatted in a timezone of choice."),r()()(),a(15,"a",9)(16,"div",6)(17,"div",7),l(18,"Item band"),r(),a(19,"div",8),l(20,"Show a selection of timeline items."),r()()(),a(21,"a",10)(22,"div",6)(23,"div",7),l(24,"Spacer"),r(),a(25,"div",8),l(26,"Insert empty vertical space."),r()()()(),a(27,"p"),l(28,"\xA0"),r(),a(29,"div",3),l(30,"Yamcs content"),r(),a(31,"div",4)(32,"a",11)(33,"div",6)(34,"div",7),l(35,"Parameter plot"),r(),a(36,"div",8),l(37,"Plot the values of a numeric parameter."),r()()(),a(38,"a",12)(39,"div",6)(40,"div",7),l(41,"Parameter states"),r(),a(42,"div",8),l(43,"Show state transitions of a parameter."),r()()(),a(44,"a",13)(45,"div",6)(46,"div",7),l(47,"Commands"),r(),a(48,"div",8),l(49,"Display issued commands."),r()()()()()()),e&2&&(p(2),c("queryParams",R(7,gt,i.yamcs.context)),p(7),c("queryParams",R(9,gt,i.yamcs.context)),p(6),c("queryParams",R(11,gt,i.yamcs.context)),p(6),c("queryParams",R(13,gt,i.yamcs.context)),p(11),c("queryParams",R(15,gt,i.yamcs.context)),p(6),c("queryParams",R(17,gt,i.yamcs.context)),p(6),c("queryParams",R(19,gt,i.yamcs.context)))},dependencies:[he,W,U,x,J,kt],styles:["div.category-title[_ngcontent-%COMP%]{font-size:18px;line-height:1.5;margin-bottom:1em}a.band-type[_ngcontent-%COMP%]{display:inline-block;width:260px;margin-right:20px;margin-bottom:20px;vertical-align:top;text-decoration:none}.card[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12);background:#fff;border-radius:4px;overflow:hidden}.card-title[_ngcontent-%COMP%]{align-items:center;display:flex;padding:15px;font-size:20px;font-weight:500;color:#000000de}.card-content[_ngcontent-%COMP%]{padding:0 15px 15px;min-height:2.4em;font-size:15px;color:#0000008a}a.band-type[_ngcontent-%COMP%]:hover   .card[_ngcontent-%COMP%]{background-color:#f2f2f2}"],changeDetection:0})}};function Ro(n,t){n&1&&(a(0,"th",15),l(1,"Available"),r())}function Ao(n,t){if(n&1&&l(0),n&2){let e=h().$implicit;$(" ",e.name," ")}}function Lo(n,t){n&1&&(a(0,"i"),l(1,"(no name)"),r())}function Oo(n,t){if(n&1&&(s(0,"br"),a(1,"span",17),l(2),r()),n&2){let e=h().$implicit;p(2),ze(e.description)}}function Go(n,t){if(n&1&&(a(0,"td",16),_(1,Ao,1,1)(2,Lo,2,0,"i")(3,Oo,3,1),r()),n&2){let e=t.$implicit;p(),T(e.name?1:-1),p(),T(e.name?-1:2),p(),T(e.description?3:-1)}}function qo(n,t){n&1&&s(0,"tr",18)}function $o(n,t){if(n&1){let e=L();a(0,"tr",19),g("click",function(){let o=b(e).$implicit,m=h();return S(m.selectBand(o))}),r()}if(n&2){let e=t.$implicit,i=h();ne("selected",i.isLeftSelected(e))}}function zo(n,t){n&1&&(a(0,"th",15),l(1,"Selected"),r())}function Yo(n,t){if(n&1&&l(0),n&2){let e=h().$implicit;$(" ",e.name," ")}}function jo(n,t){n&1&&(a(0,"i"),l(1,"(no name)"),r())}function Uo(n,t){if(n&1&&(s(0,"br"),a(1,"span",17),l(2),r()),n&2){let e=h().$implicit;p(2),ze(e.description)}}function Wo(n,t){if(n&1&&(a(0,"td",16),_(1,Yo,1,1)(2,jo,2,0,"i")(3,Uo,3,1),r()),n&2){let e=t.$implicit;p(),T(e.name?1:-1),p(),T(e.name?-1:2),p(),T(e.description?3:-1)}}function Ho(n,t){n&1&&s(0,"tr",18)}function Qo(n,t){if(n&1){let e=L();a(0,"tr",19),g("click",function(){let o=b(e).$implicit,m=h();return S(m.selectBand(o))}),r()}if(n&2){let e=t.$implicit,i=h();ne("selected",i.isRightSelected(e))}}var ct=class n{constructor(t){this.displayedColumns=["name"];this.availableDataSource=new Ye([]);this.selectedDataSource=new Ye([]);this.onChange=t=>{};this.bands$=t.yamcsClient.getTimelineBands(t.instance),this.bands$.then(e=>{this.availableDataSource.data=e.bands||[]})}writeValue(t){this.bands$.then(e=>{let i=e.bands||[];if(t){let o=t.map(f=>f.id),m=[],d=[];for(let f of i)o.indexOf(f.id)===-1&&m.push(f);for(let f of o)for(let y of i)y.id===f&&d.push(y);this.availableDataSource.data=m,this.selectedDataSource.data=d}else this.availableDataSource.data=[...i],this.selectedDataSource.data=[]})}registerOnChange(t){this.onChange=t}registerOnTouched(t){}selectBand(t){this.selectedBand=t}isLeftSelected(t){return t===this.selectedBand&&this.availableDataSource.data.indexOf(t)!==-1}isAnyLeftSelected(){return this.selectedBand&&this.availableDataSource.data.indexOf(this.selectedBand)!==-1}isRightSelected(t){return t===this.selectedBand&&this.selectedDataSource.data.indexOf(t)!==-1}isAnyRightSelected(){return this.selectedBand&&this.selectedDataSource.data.indexOf(this.selectedBand)!==-1}moveRight(){let t=this.selectedBand,e=[...this.availableDataSource.data],i=[...this.selectedDataSource.data],o=e.indexOf(t);o!==-1&&e.splice(o,1),i.indexOf(t)===-1&&i.push(t),this.availableDataSource.data=e,this.selectedDataSource.data=i,this.onChange(i)}moveLeft(){let t=this.selectedBand,e=[...this.availableDataSource.data],i=[...this.selectedDataSource.data],o=i.indexOf(t);o!==-1&&i.splice(o,1),e.indexOf(t)===-1&&e.push(t),this.availableDataSource.data=e,this.selectedDataSource.data=i,this.onChange(i)}moveUp(){let t=this.selectedBand,e=[...this.selectedDataSource.data],i=e.indexOf(t);i!==0&&(e[i]=e[i-1],e[i-1]=t),this.selectedDataSource.data=e,this.onChange(e)}moveDown(){let t=this.selectedBand,e=[...this.selectedDataSource.data],i=e.indexOf(t);i!==e.length-1&&(e[i]=e[i+1],e[i+1]=t),this.selectedDataSource.data=e,this.onChange(e)}static{this.\u0275fac=function(e){return new(e||n)(u(M))}}static{this.\u0275cmp=v({type:n,selectors:[["app-band-multi-select"]],features:[Mn([{provide:Vn,useExisting:wn(()=>n),multi:!0}])],decls:28,vars:10,consts:[[2,"display","flex"],[1,"bands-from"],["mat-table","",1,"ya-data-table",2,"width","100%",3,"dataSource"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],[2,"display","inline-block","margin","1em","align-self","center"],[2,"width","90px",3,"click","disabled"],[1,"icon12"],[1,"bands-to"],[2,"text-align","right"],["icon","keyboard_arrow_down",3,"click","disabled"],["icon","keyboard_arrow_up",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],[1,"hint"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"table",2),Q(3,3),_(4,Ro,2,0,"th",4)(5,Go,4,3,"td",5),X(),_(6,qo,1,0,"tr",6)(7,$o,1,2,"tr",7),r()(),a(8,"div",8)(9,"ya-button",9),g("click",function(){return i.moveRight()}),l(10," Add "),a(11,"mat-icon",10),l(12,"chevron_right"),r()(),s(13,"br"),a(14,"ya-button",9),g("click",function(){return i.moveLeft()}),a(15,"mat-icon",10),l(16,"chevron_left"),r(),l(17," Remove "),r()(),a(18,"div",11)(19,"table",2),Q(20,3),_(21,zo,2,0,"th",4)(22,Wo,4,3,"td",5),X(),_(23,Ho,1,0,"tr",6)(24,Qo,1,2,"tr",7),r()()(),a(25,"div",12)(26,"ya-button",13),g("click",function(){return i.moveDown()}),r(),a(27,"ya-button",14),g("click",function(){return i.moveUp()}),r()()),e&2&&(p(2),c("dataSource",i.availableDataSource),p(4),c("cdkHeaderRowDef",i.displayedColumns),p(),c("cdkRowDefColumns",i.displayedColumns),p(2),c("disabled",!i.isAnyLeftSelected()),p(5),c("disabled",!i.isAnyRightSelected()),p(5),c("dataSource",i.selectedDataSource),p(4),c("cdkHeaderRowDef",i.displayedColumns),p(),c("cdkRowDefColumns",i.displayedColumns),p(2),c("disabled",!i.isAnyRightSelected()),p(),c("disabled",!i.isAnyRightSelected()))},dependencies:[x,Ln,Xe,Je,Ze,An,hi,Ke,et,tt,it,nt,A],styles:[".bands-from[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]{border:1px solid #d3d3d3;flex:1 1 auto}.bands-from[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}.bands-from[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer}.bands-from[_ngcontent-%COMP%]   table[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-left:none;border-right:none}.bands-from[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none}.bands-from[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-of-type   td[_ngcontent-%COMP%], .bands-to[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-of-type{border-bottom:none}"],changeDetection:0})}};var io=n=>({c:n}),Ii=class n{constructor(t,e,i,o,m){this.yamcs=e;this.formBuilder=i;this.messageService=o;this.router=m;t.setTitle("Create a View"),this.form=this.formBuilder.group({name:["",[C.required]],bands:[[],[]]})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineView(this.yamcs.instance,{name:t.name,bands:t.bands.map(e=>e.id)}).then(e=>this.router.navigateByUrl(`/timeline/chart?c=${this.yamcs.context}&view=${e.id}`)).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(M),u(me),u(H),u(ve))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:25,vars:8,consts:[["routerLink","..","icon","arrow_back",3,"queryParams"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name"],[1,"section-divider"],["formControlName","bands"],[1,"action-bar"],["routerLink","..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),s(2,"ya-page-icon-button",0),l(3," Create view "),r(),a(4,"div",1)(5,"form",2)(6,"label"),l(7," Name "),a(8,"span",3),l(9,"(required)"),r(),s(10,"br")(11,"input",4),r(),s(12,"br"),a(13,"div",5),s(14,"mat-divider"),r(),a(15,"h4"),l(16,"Bands"),r(),s(17,"app-band-multi-select",6),r(),a(18,"p"),l(19,"\xA0"),r(),a(20,"div",7)(21,"ya-button",8),l(22,"Cancel"),r(),a(23,"ya-button",9),g("click",function(){return i.onConfirm()}),l(24," CREATE "),r()()()()),e&2&&(p(2),c("queryParams",R(4,io,i.yamcs.context)),p(3),c("formGroup",i.form),p(16),c("queryParams",R(6,io,i.yamcs.context)),p(2),c("disabled",!i.form.valid))},dependencies:[ct,W,U,x,D,I,B,w,E,V,J,te,A,kt],encapsulation:2,changeDetection:0})}};function Xo(n,t){if(n&1&&(a(0,"form",0)(1,"label"),l(2," Label "),a(3,"span",1),l(4,"(required)"),r(),s(5,"br")(6,"input",2),r(),s(7,"br"),a(8,"label"),l(9," Description "),a(10,"span",1),l(11,"(optional)"),r(),s(12,"br")(13,"textarea",3),r()()),n&2){let e=h();c("formGroup",e.form)}}var Rt=class n{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new j(!1)}ngAfterViewInit(){this.formConfigured$.next(!0),this.changeDetection.detectChanges()}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(we))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-command-band"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"]],template:function(e,i){e&1&&(_(0,Xo,14,1,"form",0),k(1,"async")),e&2&&T(N(1,1,i.formConfigured$)?0:-1)},dependencies:[x,ee,D,I,B,w,E,V],encapsulation:2,changeDetection:0})}};var no={};function fn(n){let t=no[n];if(!t){let e=document.createElement("canvas").getContext("2d");e.fillStyle=n,t=String(e.fillStyle),no[n]=t}return t}var Ve=class{constructor(t){this.inputType=0;this.defaultValue=t}},ge=class{constructor(t){this.inputType=1;this.defaultValue=t}},z=class{constructor(t){this.inputType=2;this.defaultValue=t}},je=class{constructor(t){this.inputType=4;this.defaultValue=t}},Vi=class{constructor(t){this.inputType=3;this.defaultValue=t}};function ie(n,t){let e={};for(let i in n)e[i]=n[i].defaultValue;return Ne(Ne({},e),Jo(n,t))}function dt(n){for(let t in n)(n[t]===null||n[t]==="")&&delete n[t]}function Jo(n,t){let e={};for(let i in t){let o=n[i];o&&(o.inputType===0?e[i]=t[i]==="true":o.inputType===2?e[i]=Number(t[i]):o.inputType===1?e[i]=fn(t[i]):(o.inputType===4||o.inputType===3||console.warn(`Unexpected property input type for ${i}`,o?.inputType),e[i]=t[i]))}return e}var ut=class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-item-styles"]],inputs:{form:"form"},decls:53,vars:15,consts:[["backgroundColor_overrideBand",""],["textColor_overrideBand",""],["textSize_overrideBand",""],["marginLeft_overrideBand",""],["borderColor_overrideBand",""],["borderWidth_overrideBand",""],["cornerRadius_overrideBand",""],[1,"hint"],[3,"formGroup"],["yaSimpleTable","","formGroupName","properties",1,"style-table"],[1,"property"],["formControlName","backgroundColor_overrideBand"],[1,"widget"],["type","color","formControlName","backgroundColor"],["formControlName","textColor_overrideBand"],["type","color","formControlName","textColor"],["formControlName","textSize_overrideBand"],["type","number","formControlName","textSize","min","0",2,"width","100px"],["formControlName","marginLeft_overrideBand"],["type","number","formControlName","marginLeft","min","0",2,"width","100px"],["formControlName","borderColor_overrideBand"],["type","color","formControlName","borderColor"],["formControlName","borderWidth_overrideBand"],["type","number","formControlName","borderWidth","min","0",2,"width","100px"],["formControlName","cornerRadius_overrideBand"],["type","number","formControlName","cornerRadius","min","0",2,"width","100px"]],template:function(e,i){if(e&1&&(a(0,"p",7),l(1,"When unset, items inherit the styling of the band they are displayed on."),r(),a(2,"form",8)(3,"table",9)(4,"tr")(5,"td",10),s(6,"mat-slide-toggle",11,0),l(8," Background Color "),r(),a(9,"td",12),s(10,"input",13),r()(),a(11,"tr")(12,"td",10),s(13,"mat-slide-toggle",14,1),l(15," Text Color "),r(),a(16,"td",12),s(17,"input",15),r()(),a(18,"tr")(19,"td",10),s(20,"mat-slide-toggle",16,2),l(22," Text Size "),r(),a(23,"td",12),s(24,"input",17),r()(),a(25,"tr")(26,"td",10),s(27,"mat-slide-toggle",18,3),l(29," Margin Left "),r(),a(30,"td",12),s(31,"input",19),r()(),a(32,"tr")(33,"td",10),s(34,"mat-slide-toggle",20,4),l(36," Border Color "),r(),a(37,"td",12),s(38,"input",21),r()(),a(39,"tr")(40,"td",10),s(41,"mat-slide-toggle",22,5),l(43," Border Width "),r(),a(44,"td",12),s(45,"input",23),r()(),a(46,"tr")(47,"td",10),s(48,"mat-slide-toggle",24,6),l(50," Corner Radius "),r(),a(51,"td",12),s(52,"input",25),r()()()()),e&2){let o=le(7),m=le(14),d=le(21),f=le(28),y=le(35),P=le(42),F=le(49);p(2),c("formGroup",i.form),p(2),ne("disabled",!o.checked),p(7),ne("disabled",!m.checked),p(7),ne("disabled",!d.checked),p(7),ne("disabled",!f.checked),p(7),ne("disabled",!y.checked),p(7),ne("disabled",!P.checked),p(7),ne("disabled",!F.checked)}},dependencies:[x,D,I,fe,B,w,De,E,V,de,se,Oe],styles:[".style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0})}};var oo="_overrideBand",Ni=class n{constructor(t,e,i,o,m){this.dialogRef=t;this.yamcs=i;this.messageService=o;this.data=m;this.resolutionOptions=[{id:"seconds",label:"seconds"},{id:"minutes",label:"minutes"},{id:"hours",label:"hours"}];this.startConstraintOptions=[{id:"START_ON",label:"Start on"}];let d=m.item,f=d.properties||{},y=ie(Lt,f);this.form=e.group({name:[d.name,C.required],start:[d.start,C.required],duration:[d.duration,C.required],tags:[d.tags||[],[]],properties:e.group({backgroundColor:[y.backgroundColor,[]],backgroundColor_overrideBand:"backgroundColor"in f,borderColor:[y.borderColor,[]],borderColor_overrideBand:"borderColor"in f,borderWidth:[y.borderWidth,[]],borderWidth_overrideBand:"borderWidth"in f,cornerRadius:[y.cornerRadius,[]],cornerRadius_overrideBand:"cornerRadius"in f,marginLeft:[y.marginLeft,[]],marginLeft_overrideBand:"marginLeft"in f,textColor:[y.textColor,[]],textColor_overrideBand:"textColor"in f,textSize:[y.textSize,[]],textSize_overrideBand:"textSize"in f})}),this.updateDisabledState(),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.updateDisabledState()})}save(){let t=this.form.value,e={name:t.name,start:re.toISOString(t.start),duration:t.duration,tags:t.tags,properties:t.properties};this.yamcs.yamcsClient.updateTimelineItem(this.yamcs.instance,this.data.item.id,e).then(i=>this.dialogRef.close(i)).catch(i=>this.messageService.showError(i))}delete(){confirm("Are you sure you want to delete this item?")&&this.yamcs.yamcsClient.deleteTimelineItem(this.yamcs.instance,this.data.item.id).then(()=>this.dialogRef.close()).catch(t=>this.messageService.showError(t))}updateDisabledState(){let{controls:t}=this.propertiesGroup;for(let e in t)if(e.endsWith(oo)){let i=t[e.substring(0,e.length-oo.length)];t[e].value?i.enable({onlySelf:!0}):i.disable({onlySelf:!0})}}get propertiesGroup(){return this.form.controls.properties}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(Re),u(me),u(M),u(H),u(Ae))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:39,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["animationDuration","0ms",1,"small-tabs",3,"mat-stretch-tabs"],["label","General"],[2,"margin-top","1em"],["cdkFocusRegionstart","","type","text","formControlName","name",2,"width","100%"],[1,"half-break"],["dialogTitle","Tags"],["formControlName","tags"],["formControlName","duration"],[1,"section-divider","half-break"],["formControlName","start"],["label","Styles"],[3,"form"],["align","end"],[3,"click"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),l(1,"Update item"),r(),a(2,"mat-dialog-content")(3,"form",1)(4,"mat-tab-group",2)(5,"mat-tab",3)(6,"div",4)(7,"label"),l(8," Name "),s(9,"br")(10,"input",5),r(),s(11,"hr",6),a(12,"label"),l(13," Tags "),a(14,"ya-help",7),l(15," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),r(),s(16,"br")(17,"ya-tag-select",8),r(),s(18,"hr",6),a(19,"label"),l(20," Duration "),s(21,"ya-duration-input",9),r(),a(22,"div",10),s(23,"mat-divider"),r(),a(24,"label"),l(25," Start "),s(26,"br")(27,"ya-date-time-input",11),r()()(),a(28,"mat-tab",12)(29,"div",4),s(30,"app-item-styles",13),r()()()()(),a(31,"mat-dialog-actions",14)(32,"ya-button",15),g("click",function(){return i.delete()}),l(33,"DELETE THIS ITEM"),r(),s(34,"div",16),a(35,"ya-button",17),l(36,"CANCEL"),r(),a(37,"ya-button",18),g("click",function(){return i.save()}),l(38,"SAVE"),r()()),e&2&&(p(3),c("formGroup",i.form),p(),c("mat-stretch-tabs",!1),p(26),c("form",i.form),p(7),c("disabled",!i.form.valid))},dependencies:[ut,x,D,I,B,w,E,V,Le,xt,wt,Tt,te,vi,bi,A,at,Vt,Be,Ge],encapsulation:2,changeDetection:0})}};var K={frozen:new Ve(!1),itemBackgroundColor:new ge("#77b1e1"),itemBorderColor:new ge("#3d94c7"),itemBorderWidth:new z(1),itemCornerRadius:new z(0),itemHeight:new z(20),itemMarginLeft:new z(5),itemTextColor:new ge("#333333"),itemTextOverflow:new Vi("show"),itemTextSize:new z(10),marginBottom:new z(7),marginTop:new z(7),multiline:new Ve(!0),spaceBetweenItems:new z(0),spaceBetweenLines:new z(2)},Lt={backgroundColor:new ge(K.itemBackgroundColor.defaultValue),borderColor:new ge(K.itemBorderColor.defaultValue),borderWidth:new z(K.itemBorderWidth.defaultValue),cornerRadius:new z(K.itemCornerRadius.defaultValue),marginLeft:new z(K.itemMarginLeft.defaultValue),textColor:new ge(K.itemTextColor.defaultValue),textSize:new z(K.itemTextSize.defaultValue)},ti=class extends Ft{constructor(t,e,i){super(t.timeline),this.label=e.name,this.data={band:e};let o=ie(K,e.properties||{});this.frozen=o.frozen,this.itemBackground=o.itemBackgroundColor,this.itemBorderColor=o.itemBorderColor,this.itemBorderWidth=o.itemBorderWidth,this.itemCornerRadius=o.itemCornerRadius,this.itemHeight=o.itemHeight,this.itemPaddingLeft=o.itemMarginLeft,this.itemTextColor=o.itemTextColor,this.itemTextOverflow=o.itemTextOverflow,this.itemTextSize=o.itemTextSize,this.paddingBottom=o.marginBottom,this.paddingTop=o.marginTop,this.multiline=o.multiline,this.spaceBetween=o.spaceBetweenItems,this.lineSpacing=o.spaceBetweenLines,this.addItemClickListener(m=>{i.open(Ni,{width:"600px",panelClass:"dialog-force-no-scrollbar",data:{item:m.item.data.item}}).afterClosed().subscribe(()=>t.refreshData())})}};var Ot=class n{constructor(){this.itemTextOverflowOptions=[{id:"show",label:"Show"},{id:"clip",label:"Clip"},{id:"hide",label:"Hide"}]}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-item-band-styles"]],inputs:{form:"form"},decls:85,vars:2,consts:[[3,"formGroup"],["yaSimpleTable","","formGroupName","properties",1,"style-table"],[1,"property"],["dialogTitle","Frozen"],[1,"widget"],["formControlName","frozen"],["dialogTitle","Multiline"],["formControlName","multiline"],["dialogTitle","Space Between Lines"],["type","number","formControlName","spaceBetweenLines","min","0",2,"width","100px"],["dialogTitle","Space Between Items"],["type","number","formControlName","spaceBetweenItems","min","0",2,"width","100px"],["type","number","formControlName","marginTop","min","0",2,"width","100px"],["type","number","formControlName","marginBottom","min","0",2,"width","100px"],["type","number","formControlName","itemHeight","min","0",2,"width","100px"],["type","color","formControlName","itemBackgroundColor"],["type","color","formControlName","itemTextColor"],["formControlName","itemTextOverflow",3,"options"],["type","number","formControlName","itemTextSize","min","0",2,"width","100px"],["type","number","formControlName","itemMarginLeft","min","0",2,"width","100px"],["type","color","formControlName","itemBorderColor"],["type","number","formControlName","itemBorderWidth","min","0",2,"width","100px"],["type","number","formControlName","itemCornerRadius","min","0",2,"width","100px"]],template:function(e,i){e&1&&(a(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4," Frozen "),a(5,"ya-help",3),l(6," Fix this line to the top of the view. Frozen bands are always rendered above other bands. "),r()(),a(7,"td",4),s(8,"mat-slide-toggle",5),r()(),a(9,"tr")(10,"td",2),l(11," Multiline "),a(12,"ya-help",6),l(13," Draw items on multiple lines if otherwise there would be collisions. "),r()(),a(14,"td",4),s(15,"mat-slide-toggle",7),r()(),a(16,"tr")(17,"td",2),l(18," Space Between Lines "),a(19,"ya-help",8),l(20," In case of multilining, this indicates the vertical space between lines. "),r()(),a(21,"td",4),s(22,"input",9),r()(),a(23,"tr")(24,"td",2),l(25," Space Between Items "),a(26,"ya-help",10),l(27," In case of multilining, this indicates the minimum horizontal space between items. If an item does not meet this treshold, it gets rendered on a different line. "),r()(),a(28,"td",4),s(29,"input",11),r()(),a(30,"tr")(31,"td",2),l(32,"Margin Top"),r(),a(33,"td",4),s(34,"input",12),r()(),a(35,"tr")(36,"td",2),l(37,"Margin Bottom"),r(),a(38,"td",4),s(39,"input",13),r()(),a(40,"tr")(41,"td",2),l(42,"Item Height"),r(),a(43,"td",4),s(44,"input",14),r()(),a(45,"tr")(46,"td",2),l(47,"Item Background Color"),r(),a(48,"td",4),s(49,"input",15),r()(),a(50,"tr")(51,"td",2),l(52,"Item Text Color"),r(),a(53,"td",4),s(54,"input",16),r()(),a(55,"tr")(56,"td",2),l(57,"Item Text Overflow"),r(),a(58,"td",4),s(59,"ya-select",17),r()(),a(60,"tr")(61,"td",2),l(62,"Item Text Size"),r(),a(63,"td",4),s(64,"input",18),r()(),a(65,"tr")(66,"td",2),l(67,"Item Margin Left"),r(),a(68,"td",4),s(69,"input",19),r()(),a(70,"tr")(71,"td",2),l(72,"Item Border Color"),r(),a(73,"td",4),s(74,"input",20),r()(),a(75,"tr")(76,"td",2),l(77,"Item Border Width"),r(),a(78,"td",4),s(79,"input",21),r()(),a(80,"tr")(81,"td",2),l(82,"Item Corner Radius"),r(),a(83,"td",4),s(84,"input",22),r()()()()),e&2&&(c("formGroup",i.form),p(59),c("options",i.itemTextOverflowOptions))},dependencies:[x,D,I,fe,B,w,De,E,V,de,se,Oe,Be,qn],styles:[".style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0})}};function Ko(n,t){if(n&1&&(a(0,"form",0)(1,"label"),l(2," Label "),a(3,"span",1),l(4,"(required)"),r(),s(5,"br")(6,"input",2),r(),s(7,"br"),a(8,"label"),l(9," Description "),a(10,"span",1),l(11,"(optional)"),r(),s(12,"br")(13,"textarea",3),r(),s(14,"br"),a(15,"label"),l(16," Tags"),s(17,"br")(18,"ya-tag-select",4),r(),s(19,"br"),a(20,"div",5),s(21,"mat-divider"),r(),a(22,"h4"),l(23,"Styles"),r(),s(24,"app-item-band-styles",6),r()),n&2){let e=h();c("formGroup",e.form),p(24),c("form",e.form)}}var Gt=class n{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new j(!1)}ngAfterViewInit(){let t=ie(K,this.band.properties||{}),e={frozen:[t.frozen,[C.required]],itemBackgroundColor:[t.itemBackgroundColor,[C.required]],itemBorderColor:[t.itemBorderColor,[C.required]],itemBorderWidth:[t.itemBorderWidth,[C.required]],itemCornerRadius:[t.itemCornerRadius,[C.required]],itemHeight:[t.itemHeight,[C.required]],itemMarginLeft:[t.itemMarginLeft,[C.required]],itemTextColor:[t.itemTextColor,[C.required]],itemTextOverflow:[t.itemTextOverflow,[C.required]],itemTextSize:[t.itemTextSize,[C.required]],marginBottom:[t.marginBottom,[C.required]],marginTop:[t.marginTop,[C.required]],multiline:[t.multiline,[C.required]],spaceBetweenItems:[t.spaceBetweenItems,[C.required]],spaceBetweenLines:[t.spaceBetweenLines,[C.required]]},i=this.form.get("properties");for(let o in e){let m=e[o];i.addControl(o,new yt(m[0],m[1]))}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(we))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-item-band"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],[1,"hint"],["type","text","formControlName","name"],["formControlName","description","rows","3"],["formControlName","tags"],[1,"section-divider"],[3,"form"]],template:function(e,i){e&1&&(_(0,Ko,25,2,"form",0),k(1,"async")),e&2&&T(N(1,1,i.formConfigured$)?0:-1)},dependencies:[Ot,x,ee,D,I,B,w,E,V,te,Ge],encapsulation:2,changeDetection:0})}};var er=["tt"],tr=(n,t)=>t.label;function ir(n,t){if(n&1&&(a(0,"tr")(1,"td",3)(2,"span"),l(3,"\u2B24"),r()(),a(4,"td"),l(5),r(),a(6,"td"),l(7),r()()),n&2){let e,i=t.$implicit;p(2),mi("color",i.color),p(3),$(" ",i.label," "),p(2),ze((e=i.value)!==null&&e!==void 0?e:"-")}}var Fi=class n{constructor(){this.date=ht(null);this.legend=ht([])}show(t,e,i,o,m,d){this.date.set(i);let f=o.filter(F=>F.visible),y=[];for(let F=0;F<f.length;F++){let Y=null,_e=m[F];_e&&_e.value!==null&&(Y=d(_e.value)),y.push({color:f[F].lineColor,label:f[F].parameter,value:Y})}this.legend.set(y);let P=this.tt.nativeElement;P.style.left=t+"px",P.style.top=e+"px",P.style.display="block"}hide(){let t=this.tt.nativeElement;t.style.display="none"}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-parameter-plot-tooltip"]],viewQuery:function(e,i){if(e&1&&Se(er,7),e&2){let o;xe(o=Te())&&(i.tt=o.first)}},decls:9,vars:3,consts:[["tt",""],[1,"ya-tooltip"],["yaSimpleTable",""],["width","1"]],template:function(e,i){e&1&&(a(0,"div",1,0),l(2),k(3,"datetime"),s(4,"br")(5,"br"),a(6,"table",2),pe(7,ir,8,4,"tr",null,tr),r()()),e&2&&(p(2),$(" ",N(3,1,i.date())," "),p(5),ce(i.legend()))},dependencies:[di,pt,se],styles:[".ya-tooltip[_ngcontent-%COMP%]{position:absolute;display:none;white-space:pre;border-radius:2px;max-width:350px;padding:6px 8px;margin-top:14px;background:#ffffffb3;border:1px solid var(--y-border-color);font-family:Roboto,sans-serif;font-size:10px}"]})}};var hn=class{constructor(t){this.watermarkObserver=t;this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.forceNextPoint=!1;this.buffer=Array(this.bufferSize).fill(void 0)}push(t){let e;if(this.pointer>0&&(e=this.buffer[this.pointer-1]),e&&!this.forceNextPoint){if(e.n===0&&t.n===0){e.time=Math.min(e.time,t.time),e.firstTime=Math.min(e.firstTime,t.firstTime),e.lastTime=Math.max(e.lastTime,t.lastTime);return}else if(e.n>0&&t.n>0){e.time=Math.min(e.time,t.time),e.firstTime=Math.min(e.firstTime,t.firstTime),e.lastTime=Math.max(e.lastTime,t.lastTime),e.min=Math.min(e.min,t.min),e.max=Math.max(e.max,t.max),e.n+=t.n,e.avg-=e.avg/e.n,e.avg+=t.avg/e.n;return}}this.pointer<this.bufferSize&&(this.buffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.watermarkObserver(),this.alreadyWarned=!0),this.pointer=this.pointer+1),this.forceNextPoint=!1}snapshot(){return this.buffer.filter(t=>t!==void 0)}reset(){this.buffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.forceNextPoint=!1}},Ri=class{constructor(t){this.watermarkObserver=t;this.archiveData=new Map;this.realtimeBuffers=new Map}setArchiveData(t){this.archiveData.clear();for(let e of t)this.archiveData.set(e.name,e.series)}addRealtimeValue(t,e){let i=this.realtimeBuffers.get(t);i||(i=new hn(this.watermarkObserver),this.realtimeBuffers.set(t,i)),i.push(e)}forceNextPoint(){this.realtimeBuffers.forEach(t=>t.forceNextPoint=!0)}reset(){this.archiveData.clear(),this.realtimeBuffers.forEach(t=>t.reset())}snapshot(t,e){let i=[];for(let[o,m]of this.archiveData){let f=(this.realtimeBuffers.get(o)?.snapshot()||[]).filter(F=>F!==void 0),y=null;f.length>0&&(y=f[0].firstTime);let P=m.filter(F=>y===null||F.firstTime<y);f.length>0&&f[0].firstTime<=e&&(P=P.concat(f)),P=P.sort((F,Y)=>F.firstTime-Y.firstTime),i.push(P)}return i}};var Ai=class{constructor(t,e,i){this.yamcs=t;this.configService=i;this.resolution=6e3;this.loading$=new j(!1);this.data$=new j([]);this.parameters$=new j([]);this.syncSubscription=e.sync(()=>{this.plotBuffer.forceNextPoint(),this.emitDataUpdate()}),this.plotBuffer=new Ri(()=>{this.reloadVisibleRange()})}emitDataUpdate(){if(!this.loading$.getValue()){let t=this.visibleStart.getTime(),e=this.visibleStop.getTime(),i=this.plotBuffer.snapshot(t,e);this.data$.next(i)}}addParameter(...t){if(this.parameters$.next([...this.parameters$.value,...t]),this.realtimeSubscription){let e=t.map(i=>({name:i.qualifiedName}));this.addToRealtimeSubscription(e)}else this.connectRealtime()}removeParameter(t){let e=this.parameters$.value.filter(i=>i.qualifiedName!==t);this.parameters$.next(e)}reloadVisibleRange(){return this.updateWindow(this.visibleStart,this.visibleStop)}updateWindowOnly(t,e){this.visibleStart=t,this.visibleStop=e}updateWindow(t,e){if(this.configService.getConfig().tmArchive){this.loading$.next(!0);let i=(e.getTime()-t.getTime())/10,o=new Date(t.getTime()-i),m=new Date(e.getTime()),d=this.parameters$.value,f=[];for(let P of d)f.push(this.yamcs.yamcsClient.getParameterSamples(this.yamcs.instance,P.qualifiedName,{start:o.toISOString(),stop:m.toISOString(),count:this.resolution,fields:["time","n","avg","min","max","firstTime","lastTime"],gapTime:3e5,source:this.configService.isParameterArchiveEnabled()?"ParameterArchive":"replay"}));let y=Promise.allSettled(f);return this.lastLoadPromise=y,y.then(P=>{if(this.lastLoadPromise===y){this.loading$.next(!1),this.plotBuffer.reset(),this.visibleStart=t,this.visibleStop=e;let F=[];for(let Y=0;Y<P.length;Y++){let _e=P[Y];_e.status==="fulfilled"?F.push({name:d[Y].qualifiedName,series:this.processSamples(_e.value)}):(console.warn(`Failed to retrieve samples for ${d[Y].qualifiedName}`,_e.reason),F.push({name:d[Y].qualifiedName,series:[]}))}this.plotBuffer.setArchiveData(F),this.emitDataUpdate(),this.lastLoadPromise=null}})}else{this.plotBuffer.reset(),this.visibleStart=t,this.visibleStop=e;let i=[],o=this.parameters$.value;for(let m=0;m<o.length;m++)i.push({name:o[m].qualifiedName,series:[]});this.plotBuffer.setArchiveData(i),this.emitDataUpdate()}}connectRealtime(){let t=this.parameters$.value.map(e=>({name:e.qualifiedName}));this.realtimeSubscription=this.yamcs.yamcsClient.createParameterSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,id:t,sendFromCache:!1,updateOnExpiration:!0,abortOnInvalid:!0,action:"REPLACE"},e=>{e.mapping&&(this.idMapping=Ne(Ne({},this.idMapping),e.mapping)),e.values&&e.values.length&&this.processRealtimeDelivery(e.values)})}addToRealtimeSubscription(t){this.realtimeSubscription.addReplyListener(()=>{this.realtimeSubscription.sendMessage({instance:this.yamcs.instance,processor:this.yamcs.processor,id:t,sendFromCache:!1,updateOnExpiration:!0,abortOnInvalid:!0,action:"ADD"})})}processRealtimeDelivery(t){for(let e of t){let i=this.idMapping[e.numericId],o=Date.parse(e.generationTime),m=re.convertValueToNumber(e.engValue);m===null||e.acquisitionStatus!=="ACQUIRED"?this.plotBuffer.addRealtimeValue(i.name,{time:o,firstTime:o,lastTime:o,n:1,avg:null,min:null,max:null}):this.plotBuffer.addRealtimeValue(i.name,{time:o,firstTime:o,lastTime:o,n:1,avg:m,min:m,max:m})}}disconnect(){this.data$.complete(),this.loading$.complete(),this.realtimeSubscription?.cancel(),this.syncSubscription?.unsubscribe()}processSamples(t){let e=[];for(let i of t)e.push({time:Date.parse(i.time),firstTime:Date.parse(i.firstTime??i.time),lastTime:Date.parse(i.lastTime??i.time),n:i.n,avg:i.avg,min:i.min,max:i.max});return e}};var ue={frozen:new Ve(!1),height:new z(30),minimum:new z,maximum:new z,zeroLineWidth:new z(0),zeroLineColor:new ge("#ff0000"),minimumFractionDigits:new z(0),maximumFractionDigits:new z(2)};function Cn(n,t){let e={};return e[`trace_${n}_parameter`]=new je(""),e[`trace_${n}_lineColor`]=new ge(t),e[`trace_${n}_visible`]=new Ve(!0),e[`trace_${n}_lineWidth`]=new z(1),e[`trace_${n}_fill`]=new Ve(!1),e[`trace_${n}_fillColor`]=new ge("#dddddd"),e[`trace_${n}_minMax`]=new Ve(!1),e[`trace_${n}_minMaxOpacity`]=new z(.17),e}function gn(n,t,e){let i=`trace_${n}_`,o=ie(t,e),m={};for(let d in o)m[d.slice(i.length)]=o[d];return m}var qt=["#1b73e8","#129eaf","#d01984","#34a853","#7626bb","#e64b19"],ii=class extends Hn{constructor(t,e,i,o,m,d){super(t.timeline),this.label=e.name,this.data={band:e};let f=ie(ue,e.properties||{});this.frozen=f.frozen??ue.frozen.defaultValue,this.contentHeight=f.height??ue.height.defaultValue,this.labelBackground="rgba(255, 255, 255, 0.75)",this.minimum=f.minimum??ue.minimum.defaultValue,this.maximum=f.maximum??ue.maximum.defaultValue,this.zeroLineWidth=f.zeroLineWidth??ue.zeroLineWidth.defaultValue,this.zeroLineColor=f.zeroLineColor??ue.zeroLineColor.defaultValue;let y=Intl.NumberFormat("en-US",{minimumFractionDigits:f.minimumFractionDigits??ue.minimumFractionDigits.defaultValue,maximumFractionDigits:f.maximumFractionDigits??ue.maximumFractionDigits.defaultValue,useGrouping:!1});this.labelFormatter=ae=>y.format(ae);let P=new li(document.body),F=d.position().flexibleConnectedTo(P).withPositions([{originX:"start",originY:"top",overlayX:"start",overlayY:"top"}]).withPush(!1),Y=d.create({positionStrategy:F}),_e=new ui(Fi);this.tooltipInstance=Y.attach(_e).instance;let ke=[],Jt=1;for(;;){let ae=Cn(Jt,"#zzzzzz"),Zt=gn(Jt,ae,e.properties||{});if(!Zt.parameter)break;Jt++,ke.push(Zt)}this.dataSource=new Ai(i,o,m),this.dataSource.data$.subscribe(ae=>{let Zt=[];for(let ai=0;ai<ke.length;ai++){let We=ke[ai],Kt=ae.length?ae[ai]:[],mn=new Map,sn=new Map;for(let ft=0;ft<Kt.length;ft++){let $e=Kt[ft];if($e.n===0)mn.set($e.time,null),sn.set($e.time,null);else{let Sn=ft===0||Kt[ft-1].n===0,xn=ft===Kt.length-1||Kt[ft+1].n===0,ei;Sn&&!xn?ei=$e.firstTime:!Sn&&xn?ei=$e.lastTime:ei=$e.time,mn.set(ei,$e.avg),sn.set(ei,[$e.min,$e.max])}}let uo=Math.floor(We.minMaxOpacity*255).toString(16);Zt.push({visible:We.visible,points:mn,pointRadius:0,lohi:We.minMax?sn:void 0,lineColor:We.lineColor,lohiColor:fn(We.lineColor)+uo,lineWidth:We.lineWidth,fill:We.fill?We.fillColor:"transparent"})}this.lines=Zt}),this.backfillSubscription=i.yamcsClient.createBackfillingSubscription({instance:i.instance},ae=>{ae.finished&&this.dataSource.reloadVisibleRange()});let Ce=[];for(let ae=0;ae<ke.length;ae++)Ce.push({qualifiedName:ke[ae].parameter});Ce.length&&this.dataSource.addParameter(...Ce),this.addMouseMoveListener(ae=>{this.tooltipInstance.show(ae.clientX,ae.clientY,new Date(ae.time),ke,ae.points,this.labelFormatter)}),this.addMouseLeaveListener(ae=>{this.tooltipInstance.hide()})}refreshData(){let t=this.timeline.start,e=this.timeline.stop;this.dataSource.updateWindow(new Date(t),new Date(e))}disconnectedCallback(){this.backfillSubscription?.cancel(),this.dataSource.disconnect()}};var $t=class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-parameter-plot-styles"]],inputs:{form:"form"},decls:52,vars:1,consts:[[3,"formGroup"],["yaSimpleTable","","formGroupName","properties",1,"style-table"],[1,"property"],["dialogTitle","Frozen"],[1,"widget"],["formControlName","frozen"],["type","number","formControlName","height","min","0",2,"width","100px"],["dialogTitle","Minimum"],["type","number","formControlName","minimum",2,"width","100px"],[1,"hint"],["dialogTitle","Maximum"],["type","number","formControlName","maximum",2,"width","100px"],["type","number","formControlName","zeroLineWidth","min","0",2,"width","100px"],["type","color","formControlName","zeroLineColor"],["type","number","formControlName","minimumFractionDigits","min","0",2,"width","100px"],["type","number","formControlName","maximumFractionDigits","min","0",2,"width","100px"]],template:function(e,i){e&1&&(a(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4," Frozen "),a(5,"ya-help",3),l(6," Fix this line to the top of the view. Frozen bands are always rendered above other bands. "),r()(),a(7,"td",4),s(8,"mat-slide-toggle",5),r()(),a(9,"tr")(10,"td",2),l(11,"Height"),r(),a(12,"td",4),s(13,"input",6),r()(),a(14,"tr")(15,"td",2),l(16," Minimum "),a(17,"ya-help",7),l(18," Minimum value on the Y axis. Values lower than the minimum are not visible. If undefined, the value is automatically derived from the actual trace data. "),r()(),a(19,"td",4),s(20,"input",8),a(21,"span",9),l(22,"Leave empty for automatic determination"),r()()(),a(23,"tr")(24,"td",2),l(25," Maximum "),a(26,"ya-help",10),l(27," Maximum value on the Y axis. Values higher than the maximum are not visible. If undefined, the value is automatically derived from the actual trace data. "),r()(),a(28,"td",4),s(29,"input",11),a(30,"span",9),l(31,"Leave empty for automatic determination"),r()()(),a(32,"tr")(33,"td",2),l(34,"Zero line width"),r(),a(35,"td",4),s(36,"input",12),r()(),a(37,"tr")(38,"td",2),l(39,"Zero line color"),r(),a(40,"td",4),s(41,"input",13),r()(),a(42,"tr")(43,"td",2),l(44,"Minimum fraction digits"),r(),a(45,"td",4),s(46,"input",14),r()(),a(47,"tr")(48,"td",2),l(49,"Maximum fraction digits"),r(),a(50,"td",4),s(51,"input",15),r()()()()),e&2&&c("formGroup",i.form)},dependencies:[x,D,I,fe,B,w,De,E,V,de,se,Oe,Be],styles:[".style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0})}};function nr(n,t){n&1&&(a(0,"tr")(1,"td",4),l(2,"Min/max opacity"),r(),a(3,"td",5),s(4,"input",12),a(5,"span",13),l(6,"Value between 0 and 1"),r()()())}function or(n,t){n&1&&(a(0,"tr")(1,"td",4),l(2,"Fill color"),r(),a(3,"td",5),s(4,"input",14),r()())}var zt=class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-trace-styles"]],inputs:{form:"form"},decls:36,vars:4,consts:[["minMax",""],["fill",""],[3,"formGroup"],["yaSimpleTable","",1,"style-table"],[1,"property"],[1,"widget"],["formControlName","parameter",3,"fill"],["type","color","formControlName","lineColor"],["formControlName","visible"],["type","number","formControlName","lineWidth","min","0",2,"width","100px"],["formControlName","minMax"],["formControlName","fill"],["type","number","formControlName","minMaxOpacity","min","0","max","1","step","0.1",2,"width","100px"],[1,"hint"],["type","color","formControlName","fillColor"]],template:function(e,i){if(e&1&&(a(0,"form",2)(1,"table",3)(2,"tr")(3,"td",4),l(4,"Parameter"),r(),a(5,"td",5),s(6,"app-parameter-input",6),r()(),a(7,"tr")(8,"td",4),l(9,"Line color"),r(),a(10,"td",5),s(11,"input",7),r()(),a(12,"tr")(13,"td",4),l(14,"Visible"),r(),a(15,"td",5),s(16,"mat-slide-toggle",8),r()(),a(17,"tr")(18,"td",4),l(19,"Line width"),r(),a(20,"td",5),s(21,"input",9),r()(),a(22,"tr")(23,"td",4),l(24,"Show min/max"),r(),a(25,"td",5),s(26,"mat-slide-toggle",10,0),r()(),_(28,nr,7,0,"tr"),a(29,"tr")(30,"td",4),l(31,"Fill"),r(),a(32,"td",5),s(33,"mat-slide-toggle",11,1),r()(),_(35,or,5,0,"tr"),r()()),e&2){let o=le(27),m=le(34);c("formGroup",i.form),p(6),c("fill",!0),p(22),T(o.checked?28:-1),p(7),T(m.checked?35:-1)}},dependencies:[Ei,x,D,I,fe,B,w,De,Nn,E,V,se,Oe],styles:[".style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0})}};function rr(n,t){if(n&1){let e=L();a(0,"ya-stepper-step",6)(1,"ya-stepper-step-actions")(2,"ya-icon-action",7),g("click",function(){let o=b(e).$index,m=h(2);return S(m.moveUp(o))}),r(),a(3,"ya-icon-action",8),g("click",function(){let o=b(e).$index,m=h(2);return S(m.moveDown(o))}),r(),a(4,"ya-icon-action",9),g("click",function(){let o=b(e).$index,m=h(2);return S(m.removeTrace(o))}),r(),a(5,"ya-icon-action",10),g("click",function(){let o=b(e).$index,m=h(2);return S(m.addTrace(o))}),r()(),s(6,"app-trace-styles",5),r()}if(n&2){let e=t.$implicit,i=t.$index,o=h(2);si("label","Trace ",i+1,""),c("expanded",!0),p(2),c("disabled",i===0),p(),c("disabled",i>=o.traces.controls.length-1),p(),c("disabled",o.traces.controls.length<=1),p(2),c("form",e)}}function ar(n,t){if(n&1&&(a(0,"form",0)(1,"ya-stepper")(2,"ya-stepper-step",1)(3,"label"),l(4," Label "),a(5,"span",2),l(6,"(required)"),r(),s(7,"br")(8,"input",3),r(),s(9,"br"),a(10,"label"),l(11," Description "),a(12,"span",2),l(13,"(optional)"),r(),s(14,"br")(15,"textarea",4),r(),s(16,"br")(17,"app-parameter-plot-styles",5),r(),pe(18,rr,7,7,"ya-stepper-step",6,ye),r()()),n&2){let e=h();c("formGroup",e.form),p(2),c("expanded",!0),p(15),c("form",e.form),p(),ce(e.traces.controls)}}var Yt=class n{constructor(t,e,i){this.yamcs=t;this.changeDetection=e;this.formBuilder=i;this.formConfigured$=new j(!1)}ngAfterViewInit(){let t=ie(ue,this.band.properties||{}),e={frozen:[t.frozen,[C.required]],height:[t.height,[C.required]],minimum:[t.minimum,[]],maximum:[t.maximum,[]],zeroLineColor:[t.zeroLineColor,[C.required]],zeroLineWidth:[t.zeroLineWidth,[C.required]],minimumFractionDigits:[t.minimumFractionDigits,[C.required]],maximumFractionDigits:[t.maximumFractionDigits,[C.required]]},i=this.form.get("properties");for(let m in e){let d=e[m];i.addControl(m,new yt(d[0],d[1]))}let o=1;for(;;){let m=Cn(o,"#zzzzzz"),d=gn(o,m,this.band.properties||{});if(!d.parameter)break;o++,this.addTrace().patchValue(d)}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}get traces(){return this.form.controls.traces}addTrace(t){let e=t===void 0?0:t+1,i=qt[e%qt.length],o=this.formBuilder.group({parameter:["",[C.required]],lineColor:[i,[C.required]],visible:[!0,[C.required]],lineWidth:[1,[C.required]],minMax:[!0,[C.required]],minMaxOpacity:[.17,[C.required]],fill:[!1,[C.required]],fillColor:["#dddddd",[C.required]]});return t!==void 0?this.traces.insert(t+1,o):this.traces.push(o),o}removeTrace(t){this.traces.removeAt(t)}moveUp(t){let e=this.traces.at(t);this.traces.removeAt(t),this.traces.insert(t-1,e)}moveDown(t){let e=this.traces.at(t);this.traces.removeAt(t),this.traces.insert(t+1,e)}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(we),u(Ee))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-parameter-plot"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[1,"ya-form",3,"formGroup"],["label","General",3,"expanded"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[3,"form"],[3,"label","expanded"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove trace",3,"click","disabled"],["icon","add_circle_outline","matTooltip","Add trace below",3,"click"]],template:function(e,i){e&1&&(_(0,ar,20,3,"form",0),k(1,"async")),e&2&&T(N(1,1,i.formConfigured$)?0:-1)},dependencies:[$t,zt,x,ee,D,I,B,w,E,V,Me,rt,st,mt,wi],encapsulation:2,changeDetection:0})}};var lr=["tt"],mr=(n,t)=>t.label;function sr(n,t){n&1&&l(0," Other ")}function pr(n,t){if(n&1&&l(0),n&2){let e=h().$implicit;$(" ",e.label," ")}}function cr(n,t){if(n&1&&l(0),n&2){let e=h().$implicit;$(" ",e.count," x ")}}function dr(n,t){n&1&&l(0," - ")}function ur(n,t){if(n&1&&(a(0,"tr")(1,"td",4)(2,"span"),l(3,"\u2B24"),r()(),a(4,"td"),_(5,sr,1,0)(6,pr,1,1),r(),a(7,"td"),_(8,cr,1,1)(9,dr,1,0),r()()),n&2){let e=t.$implicit;ne("most-frequent",e.mostFrequent),p(2),mi("color",e.color),p(3),T(e.label==="__OTHER"?5:6),p(3),T(e.count>0?8:9)}}var Li=class n{constructor(t){this.formatter=t;this.start=ht(null);this.stop=ht(null);this.legend=ht([])}show(t,e,i,o){let m;o&&(this.start.set(new Date(o.start)),this.stop.set(o.stop?new Date(o.stop):null),m=o.data.range);let d=[],f;for(let[P,F]of i.entries())if(P==="__OTHER"){let Y={label:P,color:F,count:m?.otherCount||0,mostFrequent:!1};d.push(Y)}else{let Y=0;if(m){for(let ke of m.values)if(ke.value===P){Y=ke.count;break}}let _e={label:P,color:F,count:Y,mostFrequent:!1};d.push(_e),(f===void 0||Y>f.count)&&(f=_e)}f&&(f.mostFrequent=!0),this.legend.set(d);let y=this.tt.nativeElement;y.style.left=t+"px",y.style.top=e+"px",y.style.display="block"}hide(){let t=this.tt.nativeElement;t.style.display="none"}static{this.\u0275fac=function(e){return new(e||n)(u(xi))}}static{this.\u0275cmp=v({type:n,selectors:[["app-parameter-states-tooltip"]],viewQuery:function(e,i){if(e&1&&Se(lr,7),e&2){let o;xe(o=Te())&&(i.tt=o.first)}},decls:12,vars:6,consts:[["tt",""],[1,"ya-tooltip"],["yaSimpleTable",""],[3,"most-frequent"],["width","1"]],template:function(e,i){e&1&&(a(0,"div",1,0),l(2),k(3,"datetime"),s(4,"br"),l(5),k(6,"datetime"),s(7,"br")(8,"br"),a(9,"table",2),pe(10,ur,10,6,"tr",3,mr),r()()),e&2&&(p(2),$(" ",N(3,2,i.start())," to "),p(3),$(" ",N(6,4,i.stop())||"-"," "),p(5),ce(i.legend()))},dependencies:[di,pt,se],styles:[".ya-tooltip[_ngcontent-%COMP%]{position:absolute;display:none;white-space:pre;border-radius:2px;max-width:350px;padding:6px 8px;margin-top:14px;background:#ffffffb3;border:1px solid var(--y-border-color);font-family:Roboto,sans-serif;font-size:10px}tr.most-frequent[_ngcontent-%COMP%]{background:#eee}"]})}};var _n=class{constructor(){this.otherCount=0;this.mixed=!1;this.other=!1}},yn=class{constructor(t,e,i){this.maxGap=t;this.formatter=e;this.watermarkObserver=i;this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.buffer=Array(this.bufferSize).fill(void 0)}push(t){let e;this.pointer>0&&(e=this.buffer[this.pointer-1]);let i=re.toDate(t.generationTime).getTime(),o=this.formatter.formatValue(t.engValue),m={value:o,count:1},d=new _n;if(d.start=i,d.stop=d.start,d.values=[m],d.mostFrequentValue=m,e&&e.values[0].value===o){e.stop=d.start,e.values[0].count++;return}else e&&e.stop-d.start<=this.maxGap&&(e.stop=d.start);this.pointer<this.bufferSize&&(this.buffer[this.pointer]=d,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.watermarkObserver(),this.alreadyWarned=!0),this.pointer=this.pointer+1)}snapshot(){return this.buffer.filter(t=>t!==void 0)}reset(){this.buffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1}},Oi=class{constructor(t,e,i,o){this.maxGap=t;this.stateRemapper=i;this.archiveData=[];this.realtimeBuffer=new yn(t,e,o)}setArchiveData(t){this.archiveData=t}addRealtimeValue(t){this.realtimeBuffer.push(t)}reset(){this.archiveData.length=0,this.realtimeBuffer.reset()}snapshot(t,e){let i=this.archiveData,o=this.realtimeBuffer.snapshot();if(i.length>0&&o.length>0){let d=i[i.length-1],f=o[0];f.start-d.stop<=this.maxGap&&(d.stop=f.start)}let m=[...i,...o].filter(d=>d.stop>=t&&d.start<=e);return m=this.stateRemapper.applyMappings(m),m}};var fr="#000000",ro=["#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffffb3"],Gi=class{constructor(){this.cache=new Map;this.nextIndex=0}colorForValue(t){if(t==="__OTHER")return fr;let e=this.cache.get(t);return e?this.cache.delete(t):(e=ro[this.nextIndex],this.nextIndex++,this.nextIndex>ro.length-1&&(this.nextIndex=0,this.keepSizeWithinLimits())),this.cache.set(t,e),e}reset(){this.cache.clear(),this.nextIndex=0}keepSizeWithinLimits(){for(;this.cache.size>1e3;){let e=0;for(var t of this.cache.keys()){if(e++>100)break;this.cache.delete(t)}}}};var qi=class{constructor(){this.colorByValue=new Map;this.colorMap=new Gi}entries(){return this.colorByValue.entries()}resetColorAssignment(){this.colorMap.reset()}recalculate(t){let e=new Map;for(let o of t)for(let m of o.values)e.has(m.value)||e.set(m.value,m.color);let i=[...e.entries()].sort((o,m)=>o[0].localeCompare(m[0],void 0,{numeric:!0,sensitivity:"base"}));this.colorByValue.clear();for(let[o,m]of i)if(m)this.colorByValue.set(o,m);else{let d=this.colorMap.colorForValue(o);this.colorByValue.set(o,d)}this.colorByValue.set("__OTHER",this.colorMap.colorForValue("__OTHER"))}getBackground(t){return t.mostFrequentValue.color??this.colorMap.colorForValue(t.mostFrequentValue.value)}getForeground(t){let e=this.getBackground(t);return this.isDark(e)?"#fff":"#000"}getLabel(t){return t.mostFrequentValue.value??"null"}isDark(t){let e=t.charAt(0)==="#"?t.substring(1,7):t,i=parseInt(e.substring(0,2),16),o=parseInt(e.substring(2,4),16),m=parseInt(e.substring(4,6),16);return i*.299+o*.587+m*.114<=186}};function ao(n){let t=[];for(let e of n.values)t.push(Ne({},e));return{start:n.start,stop:n.stop,values:t,mostFrequentValue:Ne({},n.mostFrequentValue),otherCount:n.otherCount,mixed:n.mixed}}function lo(n,t){if(n.otherCount===0&&t.otherCount!==0||n.otherCount!==0&&t.otherCount===0||n.stop!==t.start)return!1;let e=n.values.filter(o=>o.count>0).map(o=>o.value).sort(),i=t.values.filter(o=>o.count>0).map(o=>o.value).sort();if(e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==i[o])return!1;return!0}var $i=class{constructor(){this.mappings=[]}addMapping(t){this.mappings.push(t)}applyMappings(t){let e=[];for(let i of t){let o=ao(i);this.applyMappingsToState(o),e.push(o)}return this.reduceDistinctValues(e),this.compactStates(e),this.calculateMostFrequent(e),e}applyMappingsToState(t){let e=[];for(let o of t.values){let m=o.value,d;for(let f of this.mappings)if(f.type==="value")m===f.value&&(f.label&&(m=f.label),d=f.color||void 0);else if(f.type==="range"){let y=Number(f.start),P=Number(f.end);if(!isNaN(m)){let F=Number(m);F>=y&&F<=P&&(f.label&&(m=f.label),d=f.color||void 0)}}e.push({value:m,count:o.count,color:d})}let i=[];for(let o of e){let m=i.find(d=>d.value===o.value);m?m.count+=o.count:i.push(o)}t.values=i}reduceDistinctValues(t){let i=new Map;for(let m of t)for(let d of m.values){let f=i.get(d.value)||0;i.set(d.value,f+d.count)}let o=[...i.entries()].sort((m,d)=>d[1]-m[1]).slice(0,10).map(m=>m[0]);for(let m of t)for(let d=m.values.length-1;d>=0;d--){let f=m.values[d];o.indexOf(f.value)===-1&&(m.values.splice(d,1),m.otherCount+=f.count)}}compactStates(t){let e=[],i=null;for(let o of t)if(i&&lo(i,o)){i.otherCount+=o.otherCount,i.stop=o.stop;for(let m of o.values){let d=i.values.find(f=>f.value===m.value);d?d.count+=m.count:i.values.push(m)}}else e.push(o),i=o;t.length=0,t.push(...e)}calculateMostFrequent(t){for(let e of t){let i={value:null,count:0},o=0;for(let m of e.values)m.count>i.count&&(i=Ne({},m)),m.count>0&&o++;e.otherCount&&o++,e.otherCount>i.count&&(i={value:"__OTHER",count:e.otherCount}),e.mostFrequentValue=i,e.mixed=o>1}}};var mo=12e4,Ue={frozen:new Ve(!1),height:new z(30),parameter:new je("")};function vn(n){let t={};return t[`value_mapping_${n}_type`]=new je(""),t[`value_mapping_${n}_value`]=new je(""),t[`value_mapping_${n}_start`]=new z,t[`value_mapping_${n}_end`]=new z,t[`value_mapping_${n}_label`]=new je(""),t[`value_mapping_${n}_color`]=new ge(""),t}function bn(n,t,e){let i=`value_mapping_${n}_`,o=ie(t,e),m={};for(let d in o)o[d]!==""&&(m[d.slice(i.length)]=o[d]);return m}var oi=class extends Ft{constructor(e,i,o,m,d,f,y){super(e.timeline);this.yamcs=o;this.formatter=d;this.configService=f;this.stateRemapper=new $i;this.legend=new qi;this.label=i.name,this.multiline=!1,this.itemTextOverflow="hide",this.itemHoverBorderWidth=1,this.data={band:i};let P=ie(Ue,i.properties||{});this.frozen=P.frozen??Ue.frozen.defaultValue,this.itemHeight=P.height??Ue.height.defaultValue,this.parameter=P.parameter??Ue.parameter.defaultValue;let F=0;for(;;){let Ce=vn(F),ae=bn(F,Ce,i.properties||{});if(!ae.type)break;F++,this.stateRemapper.addMapping(ae)}let Y=new li(document.body),_e=y.position().flexibleConnectedTo(Y).withPositions([{originX:"start",originY:"top",overlayX:"start",overlayY:"top"}]).withPush(!1),ke=y.create({positionStrategy:_e}),Jt=new ui(Li);this.tooltipInstance=ke.attach(Jt).instance,this.stateBuffer=new Oi(mo,this.formatter,this.stateRemapper,()=>{this.refreshData(!1)}),this.syncSubscription=m.sync(()=>{this.updateChart()}),this.backfillSubscription=o.yamcsClient.createBackfillingSubscription({instance:o.instance},Ce=>{Ce.finished&&this.refreshData(!1)}),this.addItemMouseEnterListener(Ce=>{this.tooltipInstance.show(Ce.clientX,Ce.clientY,this.legend)}),this.addItemMouseMoveListener(Ce=>{this.tooltipInstance.show(Ce.clientX,Ce.clientY,this.legend,Ce.item)}),this.addItemMouseLeaveListener(Ce=>{this.tooltipInstance.hide()}),this.mixedPattern=this.createMixedPattern()}refreshData(e=!0){let i=(this.timeline.stop-this.timeline.start)/10,o=this.timeline.start-i,m=this.timeline.stop,f={maxValues:15,maxGap:mo,start:new Date(o).toISOString(),stop:new Date(m).toISOString(),minRange:Math.floor((m-o)/5e3)};this.configService.getConfig().tmArchive?this.yamcs.yamcsClient.getParameterRanges(this.yamcs.instance,this.parameter,f).then(y=>{this.connectRealtime();let P=this.convertRangesToStates(y);this.stateBuffer.reset(),this.stateBuffer.setArchiveData(P)}).catch(y=>{console.warn(`Failed to retrieve samples for ${this.parameter}`,y),this.stateBuffer.reset(),this.stateBuffer.setArchiveData([])}).finally(()=>{e&&this.legend.resetColorAssignment(),this.updateChart()}):(this.connectRealtime(),this.stateBuffer.reset(),this.stateBuffer.setArchiveData([]),e&&this.legend.resetColorAssignment(),this.updateChart())}connectRealtime(){this.realtimeSubscription?.cancel(),this.realtimeSubscription=this.yamcs.yamcsClient.createParameterSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,id:[{name:this.parameter}],sendFromCache:!1,updateOnExpiration:!1,abortOnInvalid:!0,action:"REPLACE"},e=>{for(let i of e.values||[])this.stateBuffer.addRealtimeValue(i)})}convertRangesToStates(e){let i=[];for(let o of e){let m={start:re.toDate(o.start).getTime(),stop:re.toDate(o.stop).getTime(),values:[],otherCount:o.otherCount,mixed:!1,mostFrequentValue:{value:null,count:0}};for(let d=0;d<o.engValues?.length;d++){let f=this.formatter.formatValue(o.engValues[d]),y=o.counts[d];m.values.push({value:f,count:y})}i.push(m)}return i}updateChart(){let e=this.stateBuffer.snapshot(this.timeline.start,this.timeline.stop);this.legend.recalculate(e);let i=[];for(let o of e){let m,d,f;o.mixed?(m=this.mixedPattern,d="#000",f="Mixed"):o.otherCount>0?(m="#000",d="#fff",f="Misc"):(m=this.legend.getBackground(o),d=this.legend.getForeground(o),f=this.legend.getLabel(o));let y={start:o.start,stop:o.stop,background:m,textColor:d,label:f,borderWidth:0,data:{range:o}};i.push(y)}this.items=i}createMixedPattern(){let i=document.createElement("canvas");i.width=6,i.height=6;let o=i.getContext("2d");return o.fillStyle="#d3d3d3",o.beginPath(),o.moveTo(0,0),o.lineTo(6/3,0),o.lineTo(0,6/3),o.closePath(),o.fill(),o.beginPath(),o.moveTo(6*2/3,0),o.lineTo(6,0),o.lineTo(6,6*1/3),o.lineTo(6*1/3,6),o.lineTo(0,6),o.lineTo(0,6*2/3),o.closePath(),o.fill(),o.beginPath(),o.moveTo(6,6),o.lineTo(6,6-6/3),o.lineTo(6-6/3,6),o.closePath(),o.fill(),o.createPattern(i,"repeat")}disconnectedCallback(){this.backfillSubscription?.cancel(),this.realtimeSubscription?.cancel(),this.syncSubscription?.unsubscribe()}};var jt=class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-parameter-states-styles"]],inputs:{form:"form"},decls:33,vars:2,consts:[[3,"formGroup"],["yaSimpleTable","","formGroupName","properties",1,"style-table"],[1,"property"],["dialogTitle","Frozen"],[1,"widget"],["formControlName","frozen"],["type","number","formControlName","height","min","0",2,"width","100px"],["formControlName","parameter",3,"fill"],[1,"hint"]],template:function(e,i){e&1&&(a(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4," Frozen "),a(5,"ya-help",3),l(6," Fix this line to the top of the view. Frozen bands are always rendered above other bands. "),r()(),a(7,"td",4),s(8,"mat-slide-toggle",5),r()(),a(9,"tr")(10,"td",2),l(11,"Height"),r(),a(12,"td",4),s(13,"input",6),r()(),a(14,"tr")(15,"td",2),l(16,"Parameter"),r(),a(17,"td",4),s(18,"app-parameter-input",7),r()()(),s(19,"br"),a(20,"p",8),l(21," For best results the displayed parameter should have a limited amount of possible values and/or change infrequently. Else the visualization will not be very useful, especially when zoomed out. "),r(),a(22,"p",8),l(23," This generally means that "),a(24,"strong"),l(25,"enumeration"),r(),l(26," , "),a(27,"strong"),l(28,"boolean"),r(),l(29," or "),a(30,"strong"),l(31,"string"),r(),l(32," parameters are the best candidates. Or a numeric parameter with custom value mapping. "),r()()),e&2&&(c("formGroup",i.form),p(18),c("fill",!0))},dependencies:[Ei,x,D,I,fe,B,w,De,E,V,de,se,Oe,Be],styles:[".style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0})}};function hr(n,t){n&1&&s(0,"input",13)}function Cr(n,t){n&1&&s(0,"input",20)(1,"input",21)}function gr(n,t){if(n&1){let e=L();a(0,"tr",11)(1,"td"),s(2,"input",12,0),l(4),k(5,"titlecase"),r(),a(6,"td"),_(7,hr,1,0,"input",13)(8,Cr,2,0),r(),a(9,"td"),l(10,"\u2192"),r(),a(11,"td"),s(12,"input",14),r(),a(13,"td"),s(14,"ya-color-input",15),r(),a(15,"td",16)(16,"ya-icon-action",17),g("click",function(){let o=b(e).$index,m=h(3);return S(m.moveUp(o))}),r(),a(17,"ya-icon-action",18),g("click",function(){let o=b(e).$index,m=h(3);return S(m.moveDown(o))}),r(),a(18,"ya-icon-action",19),g("click",function(){let o=b(e).$index,m=h(3);return S(m.removeMapping(o))}),r()()()}if(n&2){let e=t.$implicit,i=t.$index,o=le(3),m=h(3);c("formGroupName",i),p(4),$(" ",N(5,6,e.value.type)," "),p(3),T(o.value==="value"?7:o.value==="range"?8:-1),p(9),c("disabled",i===0),p(),c("disabled",i>=m.valueMappings.controls.length-1),p(),c("disabled",m.valueMappings.controls.length<=1)}}function _r(n,t){if(n&1&&(a(0,"table",9)(1,"tr")(2,"th"),l(3,"Type"),r(),a(4,"th"),l(5," Condition "),a(6,"span",3),l(7,"(required)"),r()(),s(8,"th"),a(9,"th"),l(10,"Label"),r(),a(11,"th"),l(12,"Color"),r(),s(13,"th",10),r(),pe(14,gr,19,8,"tr",11,ye),r(),s(16,"br")),n&2){let e=h(2);p(14),ce(e.valueMappings.controls)}}function yr(n,t){if(n&1){let e=L();a(0,"form",1)(1,"ya-stepper")(2,"ya-stepper-step",2)(3,"label"),l(4," Label "),a(5,"span",3),l(6,"(required)"),r(),s(7,"br")(8,"input",4),r(),s(9,"br"),a(10,"label"),l(11," Description "),a(12,"span",3),l(13,"(optional)"),r(),s(14,"br")(15,"textarea",5),r(),s(16,"br")(17,"app-parameter-states-styles",6),r(),a(18,"ya-stepper-step",7),_(19,_r,17,0),a(20,"ya-button",8),g("click",function(){b(e);let o=h();return S(o.addValueMapping())}),l(21," Add value mapping "),r(),l(22," \xA0 "),a(23,"ya-button",8),g("click",function(){b(e);let o=h();return S(o.addRangeMapping())}),l(24," Add range mapping "),r()()()()}if(n&2){let e=h();c("formGroup",e.form),p(2),c("expanded",!0),p(15),c("form",e.form),p(),c("expanded",!0),p(),T(e.valueMappings.length?19:-1)}}var Ut=class n{constructor(t,e,i){this.yamcs=t;this.changeDetection=e;this.formBuilder=i;this.formConfigured$=new j(!1)}ngAfterViewInit(){let t=ie(Ue,this.band.properties||{}),e={frozen:[t.frozen,[C.required]],height:[t.height,[C.required]],parameter:[t.parameter,[C.required]]},i=this.form.get("properties");for(let m in e){let d=e[m];i.addControl(m,new yt(d[0],d[1]))}let o=0;for(;;){let m=vn(o),d=bn(o,m,this.band.properties||{});if(!d.type)break;o++,d.type==="value"?this.addValueMapping().patchValue(d):d.type==="range"&&this.addRangeMapping().patchValue(d)}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}get valueMappings(){return this.form.controls.valueMappings}addValueMapping(){let t=this.formBuilder.group({type:["value",[C.required]],value:["",[C.required]],label:[""],color:[""]});return this.valueMappings.push(t),t}addRangeMapping(){let t=this.formBuilder.group({type:["range",[C.required]],start:["",[C.required]],end:["",[C.required]],label:[""],color:[""]});return this.valueMappings.push(t),t}removeMapping(t){this.valueMappings.removeAt(t)}moveUp(t){let e=this.valueMappings.at(t);this.valueMappings.removeAt(t),this.valueMappings.insert(t-1,e)}moveDown(t){let e=this.valueMappings.at(t);this.valueMappings.removeAt(t),this.valueMappings.insert(t+1,e)}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(we),u(Ee))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-parameter-states"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[["type",""],[1,"ya-form",3,"formGroup"],["label","General",3,"expanded"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[3,"form"],["label","Value mapping",3,"expanded"],["icon","add_circle_outline",3,"click"],["yaSimpleTable","","formArrayName","valueMappings",1,"mappings"],[2,"width","99%"],[3,"formGroupName"],["type","hidden","formControlName","type"],["type","text","placeholder","value","formControlName","value",2,"width","164px"],["type","text","placeholder","(optional)","formControlName","label",2,"width","140px"],["formControlName","color","label","auto"],[2,"text-align","right"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove mapping",3,"click","disabled"],["type","number","placeholder","start","formControlName","start",2,"width","80px","margin-right","4px"],["type","number","placeholder","end","formControlName","end",2,"width","80px"]],template:function(e,i){e&1&&(_(0,yr,25,5,"form",1),k(1,"async")),e&2&&T(N(1,1,i.formConfigured$)?0:-1)},dependencies:[jt,ci,x,ee,D,I,fe,B,w,E,V,de,fi,se,Me,A,Si,rt,st,mt],styles:["table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:first-child){padding-left:5px}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:last-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:last-child){padding-right:5px}"],changeDetection:0})}};var zi={height:new z(34)};var Wt=class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=v({type:n,selectors:[["app-spacer-styles"]],inputs:{form:"form"},decls:7,vars:1,consts:[[3,"formGroup"],["yaSimpleTable","","formGroupName","properties",1,"style-table"],[1,"property"],[1,"widget"],["type","number","formControlName","height","min","0",2,"width","100px"]],template:function(e,i){e&1&&(a(0,"form",0)(1,"table",1)(2,"tr")(3,"td",2),l(4,"Height"),r(),a(5,"td",3),s(6,"input",4),r()()()()),e&2&&c("formGroup",i.form)},dependencies:[x,D,I,fe,B,w,De,E,V,de,se],styles:[".style-table[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-weight:500;font-size:11px;letter-spacing:.02em;line-height:12px;color:#000;width:150px}.style-table[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{font-style:italic;color:gray}.style-table[_ngcontent-%COMP%]   .widget[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-left:10px}"],changeDetection:0})}};function vr(n,t){if(n&1&&(a(0,"form",0)(1,"label"),l(2," Label "),a(3,"span",1),l(4,"(optional)"),r(),s(5,"br")(6,"input",2),r(),s(7,"br"),a(8,"label"),l(9," Description "),a(10,"span",1),l(11,"(optional)"),r(),s(12,"br")(13,"textarea",3),r(),s(14,"br"),a(15,"div",4),s(16,"mat-divider"),r(),a(17,"h4"),l(18,"Styles"),r(),s(19,"app-spacer-styles",5),r()),n&2){let e=h();c("formGroup",e.form),p(19),c("form",e.form)}}var Ht=class n{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new j(!1)}ngAfterViewInit(){let e={height:[ie(zi,this.band.properties||{}).height,[C.required]]},i=this.form.get("properties");for(let o in e){let m=e[o];i.addControl(o,new vt(m[0],m[1]))}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(we))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-spacer"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[1,"section-divider"],[3,"form"]],template:function(e,i){e&1&&(_(0,vr,20,2,"form",0),k(1,"async")),e&2&&T(N(1,1,i.formConfigured$)?0:-1)},dependencies:[x,ee,D,I,B,w,E,V,te,Wt],encapsulation:2,changeDetection:0})}};function br(n,t){if(n&1&&(a(0,"form",0)(1,"label"),l(2," Label "),a(3,"span",1),l(4,"(required)"),r(),s(5,"br")(6,"input",2),r(),s(7,"br"),a(8,"label"),l(9," Description "),a(10,"span",1),l(11,"(optional)"),r(),s(12,"br")(13,"textarea",3),r(),Q(14,4),s(15,"br"),a(16,"label"),l(17," Timezone"),s(18,"br")(19,"ya-timezone-select",5),r(),X(),r()),n&2){let e=h();c("formGroup",e.form)}}var Qt=class n{constructor(t,e){this.yamcs=t;this.changeDetection=e;this.formConfigured$=new j(!1)}ngAfterViewInit(){let t={timezone:[this.band.properties.timezone,[C.required]]},e=this.form.get("properties");for(let i in t){let o=t[i];e.addControl(i,new vt(o[0],o[1]))}this.formConfigured$.next(!0),this.changeDetection.detectChanges()}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(we))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-time-ruler"]],inputs:{form:"form",band:"band"},decls:2,vars:3,consts:[[3,"formGroup"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],["formGroupName","properties"],["formControlName","timezone"]],template:function(e,i){e&1&&(_(0,br,20,1,"form",0),k(1,"async")),e&2&&T(N(1,1,i.formConfigured$)?0:-1)},dependencies:[x,ee,D,I,B,w,E,V,de,Di],encapsulation:2,changeDetection:0})}};function Sr(n,t){if(n&1&&s(0,"app-edit-item-band",2),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function xr(n,t){if(n&1&&s(0,"app-edit-spacer",2),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function Tr(n,t){if(n&1&&s(0,"app-edit-time-ruler",2),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function wr(n,t){if(n&1&&s(0,"app-edit-command-band",2),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function Dr(n,t){if(n&1&&s(0,"app-edit-parameter-plot",2),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function Er(n,t){if(n&1&&s(0,"app-edit-parameter-states",2),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function Mr(n,t){if(n&1){let e=L();a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Edit band"),r(),a(3,"div",0)(4,"form",1),_(5,Sr,1,2,"app-edit-item-band",2)(6,xr,1,2,"app-edit-spacer",2)(7,Tr,1,2,"app-edit-time-ruler",2)(8,wr,1,2,"app-edit-command-band",2)(9,Dr,1,2,"app-edit-parameter-plot",2)(10,Er,1,2,"app-edit-parameter-states",2),r(),a(11,"p"),l(12,"\xA0"),r(),a(13,"div",3)(14,"ya-button",4),g("click",function(){b(e);let o=h();return S(o.location.back())}),l(15,"Cancel"),r(),a(16,"ya-button",5),k(17,"async"),g("click",function(){b(e);let o=h();return S(o.doOnConfirm())}),l(18," SAVE CHANGES "),r()()()()}if(n&2){let e=t,i=h();p(4),c("formGroup",i.form),p(),T(e.type==="ITEM_BAND"?5:e.type==="SPACER"?6:e.type==="TIME_RULER"?7:e.type==="COMMAND_BAND"?8:e.type==="PARAMETER_PLOT"?9:e.type==="PARAMETER_STATES"?10:-1),p(11),c("disabled",!N(17,3,i.dirty$)||!i.form.valid)}}var Yi=class n{constructor(t,e,i,o,m,d,f){this.yamcs=e;this.messageService=i;this.route=o;this.router=m;this.location=f;this.dirty$=new j(!1);t.setTitle("Edit band");let y=o.snapshot.paramMap.get("band");this.band$=e.yamcsClient.getTimelineBand(e.instance,y),this.band$.then(P=>{this.form=d.group({name:[P.name,[C.required]],description:[P.description||""],tags:[P.tags||[]],traces:d.array([]),valueMappings:d.array([]),properties:d.group({})}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}).catch(P=>this.messageService.showError(P))}doOnConfirm(){let t=this.route.snapshot.paramMap.get("band"),e=this.form.value,i={name:e.name,description:e.description,shared:!0,tags:e.tags,properties:e.properties};for(let o=0;o<this.traces.length;o++){let m=this.traces.at(o);for(let d in m.controls){let f=`trace_${o+1}_${d}`,y=m.controls[d].value;i.properties[f]=y}}for(let o=0;o<this.valueMappings.length;o++){let m=this.valueMappings.at(o);for(let d in m.controls){let f=`value_mapping_${o}_${d}`,y=m.controls[d].value;i.properties[f]=y}}dt(i.properties||{}),this.yamcs.yamcsClient.updateTimelineBand(this.yamcs.instance,t,i).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(o=>this.messageService.showError(o))}get traces(){return this.form.controls.traces}get valueMappings(){return this.form.controls.valueMappings}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(M),u(H),u(Qe),u(ve),u(me),u(_t))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:2,vars:3,consts:[[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[3,"form","band"],[1,"action-bar"],[3,"click"],["appearance","primary",3,"click","disabled"]],template:function(e,i){if(e&1&&(_(0,Mr,19,5,"app-instance-page"),k(1,"async")),e&2){let o;T((o=N(1,1,i.band$))?0:-1,o)}},dependencies:[Rt,Gt,Yt,Ut,Ht,Qt,W,U,x,ee,D,w,E,A],encapsulation:2,changeDetection:0})}};function Pr(n,t){if(n&1){let e=L();a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Edit item"),r(),a(3,"div",0)(4,"form",1)(5,"div",2),l(6," Name "),a(7,"span",3),l(8,"(required)"),r(),s(9,"br")(10,"input",4),r(),s(11,"br"),a(12,"div",2),l(13," Tags "),a(14,"ya-help",5),l(15," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),r(),s(16,"br")(17,"ya-tag-select",6),r(),s(18,"br"),a(19,"div",2),l(20," Duration "),s(21,"ya-duration-input",7),r(),s(22,"br"),a(23,"div",8),s(24,"mat-divider"),r(),s(25,"br"),a(26,"div",2),l(27," Start "),s(28,"br")(29,"ya-date-time-input",9),r(),s(30,"br"),a(31,"div",8),s(32,"mat-divider"),r(),a(33,"h4"),l(34,"Styles"),r(),s(35,"app-item-styles",10)(36,"br"),r(),a(37,"p"),l(38,"\xA0"),r(),a(39,"div",11)(40,"ya-button",12),g("click",function(){b(e);let o=h();return S(o.location.back())}),l(41,"Cancel"),r(),a(42,"ya-button",13),k(43,"async"),g("click",function(){b(e);let o=h();return S(o.doOnConfirm())}),l(44," SAVE CHANGES "),r()()()()}if(n&2){let e=h();p(4),c("formGroup",e.form),p(31),c("form",e.form),p(7),c("disabled",!N(43,3,e.dirty$)||!e.form.valid)}}var ji="_overrideBand",Ui=class n{constructor(t,e,i,o,m,d,f){this.yamcs=e;this.messageService=i;this.route=o;this.router=m;this.location=f;this.resolutionOptions=[{id:"seconds",label:"seconds"},{id:"minutes",label:"minutes"},{id:"hours",label:"hours"}];this.startConstraintOptions=[{id:"START_ON",label:"Start on"}];this.dirty$=new j(!1);t.setTitle("Edit Item");let y=o.snapshot.paramMap.get("item");this.item$=e.yamcsClient.getTimelineItem(e.instance,y),this.item$.then(P=>{let F=P.properties||{},Y=ie(Lt,F);this.form=d.group({name:[P.name,[C.required]],start:[P.start,C.required],duration:[P.duration,C.required],tags:[P.tags||[],[]],properties:d.group({backgroundColor:[Y.backgroundColor,[]],backgroundColor_overrideBand:"backgroundColor"in F,borderColor:[Y.borderColor,[]],borderColor_overrideBand:"borderColor"in F,borderWidth:[Y.borderWidth,[]],borderWidth_overrideBand:"borderWidth"in F,cornerRadius:[Y.cornerRadius,[]],cornerRadius_overrideBand:"cornerRadius"in F,marginLeft:[Y.marginLeft,[]],marginLeft_overrideBand:"marginLeft"in F,textColor:[Y.textColor,[]],textColor_overrideBand:"textColor"in F,textSize:[Y.textSize,[]],textSize_overrideBand:"textSize"in F})}),this.updateDisabledState(),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.updateDisabledState(),this.dirty$.next(!0)})}).catch(P=>this.messageService.showError(P))}updateDisabledState(){let{controls:t}=this.propertiesGroup;for(let e in t)if(e.endsWith(ji)){let i=t[e.substring(0,e.length-ji.length)];t[e].value?i.enable({onlySelf:!0}):i.disable({onlySelf:!0})}}get propertiesGroup(){return this.form.controls.properties}doOnConfirm(){let t=this.route.snapshot.paramMap.get("item"),e=this.form.value,i={name:e.name,start:re.toISOString(e.start),duration:e.duration,tags:e.tags,properties:{}};i.tags?.length||(i.clearTags=!0);let{controls:o}=this.propertiesGroup;for(let m in o)if(m.endsWith(ji)&&o[m].value){let d=m.substring(0,m.length-ji.length);i.properties[d]=o[d].value}i.properties?.length||(i.clearProperties=!0),this.yamcs.yamcsClient.updateTimelineItem(this.yamcs.instance,t,i).then(()=>this.router.navigateByUrl(`/timeline/items?c=${this.yamcs.context}`)).catch(m=>this.messageService.showError(m))}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(M),u(H),u(Qe),u(ve),u(me),u(_t))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:2,vars:3,consts:[[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"label"],[1,"hint"],["type","text","formControlName","name"],["dialogTitle","Tags"],["formControlName","tags"],["formControlName","duration"],[1,"section-divider"],["formControlName","start"],[3,"form"],[1,"action-bar"],[3,"click"],["appearance","primary",3,"click","disabled"]],template:function(e,i){if(e&1&&(_(0,Pr,45,5,"app-instance-page"),k(1,"async")),e&2){let o;T((o=N(1,1,i.item$))?0:-1,o)}},dependencies:[W,U,ut,x,ee,D,I,B,w,E,V,te,A,at,Vt,Be,Ge],encapsulation:2,changeDetection:0})}};var so=n=>({c:n}),Wi=class n{constructor(t,e,i,o,m,d,f){this.yamcs=e;this.messageService=i;this.route=o;this.router=m;this.location=d;this.dirty$=new j(!1);t.setTitle("Edit View");let y=o.snapshot.paramMap.get("view");this.form=f.group({name:[null,C.required],bands:[null,[]]}),e.yamcsClient.getTimelineView(e.instance,y).then(P=>{this.form.setValue({name:P.name,bands:P.bands||[]}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}).catch(P=>this.messageService.showError(P))}onConfirm(){let t=this.form.value,e={name:t.name,bands:t.bands.map(o=>o.id)},i=this.route.snapshot.paramMap.get("view");this.yamcs.yamcsClient.updateTimelineView(this.yamcs.instance,i,e).then(()=>this.router.navigateByUrl(`/timeline/views?c=${this.yamcs.context}`)).catch(o=>this.messageService.showError(o))}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(M),u(H),u(Qe),u(ve),u(_t),u(me))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:26,vars:10,consts:[["routerLink","..","icon","arrow_back",3,"queryParams"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name"],[1,"section-divider"],["formControlName","bands"],[1,"action-bar"],["routerLink","..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),s(2,"ya-page-icon-button",0),l(3," Update view "),r(),a(4,"div",1)(5,"form",2)(6,"label"),l(7," Name "),a(8,"span",3),l(9,"(required)"),r(),s(10,"br")(11,"input",4),r(),s(12,"br"),a(13,"div",5),s(14,"mat-divider"),r(),a(15,"h4"),l(16,"Bands"),r(),s(17,"app-band-multi-select",6),r(),a(18,"p"),l(19,"\xA0"),r(),a(20,"div",7)(21,"ya-button",8),l(22,"Cancel"),r(),a(23,"ya-button",9),k(24,"async"),g("click",function(){return i.onConfirm()}),l(25," SAVE CHANGES "),r()()()()),e&2&&(p(2),c("queryParams",R(6,so,i.yamcs.context)),p(3),c("formGroup",i.form),p(16),c("queryParams",R(8,so,i.yamcs.context)),p(2),c("disabled",!N(24,4,i.dirty$)||!i.form.valid))},dependencies:[ct,W,U,x,ee,D,I,B,w,E,V,J,te,A,kt],encapsulation:2,changeDetection:0})}};var Br=n=>({c:n}),Hi=class n{constructor(t,e,i,o,m){this.yamcs=i;this.messageService=o;this.router=m;t.setTitle("Configure Item Band"),this.form=e.group({name:["",[C.required]],description:"",properties:e.group({frozen:[K.frozen.defaultValue,[C.required]],itemBackgroundColor:[K.itemBackgroundColor.defaultValue,[C.required]],itemBorderColor:[K.itemBorderColor.defaultValue,[C.required]],itemBorderWidth:[K.itemBorderWidth.defaultValue,[C.required]],itemCornerRadius:[K.itemCornerRadius.defaultValue,[C.required]],itemHeight:[K.itemHeight.defaultValue,[C.required]],itemMarginLeft:[K.itemMarginLeft.defaultValue,[C.required]],itemTextColor:[K.itemTextColor.defaultValue,[C.required]],itemTextOverflow:[K.itemTextOverflow.defaultValue,[C.required]],itemTextSize:[K.itemTextSize.defaultValue,[C.required]],marginBottom:[K.marginBottom.defaultValue,[C.required]],marginTop:[K.marginTop.defaultValue,[C.required]],multiline:[K.multiline.defaultValue,[C.required]],spaceBetweenItems:[K.spaceBetweenItems.defaultValue,[C.required]],spaceBetweenLines:[K.spaceBetweenLines.defaultValue,[C.required]]}),tags:[[],[]]})}onConfirm(){let t=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:t.name,description:t.description,type:"ITEM_BAND",shared:!0,tags:t.tags,properties:t.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(me),u(M),u(H),u(ve))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:37,vars:6,consts:[["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name"],["formControlName","description","rows","3"],["formControlName","tags"],[1,"section-divider"],[3,"form"],[1,"action-bar"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Create band"),r(),s(3,"app-create-band-wizard-step",0),a(4,"div",1)(5,"form",2)(6,"label"),l(7," Label "),a(8,"span",3),l(9,"(required)"),r(),s(10,"br")(11,"input",4),r(),s(12,"br"),a(13,"label"),l(14," Description "),a(15,"span",3),l(16,"(optional)"),r(),s(17,"br")(18,"textarea",5),r(),s(19,"br"),a(20,"label"),l(21," Tags "),s(22,"br")(23,"ya-tag-select",6),r(),s(24,"br"),a(25,"div",7),s(26,"mat-divider"),r(),a(27,"h4"),l(28,"Styles"),r(),s(29,"app-item-band-styles",8),r(),a(30,"p"),l(31,"\xA0"),r(),a(32,"div",9)(33,"ya-button",10),l(34,"Cancel"),r(),a(35,"ya-button",11),g("click",function(){return i.onConfirm()}),l(36," CREATE "),r()()()()),e&2&&(p(5),c("formGroup",i.form),p(24),c("form",i.form),p(4),c("queryParams",R(4,Br,i.yamcs.context)),p(2),c("disabled",!i.form.valid))},dependencies:[he,W,U,Ot,x,D,I,B,w,E,V,J,te,A,Ge],encapsulation:2,changeDetection:0})}};var Qi="_overrideBand",Xt=class n{constructor(t,e,i,o,m){this.dialogRef=t;this.yamcs=i;this.messageService=o;this.data=m;this.startConstraintOptions=[{id:"START_ON",label:"Start on"}];let d=ie(Lt,{});this.form=e.group({name:["",C.required],start:[re.toISOString(i.getMissionTime()),C.required],duration:["",C.required],tags:[[],[]],properties:e.group({backgroundColor:[d.backgroundColor,[]],backgroundColor_overrideBand:!1,borderColor:[d.borderColor,[]],borderColor_overrideBand:!1,borderWidth:[d.borderWidth,[]],borderWidth_overrideBand:!1,cornerRadius:[d.cornerRadius,[]],cornerRadius_overrideBand:!1,marginLeft:[d.marginLeft,[]],marginLeft_overrideBand:!1,textColor:[d.textColor,[]],textColor_overrideBand:!1,textSize:[d.textSize,[]],textSize_overrideBand:!1})}),this.updateDisabledState(),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.updateDisabledState()})}updateDisabledState(){let{controls:t}=this.propertiesGroup;for(let e in t)if(e.endsWith(Qi)){let i=t[e.substring(0,e.length-Qi.length)];t[e].value?i.enable({onlySelf:!0}):i.disable({onlySelf:!0})}}get propertiesGroup(){return this.form.controls.properties}save(){let t={type:this.data.type,name:this.form.value.name,start:re.toISOString(this.form.value.start),duration:this.form.value.duration,tags:this.form.value.tags,properties:{}},{controls:e}=this.propertiesGroup;for(let i in e)if(i.endsWith(Qi)&&e[i].value){let o=i.substring(0,i.length-Qi.length);t.properties[o]=e[o].value}this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,t).then(i=>this.dialogRef.close(i)).catch(i=>this.messageService.showError(i))}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(Re),u(me),u(M),u(H),u(Ae))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:37,vars:7,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["animationDuration","0ms",1,"small-tabs",3,"mat-stretch-tabs"],["label","General"],[2,"margin-top","1em"],["cdkFocusRegionstart","","type","text","formControlName","name",2,"width","100%"],[1,"half-break"],["dialogTitle","Tags"],["formControlName","tags"],["formControlName","duration"],[1,"section-divider","half-break"],["formControlName","start"],["label","Styles"],[3,"form"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"h2",0),l(1),k(2,"lowercase"),r(),a(3,"mat-dialog-content")(4,"form",1)(5,"mat-tab-group",2)(6,"mat-tab",3)(7,"div",4)(8,"label"),l(9," Name "),s(10,"br")(11,"input",5),r(),s(12,"hr",6),a(13,"label"),l(14," Tags "),a(15,"ya-help",7),l(16," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),r(),s(17,"br")(18,"ya-tag-select",8),r(),s(19,"hr",6),a(20,"label"),l(21," Duration "),s(22,"ya-duration-input",9),r(),a(23,"div",10),s(24,"mat-divider"),r(),a(25,"label"),l(26," Start "),s(27,"br")(28,"ya-date-time-input",11),r()()(),a(29,"mat-tab",12)(30,"div",4),s(31,"app-item-styles",13),r()()()()(),a(32,"mat-dialog-actions",14)(33,"ya-button",15),l(34,"CANCEL"),r(),a(35,"ya-button",16),g("click",function(){return i.save()}),l(36,"SAVE"),r()()),e&2&&(p(),$("Add ",N(2,5,i.data.type)," item"),p(3),c("formGroup",i.form),p(),c("mat-stretch-tabs",!1),p(26),c("form",i.form),p(4),c("disabled",!i.form.valid))},dependencies:[ut,x,Bn,D,I,B,w,E,V,Le,xt,wt,Tt,te,vi,bi,A,at,Vt,Be,Ge],encapsulation:2,changeDetection:0})}};var Vr=n=>({c:n}),kr=()=>[];function Nr(n,t){if(n&1){let e=L();a(0,"th",24)(1,"input",25),g("change",function(o){b(e);let m=h(2);return S(o?m.masterToggle():null)}),r()()}if(n&2){let e=h(2);p(),c("checked",e.selection.hasValue()&&e.isAllSelected())}}function Fr(n,t){if(n&1){let e=L();a(0,"td",26)(1,"input",27),g("click",function(o){return b(e),S(o.stopPropagation())})("change",function(o){let m=b(e).$implicit,d=h(2);return S(o?d.selection.toggle(m):null)}),r()()}if(n&2){let e=t.$implicit,i=h(2);p(),c("checked",i.selection.isSelected(e))}}function Rr(n,t){n&1&&(a(0,"th",28),l(1,"Label"),r())}function Ar(n,t){if(n&1&&l(0),n&2){let e=h().$implicit;$(" ",e.name," ")}}function Lr(n,t){n&1&&(a(0,"i"),l(1,"(none)"),r())}function Or(n,t){if(n&1&&(a(0,"td",29)(1,"a",30),_(2,Ar,1,1)(3,Lr,2,0,"i"),r()()),n&2){let e=t.$implicit,i=h(2);p(),c("routerLink",e.id)("queryParams",R(4,Vr,i.yamcs.context)),p(),T(e.name?2:-1),p(),T(e.name?-1:3)}}function Gr(n,t){n&1&&(a(0,"th",28),l(1,"Tags"),r())}function qr(n,t){if(n&1&&(a(0,"ya-label"),l(1),r()),n&2){let e=t.$implicit;p(),ze(e)}}function $r(n,t){n&1&&l(0," - ")}function zr(n,t){if(n&1&&(a(0,"td",29),pe(1,qr,2,1,"ya-label",null,ye),_(3,$r,1,0),r()),n&2){let e=t.$implicit;p(),ce(e.tags||pi(1,kr)),p(2),T(e.tags?-1:3)}}function Yr(n,t){n&1&&(a(0,"th",28),l(1,"Start"),r())}function jr(n,t){if(n&1&&(a(0,"td",29),l(1),k(2,"datetime"),r()),n&2){let e=t.$implicit;p(),$(" ",N(2,1,e.start)||"-"," ")}}function Ur(n,t){n&1&&(a(0,"th",28),l(1,"Duration"),r())}function Wr(n,t){if(n&1&&(a(0,"td",29),l(1),r()),n&2){let e=t.$implicit;p(),$(" ",e.duration," ")}}function Hr(n,t){n&1&&(a(0,"th",28),l(1,"Type"),r())}function Qr(n,t){if(n&1&&(a(0,"td",29),l(1),r()),n&2){let e=t.$implicit;p(),$(" ",e.type," ")}}function Xr(n,t){n&1&&s(0,"th",31)}function Jr(n,t){n&1&&s(0,"td",29)}function Zr(n,t){n&1&&s(0,"tr",32)}function Kr(n,t){if(n&1){let e=L();a(0,"tr",33),g("click",function(){let o=b(e).$implicit,m=h(2);return S(m.toggleOne(o))}),r()}if(n&2){let e=t.$implicit,i=h(2);ne("selected",i.selection.isSelected(e))}}function ea(n,t){if(n&1&&(a(0,"table",7),Q(1,8),_(2,Nr,2,1,"th",9)(3,Fr,2,1,"td",10),X(),Q(4,11),_(5,Rr,2,0,"th",12)(6,Or,4,6,"td",13),X(),Q(7,14),_(8,Gr,2,0,"th",15)(9,zr,4,2,"td",16),X(),Q(10,17),_(11,Yr,2,0,"th",12)(12,jr,3,3,"td",13),X(),Q(13,18),_(14,Ur,2,0,"th",12)(15,Wr,2,1,"td",13),X(),Q(16,19),_(17,Hr,2,0,"th",12)(18,Qr,2,1,"td",13),X(),Q(19,20),_(20,Xr,1,0,"th",21)(21,Jr,1,0,"td",13),X(),_(22,Zr,1,0,"tr",22)(23,Kr,1,2,"tr",23),r()),n&2){let e=h();c("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),p(22),c("matHeaderRowDef",e.displayedColumns),p(),c("matRowDefColumns",e.displayedColumns)}}var Xi=class n{constructor(t,e,i,o){this.yamcs=t;this.messageService=i;this.dialog=o;this.displayedColumns=["select","name","tags","start","duration","type","actions"];this.tableTrackerFn=(t,e)=>e.id;this.dataSource=new Ye;this.selection=new Nt(this.tableTrackerFn,!0,[]);e.setTitle("Timeline Items"),this.refreshData()}ngAfterViewInit(){this.dataSource.sort=this.sort}isAllSelected(){let t=this.selection.selected.length,e=this.dataSource.filteredData.length;return t===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}deleteSelectedItems(){if(confirm("Are you sure you want to delete the selected items?"))for(let t of this.selection.selected)this.deleteItem(t.id,!1)}deleteItem(t,e=!0){(!e||confirm("Are you sure you want to delete the selected item?"))&&this.yamcs.yamcsClient.deleteTimelineItem(this.yamcs.instance,t).then(()=>this.refreshData()).catch(i=>this.messageService.showError(i))}isGroupDeleteEnabled(){return!this.selection.isEmpty()}openCreateItemDialog(t){this.dialog.open(Xt,{width:"600px",panelClass:"dialog-force-no-scrollbar",data:{type:t}}).afterClosed().subscribe(()=>this.refreshData())}refreshData(){this.yamcs.yamcsClient.getTimelineItems(this.yamcs.instance,{source:"rdb"}).then(t=>{this.selection.matchNewValues(t.items||[]),this.dataSource.data=t.items||[]}).catch(t=>this.messageService.showError(t))}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(oe),u(H),u(yi))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Se(Pe,5),e&2){let o;xe(o=Te())&&(i.sort=o.first)}},decls:15,vars:4,consts:[["itemMenu","matMenu"],["icon","add_circle_outline",3,"matMenuTriggerFor"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Events are items that simply appear on the timeline",3,"click"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Activities are like events, but in addition have an execution status",3,"click"],["icon","close",3,"clicked","disabled"],[1,"panel-content"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","tags"],["mat-header-cell","","mat-sort-header","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["matColumnDef","start"],["matColumnDef","duration"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink","queryParams"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){if(e&1){let o=L();a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2," Items \xA0\xA0\xA0 "),a(3,"ya-page-button",1),l(4," Create item "),r(),a(5,"mat-menu",2,0)(7,"button",3),g("click",function(){return b(o),S(i.openCreateItemDialog("EVENT"))}),l(8," Event item "),r(),a(9,"button",4),g("click",function(){return b(o),S(i.openCreateItemDialog("ACTIVITY"))}),l(10," Activity item "),r()(),a(11,"ya-page-button",5),g("clicked",function(){return b(o),S(i.deleteSelectedItems())}),l(12," Delete "),r()(),a(13,"div",6),_(14,ea,24,4,"table",7),r()()}if(e&2){let o=le(6);p(3),c("matMenuTriggerFor",o),p(2),c("overlapTrigger",!1),p(6),c("disabled",!i.isGroupDeleteEnabled()),p(3),T(i.dataSource?14:-1)}},dependencies:[W,U,x,J,Xe,Je,Ze,gi,Ci,_i,Pe,Dt,Ke,Mt,Bt,Pt,Et,It,et,tt,it,nt,Me,Ti,lt,pt],encapsulation:2,changeDetection:0})}};var ta=n=>({c:n});function ia(n,t){if(n&1){let e=L();a(0,"ya-stepper-step",8)(1,"ya-stepper-step-actions")(2,"ya-icon-action",12),g("click",function(){let o=b(e).$index,m=h();return S(m.moveUp(o))}),r(),a(3,"ya-icon-action",13),g("click",function(){let o=b(e).$index,m=h();return S(m.moveDown(o))}),r(),a(4,"ya-icon-action",14),g("click",function(){let o=b(e).$index,m=h();return S(m.removeTrace(o))}),r(),a(5,"ya-icon-action",15),g("click",function(){let o=b(e).$index,m=h();return S(m.addTrace(o))}),r()(),s(6,"app-trace-styles",7),r()}if(n&2){let e=t.$implicit,i=t.$index,o=h();si("label","Trace ",i+1,""),c("expanded",!0),p(2),c("disabled",i===0),p(),c("disabled",i>=o.traces.controls.length-1),p(),c("disabled",o.traces.controls.length<=1),p(2),c("form",e)}}var Ji=class n extends ot{constructor(e,i){super();this.formBuilder=e;this.yamcs=i;this.setTitle("Configure parameter plot"),this.form=e.group({name:["",[C.required]],description:"",traces:e.array([]),properties:e.group({frozen:[ue.frozen.defaultValue,[C.required]],height:[ue.height.defaultValue,[C.required]],minimum:[],maximum:[],zeroLineWidth:[ue.zeroLineWidth.defaultValue,[C.required]],zeroLineColor:[ue.zeroLineColor.defaultValue,[C.required]],minimumFractionDigits:[ue.minimumFractionDigits.defaultValue,[C.required]],maximumFractionDigits:[ue.maximumFractionDigits.defaultValue,[C.required]]})}),this.addTrace()}get traces(){return this.form.controls.traces}addTrace(e){let i=e===void 0?0:e+1,o=qt[i%qt.length],m=this.formBuilder.group({parameter:["",[C.required]],lineColor:[o,[C.required]],visible:[!0,[C.required]],lineWidth:[1,[C.required]],minMax:[!0,[C.required]],minMaxOpacity:[.17,[C.required]],fill:[!1,[C.required]],fillColor:["#dddddd",[C.required]]});e!==void 0?this.traces.insert(e+1,m):this.traces.push(m)}removeTrace(e){this.traces.removeAt(e)}moveUp(e){let i=this.traces.at(e);this.traces.removeAt(e),this.traces.insert(e-1,i)}moveDown(e){let i=this.traces.at(e);this.traces.removeAt(e),this.traces.insert(e+1,i)}onConfirm(){let e=this.form.value,i={name:e.name,description:e.description,type:"PARAMETER_PLOT",shared:!0,properties:{}};for(let o in e.properties){let m=e.properties[o];m!==null&&(i.properties[o]=m)}for(let o=0;o<this.traces.length;o++){let m=this.traces.at(o);for(let d in m.controls){let f=`trace_${o+1}_${d}`,y=m.controls[d].value;i.properties[f]=y}}dt(i.properties||{}),this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,i).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(o=>this.messageService.showError(o))}static{this.\u0275fac=function(i){return new(i||n)(u(Ee),u(M))}}static{this.\u0275cmp=v({type:n,selectors:[["app-create-parameter-plot"]],features:[He],decls:32,vars:7,consts:[["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","General",3,"expanded"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[3,"form"],[3,"label","expanded"],[1,"action-bar"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove trace",3,"click","disabled"],["icon","add_circle_outline","matTooltip","Add trace below",3,"click"]],template:function(i,o){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Create band"),r(),s(3,"app-create-band-wizard-step",0),a(4,"div",1)(5,"form",2)(6,"ya-stepper")(7,"ya-stepper-step",3)(8,"label"),l(9," Label "),a(10,"span",4),l(11,"(required)"),r(),s(12,"br")(13,"input",5),r(),s(14,"br"),a(15,"label"),l(16," Description "),a(17,"span",4),l(18,"(optional)"),r(),s(19,"br")(20,"textarea",6),r(),s(21,"br")(22,"app-parameter-plot-styles",7),r(),pe(23,ia,7,7,"ya-stepper-step",8,ye),r()(),a(25,"p"),l(26,"\xA0"),r(),a(27,"div",9)(28,"ya-button",10),l(29,"Cancel"),r(),a(30,"ya-button",11),g("click",function(){return o.onConfirm()}),l(31," CREATE "),r()()()()),i&2&&(p(5),c("formGroup",o.form),p(2),c("expanded",!0),p(15),c("form",o.form),p(),ce(o.traces.controls),p(5),c("queryParams",R(5,ta,o.yamcs.context)),p(2),c("disabled",!o.form.valid))},dependencies:[he,W,U,$t,zt,x,D,I,B,w,E,V,J,Me,A,rt,st,mt,wi],encapsulation:2,changeDetection:0})}};var na=n=>({c:n});function oa(n,t){n&1&&s(0,"input",18)}function ra(n,t){n&1&&s(0,"input",25)(1,"input",26)}function aa(n,t){if(n&1){let e=L();a(0,"tr",16)(1,"td"),s(2,"input",17,0),l(4),k(5,"titlecase"),r(),a(6,"td"),_(7,oa,1,0,"input",18)(8,ra,2,0),r(),a(9,"td"),l(10,"\u2192"),r(),a(11,"td"),s(12,"input",19),r(),a(13,"td"),s(14,"ya-color-input",20),r(),a(15,"td",21)(16,"ya-icon-action",22),g("click",function(){let o=b(e).$index,m=h(2);return S(m.moveUp(o))}),r(),a(17,"ya-icon-action",23),g("click",function(){let o=b(e).$index,m=h(2);return S(m.moveDown(o))}),r(),a(18,"ya-icon-action",24),g("click",function(){let o=b(e).$index,m=h(2);return S(m.removeMapping(o))}),r()()()}if(n&2){let e=t.$implicit,i=t.$index,o=le(3),m=h(2);c("formGroupName",i),p(4),$(" ",N(5,6,e.value.type)," "),p(3),T(o.value==="value"?7:o.value==="range"?8:-1),p(9),c("disabled",i===0),p(),c("disabled",i>=m.valueMappings.controls.length-1),p(),c("disabled",m.valueMappings.controls.length<=1)}}function la(n,t){if(n&1&&(a(0,"table",14)(1,"tr")(2,"th"),l(3,"Type"),r(),a(4,"th"),l(5," Condition "),a(6,"span",5),l(7,"(required)"),r()(),s(8,"th"),a(9,"th"),l(10,"Label"),r(),a(11,"th"),l(12,"Color"),r(),s(13,"th",15),r(),pe(14,aa,19,8,"tr",16,ye),r(),s(16,"br")),n&2){let e=h();p(14),ce(e.valueMappings.controls)}}var Zi=class n extends ot{constructor(e,i){super();this.formBuilder=e;this.yamcs=i;this.setTitle("Configure parameter states"),this.form=e.group({name:["",[C.required]],description:"",valueMappings:e.array([]),properties:e.group({frozen:[Ue.frozen.defaultValue,[C.required]],height:[Ue.height.defaultValue,[C.required]],parameter:["",[C.required]]})})}get valueMappings(){return this.form.controls.valueMappings}addValueMapping(){let e=this.formBuilder.group({type:["value",[C.required]],value:["",[C.required]],label:[""],color:[""]});this.valueMappings.push(e)}addRangeMapping(){let e=this.formBuilder.group({type:["range",[C.required]],start:["",[C.required]],end:["",[C.required]],label:[""],color:[""]});this.valueMappings.push(e)}removeMapping(e){this.valueMappings.removeAt(e)}moveUp(e){let i=this.valueMappings.at(e);this.valueMappings.removeAt(e),this.valueMappings.insert(e-1,i)}moveDown(e){let i=this.valueMappings.at(e);this.valueMappings.removeAt(e),this.valueMappings.insert(e+1,i)}onConfirm(){let e=this.form.value,i={name:e.name,description:e.description,type:"PARAMETER_STATES",shared:!0,properties:{}};for(let o in e.properties){let m=e.properties[o];m!==null&&(i.properties[o]=m)}for(let o=0;o<this.valueMappings.length;o++){let m=this.valueMappings.at(o);for(let d in m.controls){let f=`value_mapping_${o}_${d}`,y=m.controls[d].value;i.properties[f]=y}}dt(i.properties||{}),this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,i).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(o=>this.messageService.showError(o))}static{this.\u0275fac=function(i){return new(i||n)(u(Ee),u(M))}}static{this.\u0275cmp=v({type:n,selectors:[["app-create-parameter-states"]],features:[He],decls:37,vars:9,consts:[["type",""],["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],["label","General",3,"expanded"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[3,"form"],["label","Value mapping",3,"expanded"],["icon","add_circle_outline",3,"click"],[1,"action-bar"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"],["yaSimpleTable","","formArrayName","valueMappings",1,"mappings"],[2,"width","99%"],[3,"formGroupName"],["type","hidden","formControlName","type"],["type","text","placeholder","value","formControlName","value",2,"width","164px"],["type","text","placeholder","(optional)","formControlName","label",2,"width","140px"],["formControlName","color","label","auto"],[2,"text-align","right"],["icon","arrow_drop_up","matTooltip","Move up",3,"click","disabled"],["icon","arrow_drop_down","matTooltip","Move down",3,"click","disabled"],["icon","delete_outline","matTooltip","Remove mapping",3,"click","disabled"],["type","number","placeholder","start","formControlName","start",2,"width","80px","margin-right","4px"],["type","number","placeholder","end","formControlName","end",2,"width","80px"]],template:function(i,o){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Create band"),r(),s(3,"app-create-band-wizard-step",1),a(4,"div",2)(5,"form",3)(6,"ya-stepper")(7,"ya-stepper-step",4)(8,"label"),l(9," Label "),a(10,"span",5),l(11,"(required)"),r(),s(12,"br")(13,"input",6),r(),s(14,"br"),a(15,"label"),l(16," Description "),a(17,"span",5),l(18,"(optional)"),r(),s(19,"br")(20,"textarea",7),r(),s(21,"br")(22,"app-parameter-states-styles",8),r(),a(23,"ya-stepper-step",9),_(24,la,17,0),a(25,"ya-button",10),g("click",function(){return o.addValueMapping()}),l(26," Add value mapping "),r(),l(27," \xA0 "),a(28,"ya-button",10),g("click",function(){return o.addRangeMapping()}),l(29," Add range mapping "),r()()()(),a(30,"p"),l(31,"\xA0"),r(),a(32,"div",11)(33,"ya-button",12),l(34,"Cancel"),r(),a(35,"ya-button",13),g("click",function(){return o.onConfirm()}),l(36," CREATE "),r()()()()),i&2&&(p(5),c("formGroup",o.form),p(2),c("expanded",!0),p(15),c("form",o.form),p(),c("expanded",!0),p(),T(o.valueMappings.length?24:-1),p(9),c("queryParams",R(7,na,o.yamcs.context)),p(2),c("disabled",!o.form.valid))},dependencies:[he,W,U,jt,ci,x,D,I,fe,B,w,E,V,de,fi,J,se,Me,A,Si,rt,st,mt],styles:["table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:first-child){padding-left:5px}table.mappings[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:last-child), table.mappings[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:last-child){padding-right:5px}"],changeDetection:0})}};var ma=n=>({c:n}),Ki=class n extends ot{constructor(e,i){super();this.yamcs=i;this.setTitle("Configure Spacer"),this.form=e.group({name:"",description:"",properties:e.group({height:[zi.height.defaultValue,[C.required]]})})}onConfirm(){let e=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:e.name,description:e.description,type:"SPACER",shared:!0,properties:e.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(i=>this.messageService.showError(i))}static{this.\u0275fac=function(i){return new(i||n)(u(Ee),u(M))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],features:[He],decls:32,vars:6,consts:[["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],[1,"section-divider"],[3,"form"],[1,"action-bar"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(i,o){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Create band"),r(),s(3,"app-create-band-wizard-step",0),a(4,"div",1)(5,"form",2)(6,"label"),l(7," Label "),a(8,"span",3),l(9,"(optional)"),r(),s(10,"br")(11,"input",4),r(),s(12,"br"),a(13,"label"),l(14," Description "),a(15,"span",3),l(16,"(optional)"),r(),s(17,"br")(18,"textarea",5),r(),s(19,"br"),a(20,"div",6),s(21,"mat-divider"),r(),a(22,"h4"),l(23,"Styles"),r(),s(24,"app-spacer-styles",7),r(),a(25,"p"),l(26,"\xA0"),r(),a(27,"div",8)(28,"ya-button",9),l(29,"Cancel"),r(),a(30,"ya-button",10),g("click",function(){return o.onConfirm()}),l(31," CREATE "),r()()()()),i&2&&(p(5),c("formGroup",o.form),p(19),c("form",o.form),p(4),c("queryParams",R(4,ma,o.yamcs.context)),p(2),c("disabled",!o.form.valid))},dependencies:[he,W,U,x,D,I,B,w,E,V,J,te,A,Wt],encapsulation:2,changeDetection:0})}};var sa=n=>({c:n}),en=class n extends ot{constructor(e,i){super();this.yamcs=i;this.setTitle("Configure Time Ruler"),this.form=e.group({name:["",[C.required]],description:"",properties:e.group({timezone:["UTC",[C.required]]})})}onConfirm(){let e=this.form.value;this.yamcs.yamcsClient.createTimelineBand(this.yamcs.instance,{name:e.name,description:e.description,type:"TIME_RULER",shared:!0,properties:e.properties}).then(()=>this.router.navigateByUrl(`/timeline/bands?c=${this.yamcs.context}`)).catch(i=>this.messageService.showError(i))}static{this.\u0275fac=function(i){return new(i||n)(u(me),u(M))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],features:[He],decls:32,vars:5,consts:[["step","2"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name",2,"width","100%"],["formControlName","description","rows","3"],["formGroupName","properties"],["formControlName","timezone"],[1,"action-bar"],["routerLink","../..",3,"queryParams"],["appearance","primary",3,"click","disabled"]],template:function(i,o){i&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2,"Create band"),r(),s(3,"app-create-band-wizard-step",0),a(4,"div",1)(5,"form",2)(6,"label"),l(7," Label "),a(8,"span",3),l(9,"(required)"),r(),s(10,"br")(11,"input",4),r(),s(12,"br"),a(13,"label"),l(14," Description "),a(15,"span",3),l(16,"(optional)"),r(),s(17,"br")(18,"textarea",5),r(),Q(19,6),s(20,"br"),a(21,"label"),l(22," Timezone "),s(23,"br")(24,"ya-timezone-select",7),r(),X(),r(),a(25,"p"),l(26,"\xA0"),r(),a(27,"div",8)(28,"ya-button",9),l(29,"Cancel"),r(),a(30,"ya-button",10),g("click",function(){return o.onConfirm()}),l(31," CREATE "),r()()()()),i&2&&(p(5),c("formGroup",o.form),p(23),c("queryParams",R(3,sa,o.yamcs.context)),p(2),c("disabled",!o.form.valid))},dependencies:[he,W,U,x,D,I,B,w,E,V,de,J,A,Di],encapsulation:2,changeDetection:0})}};var ri=class extends Ft{constructor(t,e){super(t.timeline),this.label=e.name,this.paddingBottom=7,this.paddingTop=7,this.lineSpacing=2,this.itemHeight=20,this.data={band:e}}};function pa(n,t){if(n&1&&s(0,"app-edit-item-band",6),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function ca(n,t){if(n&1&&s(0,"app-edit-spacer",6),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function da(n,t){if(n&1&&s(0,"app-edit-time-ruler",6),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function ua(n,t){if(n&1&&s(0,"app-edit-command-band",6),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function fa(n,t){if(n&1&&s(0,"app-edit-parameter-plot",6),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function ha(n,t){if(n&1&&s(0,"app-edit-parameter-states",6),n&2){let e=h(),i=h();c("form",i.form)("band",e)}}function Ca(n,t){if(n&1&&(a(0,"div",1)(1,"h2"),l(2,"Edit band"),r(),a(3,"form",5),_(4,pa,1,2,"app-edit-item-band",6)(5,ca,1,2,"app-edit-spacer",6)(6,da,1,2,"app-edit-time-ruler",6)(7,ua,1,2,"app-edit-command-band",6)(8,fa,1,2,"app-edit-parameter-plot",6)(9,ha,1,2,"app-edit-parameter-states",6),r()()),n&2){let e=t,i=h();p(3),c("formGroup",i.form),p(),T(e.type==="ITEM_BAND"?4:e.type==="SPACER"?5:e.type==="TIME_RULER"?6:e.type==="COMMAND_BAND"?7:e.type==="PARAMETER_PLOT"?8:e.type==="PARAMETER_STATES"?9:-1)}}var tn=class n{constructor(t,e,i,o,m){this.dialogRef=t;this.yamcs=e;this.messageService=i;this.data=m;this.dirty$=new j(!1);let d=m.band;this.form=o.group({name:[d.name,[C.required]],description:[d.description||""],tags:[d.tags||[]],traces:o.array([]),valueMappings:o.array([]),properties:o.group({})}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}doOnConfirm(){let t=this.form.value,e={name:t.name,description:t.description,shared:this.data.band.shared,tags:t.tags,properties:t.properties};for(let i=0;i<this.traces.length;i++){let o=this.traces.at(i);for(let m in o.controls){let d=`trace_${i+1}_${m}`,f=o.controls[m].value;e.properties[d]=f}}for(let i=0;i<this.valueMappings.length;i++){let o=this.valueMappings.at(i);for(let m in o.controls){let d=`value_mapping_${i}_${m}`,f=o.controls[m].value;e.properties[d]=f}}dt(e.properties||{}),this.yamcs.yamcsClient.updateTimelineBand(this.yamcs.instance,this.data.band.id,e).then(i=>this.dialogRef.close(i)).catch(i=>this.messageService.showError(i))}get traces(){return this.form.controls.traces}get valueMappings(){return this.form.controls.valueMappings}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(Re),u(M),u(H),u(Ee),u(Ae))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:11,vars:4,consts:[[1,"central-pane"],[1,"ya-form",2,"max-width","600px"],[1,"footer"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"],["novalidate","","autocomplete","off",3,"formGroup"],[3,"form","band"]],template:function(e,i){if(e&1&&(a(0,"div",0),_(1,Ca,10,2,"div",1),r(),a(2,"div",2)(3,"mat-toolbar")(4,"mat-toolbar-row")(5,"ya-button",3),l(6,"CANCEL"),r(),l(7," \xA0\xA0 "),a(8,"ya-button",4),k(9,"async"),g("click",function(){return i.doOnConfirm()}),l(10," SAVE CHANGES "),r()()()()),e&2){let o;p(),T((o=i.data.band)?1:-1,o),p(7),c("disabled",!N(9,2,i.dirty$)||!i.form.valid)}},dependencies:[Rt,Gt,Yt,Ut,Ht,Qt,x,ee,D,w,E,Le,St,bt,A],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.central-pane[_ngcontent-%COMP%]{position:absolute;inset:0 0 64px;overflow:auto;padding:24px;font:400 12px/20px Roboto,sans-serif}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}"],changeDetection:0})}};var nn=class n{constructor(t,e,i,o,m){this.dialogRef=t;this.yamcs=e;this.messageService=o;this.data=m;this.dirty$=new j(!1);let d=m.view;this.form=i.group({name:[d.name,C.required],bands:[d.bands||[],[]]}),this.formSubscription=this.form.valueChanges.subscribe(()=>{this.dirty$.next(!0)})}onConfirm(){let t=this.form.value,e={name:t.name,bands:t.bands.map(o=>o.id)},i=this.data.view;this.yamcs.yamcsClient.updateTimelineView(this.yamcs.instance,i.id,e).then(o=>this.dialogRef.close(o)).catch(o=>this.messageService.showError(o))}ngOnDestroy(){this.formSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||n)(u(Re),u(M),u(me),u(H),u(Ae))}}static{this.\u0275cmp=v({type:n,selectors:[["app-edit-view-dialog"]],decls:25,vars:4,consts:[[1,"ya-form",2,"max-width","600px"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"hint"],["type","text","formControlName","name"],[1,"section-divider"],["formControlName","bands"],[1,"footer"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"form",1)(2,"h2"),l(3,"Edit View"),r(),a(4,"label"),l(5," Name "),a(6,"span",2),l(7,"(required)"),r(),s(8,"br")(9,"input",3),r(),s(10,"br"),a(11,"div",4),s(12,"mat-divider"),r(),a(13,"h4"),l(14,"Bands"),r(),s(15,"app-band-multi-select",5),r()(),a(16,"div",6)(17,"mat-toolbar")(18,"mat-toolbar-row")(19,"ya-button",7),l(20,"CANCEL"),r(),l(21," \xA0\xA0 "),a(22,"ya-button",8),k(23,"async"),g("click",function(){return i.onConfirm()}),l(24," SAVE CHANGES "),r()()()()),e&2&&(p(),c("formGroup",i.form),p(21),c("disabled",!N(23,2,i.dirty$)||!i.form.valid))},dependencies:[ct,x,ee,D,I,B,w,E,V,Le,te,St,bt,A],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}"],changeDetection:0})}};var on=class n{constructor(t,e){this.dialogRef=t;this.data=e;this.date=new vt(null,[C.required]);this.data.date&&this.date.setValue(re.toISOString(this.data.date))}select(){let t=re.toDate(this.date.value);this.dialogRef.close({date:t})}static{this.\u0275fac=function(e){return new(e||n)(u(Re),u(Ae))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],decls:11,vars:2,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formControl","showNow"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click"]],template:function(e,i){e&1&&(a(0,"h2",0),l(1,"Jump to date"),r(),a(2,"mat-dialog-content",1)(3,"label"),l(4," Date "),s(5,"ya-date-time-input",2),r()(),a(6,"mat-dialog-actions",3)(7,"ya-button",4),l(8,"CANCEL"),r(),a(9,"ya-button",5),g("click",function(){return i.select()}),l(10,"OK"),r()()),e&2&&(p(5),c("formControl",i.date)("showNow",!0))},dependencies:[x,B,kn,Le,xt,wt,Tt,A,at],encapsulation:2,changeDetection:0})}};var rn=class extends Jn{constructor(t,e){super(t.timeline),this.contentHeight=20,this.label=e.name,this.timezone=e.properties.timezone,this.data={band:e}}};var ga=["container"],po=n=>({c:n});function _a(n,t){if(n&1&&(a(0,"ya-page-button",17),l(1),k(2,"async"),r()),n&2){let e;h();let i=le(3),o=h();c("matMenuTriggerFor",i),p(),$(" ",((e=N(2,2,o.view$))==null?null:e.name)||"select view"," ")}}function ya(n,t){if(n&1){let e=L();a(0,"button",21),g("click",function(){let o=b(e).$implicit,m=h(2);return S(m.switchView(o))}),l(1),r()}if(n&2){let e=t.$implicit;p(),$(" ",e.name," ")}}function va(n,t){if(n&1&&(_(0,_a,3,4,"ya-page-button",17),k(1,"async"),a(2,"mat-menu",18,1),pe(4,ya,2,1,"button",19,ye),s(6,"mat-divider"),a(7,"a",20)(8,"mat-icon"),l(9,"add_circle_outline"),r(),l(10," Create view "),r()()),n&2){let e=h();T(N(1,2,e.view$)&&e.mayControlTimeline()?0:-1),p(4),ce(t),p(3),c("queryParams",R(4,po,e.yamcs.context))}}function ba(n,t){if(n&1&&(a(0,"ya-page-button",22),l(1," Create view "),r()),n&2){let e=h(2);c("queryParams",R(1,po,e.yamcs.context))}}function Sa(n,t){if(n&1){let e=L();a(0,"ya-page-button",29),g("clicked",function(){let o=b(e),m=h(2);return S(m.openEditViewDialog(o))}),l(1," Edit view "),r()}}function xa(n,t){if(n&1&&(a(0,"ya-page-button",24),l(1," Add item "),r()),n&2){h();let e=le(7);c("matMenuTriggerFor",e)}}function Ta(n,t){if(n&1){let e=L();a(0,"ya-page-button",30),g("clicked",function(){b(e);let o=h(2);return S(o.saveSnapshot())}),l(1," Save snapshot "),r()}}function wa(n,t){if(n&1){let e=L();_(0,ba,2,3,"ya-page-button",22),k(1,"async"),_(2,Sa,2,0,"ya-page-button",23),k(3,"async"),_(4,xa,2,1,"ya-page-button",24),k(5,"async"),a(6,"mat-menu",25,2)(8,"button",26),g("click",function(){b(e);let o=h();return S(o.openCreateItemDialog("EVENT"))}),l(9," Event item "),r(),a(10,"button",27),g("click",function(){b(e);let o=h();return S(o.openCreateItemDialog("ACTIVITY"))}),l(11," Activity item "),r()(),_(12,Ta,2,0,"ya-page-button",28),k(13,"async")}if(n&2){let e,i=h();T(N(1,5,i.view$)?-1:0),p(2),T((e=N(3,7,i.view$))?2:-1,e),p(2),T(N(5,9,i.view$)?4:-1),p(2),c("overlapTrigger",!1),p(6),T(N(13,11,i.view$)?12:-1)}}function Da(n,t){if(n&1&&(a(0,"span"),l(1),k(2,"datetime"),k(3,"datetime"),r()),n&2){let e=t;p(),En(" ",Pn(2,2,e==null?null:e.start,!1)," \u2013 ",N(3,5,e==null?null:e.stop)," ")}}var an=class n{constructor(t,e,i,o,m,d,f,y,P,F,Y){this.yamcs=e;this.dialog=i;this.messageService=o;this.formatter=m;this.route=d;this.router=f;this.authService=y;this.synchronizer=P;this.configService=F;this.overlay=Y;this.views$=new j([]);this.view$=new j(null);this.viewportRange$=new j(null);this.bands=[];this.subscriptions=[];t.setTitle("Timeline chart")}ngAfterViewInit(){let t=this.route.snapshot.queryParamMap,e=t.get("view");if(this.yamcs.yamcsClient.getTimelineViews(this.yamcs.instance).then(o=>{this.views$.next(o.views||[]);let m=null;for(let d of o.views||[])if(e===d.id){m=d;break}!m&&!e&&(m=o.views?.length?o.views[0]:null),m&&this.switchView(m)}),this.timeline=new Wn(this.container.nativeElement),this.timeline.addViewportChangeListener(o=>{this.viewportRange$.next({start:new Date(o.start),stop:new Date(o.stop)})}),this.viewportRange$.pipe(Tn(400)).forEach(o=>{this.refreshData(),this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParamsHandling:"merge",queryParams:{start:o.start.toISOString(),stop:o.stop.toISOString()}})}),t.get("start")&&t.get("stop")){let o=re.toDate(t.get("start")),m=re.toDate(t.get("stop"));this.timeline.setViewRange(o.getTime(),m.getTime())}else{let o=this.yamcs.getMissionTime(),m=Ct(o,-30),d=Ct(o,30);this.timeline.setViewRange(m.getTime(),d.getTime())}let i=new Qn(this.timeline);i.time=this.yamcs.getMissionTime().getTime(),this.subscriptions.push(this.synchronizer.sync(()=>{i.time=this.yamcs.getMissionTime().getTime()})),new Xn(this.timeline),new Zn(this.timeline,this.formatter),this.refreshData()}refreshView(){let t=this.view$.value;t&&this.yamcs.yamcsClient.getTimelineView(this.yamcs.instance,t.id).then(e=>this.switchView(e)).catch(e=>this.messageService.showError(e))}switchView(t){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{view:t?.id||null},queryParamsHandling:"merge"}),this.view$.next(t);for(let e of this.timeline.getBands())this.timeline.removeChild(e);if(t){for(let e of t.bands||[])if(e.type==="TIME_RULER"){let i=new rn(this,e);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="ITEM_BAND"){let i=new ti(this,e,this.dialog);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="SPACER"){let i=new cn(this.timeline);this.bands.push(i)}else if(e.type==="COMMAND_BAND"){let i=new ri(this,e);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="PARAMETER_PLOT"){let i=new ii(this,e,this.yamcs,this.synchronizer,this.configService,this.overlay);this.bands.push(i),this.installBandListeners(i)}else if(e.type==="PARAMETER_STATES"){let i=new oi(this,e,this.yamcs,this.synchronizer,this.formatter,this.configService,this.overlay);this.bands.push(i),this.installBandListeners(i)}this.refreshData()}}onVisibilityChange(){document.hidden||this.refreshView()}installBandListeners(t){t.addHeaderClickListener(e=>{let i=e.band.data.band;this.dialog.open(tn,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{band:i}}).afterClosed().subscribe(m=>{m&&this.refreshView()})})}refreshData(){let t=[],e=[],i=this.timeline.stop-this.timeline.start,o=this.timeline.start-i,m=this.timeline.stop+i;for(let d of this.bands)d instanceof ti?(t.push(d),e.push(this.yamcs.yamcsClient.getTimelineItems(this.yamcs.instance,{source:"rdb",band:d.data.band.id,start:new Date(o).toISOString(),stop:new Date(m).toISOString()}))):d instanceof ri?(t.push(d),e.push(this.yamcs.yamcsClient.getTimelineItems(this.yamcs.instance,{source:"commands",band:d.data.band.id,start:new Date(o).toISOString(),stop:new Date(m).toISOString()}))):(d instanceof ii||d instanceof oi)&&d.refreshData();e.length&&Promise.all(e).then(d=>{for(let f=0;f<d.length;f++){let y=t[f];this.populateItems(y,d[f].items||[])}}).catch(d=>this.messageService.showError(d))}populateItems(t,e){let i=[];for(let o of e){let m=re.toDate(o.start).getTime(),d=re.convertProtoDurationToMillis(o.duration),f={start:m,stop:d?m+d:void 0,label:o.name,data:{item:o}},{properties:y}=o;if(y&&("backgroundColor"in y&&(f.background=y.backgroundColor),"borderColor"in y&&(f.borderColor=y.borderColor),"borderWidth"in y&&(f.borderWidth=Number(y.borderWidth)),"cornerRadius"in y&&(f.cornerRadius=Number(y.cornerRadius)),"marginLeft"in y&&(f.paddingLeft=Number(y.marginLeft)),"textColor"in y&&(f.textColor=y.textColor),"textSize"in y&&(f.textSize=Number(y.textSize))),o.status)switch(o.status){case"COMPLETED":f.label=f.label?f.label+" \u2713":"\u2713";break;case"FAILED":f.label=f.label?f.label+" \u2717":"\u2717";break;case"PLANNED":case"IN_PROGRESS":f.label=f.label?f.label+" \u25F7":"\u25F7";break;case"ABORTED":f.label=f.label?f.label+" \u23F9":"\u23F9";break}i.push(f)}t.items=i}openCreateItemDialog(t){this.dialog.open(Xt,{width:"600px",panelClass:"dialog-force-no-scrollbar",data:{type:t}}).afterClosed().subscribe(()=>this.refreshData())}openEditViewDialog(t){this.dialog.open(nn,{width:"70%",height:"100%",panelClass:"dialog-full-size",autoFocus:!1,position:{right:"0"},data:{view:t}}).afterClosed().subscribe(e=>{e&&this.switchView(e)})}toggleMove(t){this.timeline.panBy(t),window.clearInterval(this.moveInterval),this.moveInterval=window.setInterval(()=>this.timeline.panBy(t),50)}untoggleMove(){window.clearInterval(this.moveInterval),this.moveInterval=void 0}pageLeft(){let{start:t,stop:e}=this.timeline,i=this.timeline.distanceBetween(t,e);this.timeline.panBy(-i)}pageRight(){let{start:t,stop:e}=this.timeline,i=this.timeline.distanceBetween(t,e);this.timeline.panBy(i)}zoomIn(){this.timeline.zoomIn()}zoomOut(){this.timeline.zoomOut()}show3Hours(){let t=this.timeline.start+(this.timeline.stop-this.timeline.start)/2,e=pn(t,-1.5),i=pn(t,1.5);this.timeline.setViewRange(e.getTime(),i.getTime())}show1Hour(){let t=this.timeline.start+(this.timeline.stop-this.timeline.start)/2,e=Ct(t,-30),i=Ct(t,30);this.timeline.setViewRange(e.getTime(),i.getTime())}show10Minutes(){let t=this.timeline.start+(this.timeline.stop-this.timeline.start)/2,e=Ct(t,-5),i=Ct(t,5);this.timeline.setViewRange(e.getTime(),i.getTime())}jumpToToday(){let t=this.yamcs.getMissionTime();t.setUTCHours(0,0,0,0);let e=t.getTime();t.setUTCDate(t.getUTCDate()+1);let i=t.getTime();this.timeline.setViewRange(e,i)}jumpToNow(){let t=this.yamcs.getMissionTime();this.timeline.panTo(t.getTime())}openJumpToDialog(){let t=this.timeline.center;this.dialog.open(on,{width:"400px",data:{date:new Date(t)}}).afterClosed().subscribe(e=>{e&&this.timeline.panTo(e.date.getTime())})}saveSnapshot(){let t=document.createElement("a");try{t.href=this.timeline.toDataURL(),t.download="timeline_"+this.view$.value.name+"_export.png",document.body.appendChild(t),t.click()}finally{document.body.removeChild(t)}}mayControlTimeline(){return this.authService.getUser().hasSystemPrivilege("ControlTimeline")}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.timeline.disconnect()}static{this.\u0275fac=function(e){return new(e||n)(u(oe),u(M),u(yi),u(H),u(xi),u(Qe),u(ve),u($n),u(On),u(Gn),u(In))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Se(ga,7),e&2){let o;xe(o=Te())&&(i.container=o.first)}},hostBindings:function(e,i){e&1&&g("visibilitychange",function(m){return i.onVisibilityChange(m)},!1,Dn)},decls:33,vars:8,consts:[["container",""],["viewMenu","matMenu"],["itemMenu","matMenu"],[3,"noscroll"],[2,"height","24px","margin","6px"],["icon","west",3,"click"],["icon","chevron_left",3,"mousedown","mouseup","mouseleave"],["icon","chevron_right",3,"mousedown","mouseup","mouseleave"],["icon","east",3,"click"],["icon","today",3,"click"],["icon","my_location",3,"click"],["icon","directions",3,"click"],[3,"click"],["icon","add",3,"click"],["icon","remove",3,"click"],[1,"timeline-container"],[1,"info"],["dropdown","true",3,"matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item",""],["mat-menu-item","","routerLink","/timeline/views/create",3,"queryParams"],["mat-menu-item","",3,"click"],["routerLink","/timeline/views/create","icon","add_circle_outline",3,"queryParams"],["icon","settings"],["icon","add_circle_outline",3,"matMenuTriggerFor"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Events are items that simply appear on the timeline",3,"click"],["mat-menu-item","","matTooltipShowDelay","1000","matTooltip","Activities are like events, but in addition have an execution status",3,"click"],["icon","photo_camera"],["icon","settings",3,"clicked"],["icon","photo_camera",3,"clicked"]],template:function(e,i){if(e&1){let o=L();a(0,"app-instance-page",3)(1,"app-instance-toolbar"),l(2," Timeline chart \xA0\xA0\xA0 "),_(3,va,11,6),k(4,"async"),_(5,wa,14,13),r(),a(6,"div",4)(7,"ya-button",5),g("click",function(){return b(o),S(i.pageLeft())}),r(),a(8,"ya-button",6),g("mousedown",function(){return b(o),S(i.toggleMove(-50))})("mouseup",function(){return b(o),S(i.untoggleMove())})("mouseleave",function(){return b(o),S(i.untoggleMove())}),r(),a(9,"ya-button",7),g("mousedown",function(){return b(o),S(i.toggleMove(50))})("mouseup",function(){return b(o),S(i.untoggleMove())})("mouseleave",function(){return b(o),S(i.untoggleMove())}),r(),a(10,"ya-button",8),g("click",function(){return b(o),S(i.pageRight())}),r(),l(11," \xA0 "),a(12,"ya-button",9),g("click",function(){return b(o),S(i.jumpToToday())}),l(13,"Today"),r(),a(14,"ya-button",10),g("click",function(){return b(o),S(i.jumpToNow())}),l(15,"Now"),r(),a(16,"ya-button",11),g("click",function(){return b(o),S(i.openJumpToDialog())}),l(17,"Jump to..."),r(),l(18," \xA0 "),a(19,"ya-button",12),g("click",function(){return b(o),S(i.show3Hours())}),l(20,"3 hours"),r(),a(21,"ya-button",12),g("click",function(){return b(o),S(i.show1Hour())}),l(22,"1 hour"),r(),a(23,"ya-button",12),g("click",function(){return b(o),S(i.show10Minutes())}),l(24,"10 min"),r(),l(25," \xA0 "),a(26,"ya-button",13),g("click",function(){return b(o),S(i.zoomIn())}),r(),a(27,"ya-button",14),g("click",function(){return b(o),S(i.zoomOut())}),r()(),s(28,"div",15,0),a(30,"div",16),_(31,Da,4,7,"span"),k(32,"async"),r()()}if(e&2){let o,m;c("noscroll",!0),p(3),T((o=N(4,4,i.views$))?3:-1,o),p(2),T(i.mayControlTimeline()?5:-1),p(26),T((m=N(32,6,i.viewportRange$))?31:-1,m)}},dependencies:[W,U,x,ee,J,hi,te,gi,Ci,_i,Me,A,lt,pt],styles:[".timeline-container[_ngcontent-%COMP%]{line-height:0;border-top:1px solid #d1d5da;position:absolute;inset:36px 0 0}.info[_ngcontent-%COMP%]{position:absolute;bottom:35px;right:0;margin-right:16px;background:#fff;opacity:.75;font-size:12px;line-height:12px}"],changeDetection:0})}};var co=n=>({c:n});function Ea(n,t){if(n&1){let e=L();a(0,"th",16)(1,"input",17),g("change",function(o){b(e);let m=h(2);return S(o?m.masterToggle():null)}),r()()}if(n&2){let e=h(2);p(),c("checked",e.selection.hasValue()&&e.isAllSelected())}}function Ma(n,t){if(n&1){let e=L();a(0,"td",18)(1,"input",19),g("click",function(o){return b(e),S(o.stopPropagation())})("change",function(o){let m=b(e).$implicit,d=h(2);return S(o?d.selection.toggle(m):null)}),r()()}if(n&2){let e=t.$implicit,i=h(2);p(),c("checked",i.selection.isSelected(e))}}function Pa(n,t){n&1&&(a(0,"th",20),l(1,"Label"),r())}function Ba(n,t){if(n&1&&(a(0,"td",21)(1,"a",22),l(2),r()()),n&2){let e=t.$implicit,i=h(2);p(),c("routerLink",e.id)("queryParams",R(3,co,i.yamcs.context)),p(),$(" ",e.name," ")}}function Ia(n,t){n&1&&(a(0,"th",23),l(1,"Description"),r())}function Va(n,t){if(n&1&&(a(0,"td",21),l(1),r()),n&2){let e=t.$implicit;p(),$(" ",e.description||"-"," ")}}function ka(n,t){n&1&&s(0,"th",24)}function Na(n,t){n&1&&s(0,"td",21)}function Fa(n,t){n&1&&s(0,"tr",25)}function Ra(n,t){if(n&1){let e=L();a(0,"tr",26),g("click",function(){let o=b(e).$implicit,m=h(2);return S(m.toggleOne(o))}),r()}if(n&2){let e=t.$implicit,i=h(2);ne("selected",i.selection.isSelected(e))}}function Aa(n,t){if(n&1&&(a(0,"table",3),Q(1,4),_(2,Ea,2,1,"th",5)(3,Ma,2,1,"td",6),X(),Q(4,7),_(5,Pa,2,0,"th",8)(6,Ba,3,5,"td",9),X(),Q(7,10),_(8,Ia,2,0,"th",11)(9,Va,2,1,"td",9),X(),Q(10,12),_(11,ka,1,0,"th",13)(12,Na,1,0,"td",9),X(),_(13,Fa,1,0,"tr",14)(14,Ra,1,2,"tr",15),r()),n&2){let e=h();c("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),p(13),c("matHeaderRowDef",e.displayedColumns),p(),c("matRowDefColumns",e.displayedColumns)}}var ln=class n{constructor(t,e,i){this.yamcs=t;this.messageService=i;this.displayedColumns=["select","name","description","actions"];this.tableTrackerFn=(t,e)=>e.id;this.dataSource=new Ye;this.selection=new Nt(this.tableTrackerFn,!0,[]);e.setTitle("Timeline Views"),this.refreshData()}ngAfterViewInit(){this.dataSource.sort=this.sort}isAllSelected(){let t=this.selection.selected.length,e=this.dataSource.filteredData.length;return t===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}deleteSelectedViews(){if(confirm("Are you sure you want to delete the selected views?"))for(let t of this.selection.selected)this.deleteView(t.id,!1)}deleteView(t,e=!0){(!e||confirm("Are you sure you want to delete the selected view?"))&&this.yamcs.yamcsClient.deleteTimelineView(this.yamcs.instance,t).then(()=>this.refreshData()).catch(i=>this.messageService.showError(i))}isGroupDeleteEnabled(){return!this.selection.isEmpty()}refreshData(){this.yamcs.yamcsClient.getTimelineViews(this.yamcs.instance).then(t=>{this.selection.matchNewValues(t.views||[]),this.dataSource.data=t.views||[]}).catch(t=>this.messageService.showError(t))}static{this.\u0275fac=function(e){return new(e||n)(u(M),u(oe),u(H))}}static{this.\u0275cmp=v({type:n,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Se(Pe,5),e&2){let o;xe(o=Te())&&(i.sort=o.first)}},decls:9,vars:5,consts:[["routerLink","create","icon","add_circle_outline",3,"queryParams"],["icon","close",3,"clicked","disabled"],[1,"panel-content"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink","queryParams"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,i){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),l(2," Views \xA0\xA0\xA0 "),a(3,"ya-page-button",0),l(4," Create view "),r(),a(5,"ya-page-button",1),g("clicked",function(){return i.deleteSelectedViews()}),l(6," Delete "),r()(),a(7,"div",2),_(8,Aa,15,4,"table",3),r()()),e&2&&(p(3),c("queryParams",R(3,co,i.yamcs.context)),p(2),c("disabled",!i.isGroupDeleteEnabled()),p(3),T(i.dataSource?8:-1))},dependencies:[W,U,x,J,Xe,Je,Ze,Pe,Dt,Ke,Mt,Bt,Pt,Et,It,et,tt,it,nt,lt],encapsulation:2,changeDetection:0})}};var vf=[{path:"",canActivate:[Yn,zn],canActivateChild:[jn],runGuardsAndResolvers:"always",component:Un,children:[{path:"",pathMatch:"full",redirectTo:"chart"},{path:"chart",component:an},{path:"views",pathMatch:"full",component:ln},{path:"views/create",pathMatch:"full",component:Ii},{path:"views/:view",pathMatch:"full",component:Wi},{path:"bands",pathMatch:"full",component:Mi},{path:"bands/create",pathMatch:"full",component:Bi},{path:"bands/create/item-band",pathMatch:"full",component:Hi},{path:"bands/create/spacer",pathMatch:"full",component:Ki},{path:"bands/create/time-ruler",pathMatch:"full",component:en},{path:"bands/create/parameter-plot",pathMatch:"full",component:Ji},{path:"bands/create/parameter-states",pathMatch:"full",component:Zi},{path:"bands/create/command-band",pathMatch:"full",component:Pi},{path:"bands/:band",pathMatch:"full",component:Yi},{path:"items",pathMatch:"full",component:Xi},{path:"items/:item",pathMatch:"full",component:Ui}]}];export{vf as ROUTES};
