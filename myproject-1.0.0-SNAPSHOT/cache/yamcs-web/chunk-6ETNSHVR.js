import{a as tt,c as it,d as ci,e as di}from"./chunk-J6RUEXVW.js";import{$ as yt,$c as ue,$e as ee,Aa as o,Ab as Re,Ac as ce,Af as ve,Ba as T,Bc as me,Ca as x,Cc as It,D as Ee,Da as y,Dc as Nt,Df as ei,Eb as $e,Ec as Ve,Fa as b,Fb as Ft,Fc as Z,Ga as g,Gb as Ae,Gc as pe,Ha as c,Hb as wt,He as _e,I as xt,Ib as Dt,Ie as Ye,Je as zt,Kc as de,Ke as he,Le as He,Lf as E,Lg as W,M as Oe,Ma as ut,Me as Yt,N as v,Na as _t,Nc as fe,Ne as Ce,Nf as Qe,O as S,Oa as ht,Oc as Lt,Pc as Rt,Qc as $t,Qf as ti,Ra as K,Rg as et,Sa as s,Sg as ne,T as Fe,Ta as R,Ua as h,Uf as Je,V as j,Va as Pe,We as Y,Wf as ii,X as Me,Xa as ke,Xc as At,Xe as Ge,Ya as M,Yc as z,Ye as We,Za as Ie,_a as Ct,_c as je,_e as qe,_f as ni,a as be,af as Ht,b as De,ba as l,bb as u,bd as Ue,bf as H,cb as _,cd as ze,cf as Xe,da as F,db as gt,dc as Et,dh as li,ef as Ke,f as D,ff as te,ga as O,gb as Ne,gf as Gt,hf as G,if as ie,ih as $,jb as Le,kg as ai,lg as oi,ma as d,mf as Wt,mg as ri,nb as se,nf as qt,ob as bt,of as Xt,og as Ze,oh as P,pa as ae,pf as ge,ph as si,qa as m,qb as J,qc as Ot,qf as Kt,qh as mi,ra as Tt,rh as pi,sa as k,tc as Mt,te as Bt,uc as Be,ue as Vt,va as f,vc as Pt,ve as jt,vf as Qt,wa as I,wc as kt,we as Ut,xa as N,ya as L,yc as vt,yf as Jt,za as r,zf as Zt}from"./chunk-MTJQDUEX.js";var bi=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),fi=(i,t)=>({c:i,service:t}),Se=class i{constructor(t){this.yamcs=t;this.service=j()}static{this.\u0275fac=function(e){return new(e||i)(F($))}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-tabs"]],inputs:{service:[1,"service"]},decls:10,vars:14,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/file-transfer","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/file-transfer/log","routerLinkActive","",3,"active","queryParams"]],template:function(e,n){if(e&1&&(r(0,"nav",3)(1,"a",4,0),s(3," Transfers "),o(),r(4,"a",5,1),s(6," Action log "),o()(),r(7,"mat-tab-nav-panel",null,2),T(9,"router-outlet"),o()),e&2){let a,p,w=K(2),A=K(5),B=K(8);m("mat-stretch-tabs",!1)("tabPanel",B),l(),m("routerLinkActiveOptions",M(7,bi))("active",w.isActive)("queryParams",Ct(8,fi,n.yamcs.context,(a=n.service())==null?null:a.name)),l(3),m("active",A.isActive)("queryParams",Ct(11,fi,n.yamcs.context,(p=n.service())==null?null:p.name))}},dependencies:[P,Ft,wt,Dt,Wt,Xt,qt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}};function wi(i,t){if(i&1){let e=b();T(0,"ya-date-time-input",14)(1,"ya-date-time-input",15),r(2,"ya-button",16),g("click",function(){v(e);let a=c();return S(a.applyCustomDates())}),s(3,"Apply"),o()}if(i&2){let e=c();l(2),m("disabled",e.filterForm.invalid)}}function Di(i,t){if(i&1){let e=b();r(0,"ya-button",17),g("click",function(){v(e);let a=c();return S(a.jumpToNow())}),s(1,"Jump to now"),o()}}function Ei(i,t){i&1&&(r(0,"th",18),s(1,"Time"),o())}function Oi(i,t){if(i&1&&(r(0,"td",19),s(1),u(2,"datetime"),o()),i&2){let e=t.$implicit;l(),R(_(2,1,e.time))}}function Mi(i,t){i&1&&(r(0,"th",18),s(1,"User"),o())}function Pi(i,t){if(i&1&&(r(0,"td",19),s(1),o()),i&2){let e=t.$implicit;l(),R(e.user||"-")}}function ki(i,t){i&1&&(r(0,"th",18),s(1,"Action"),o())}function Ii(i,t){if(i&1&&(r(0,"td",19),T(1,"ya-action-log-summary",20),o()),i&2){let e=t.$implicit;l(),m("text",e.summary)}}function Ni(i,t){i&1&&T(0,"th",21)}function Li(i,t){i&1&&T(0,"td",19)}function Ri(i,t){i&1&&T(0,"tr",22)}function $i(i,t){i&1&&T(0,"tr",23)}var nt=class i{constructor(t,e,n,a,p){this.yamcs=t;this.messageService=e;this.router=n;this.route=a;this.interval=j();this.customStart=j();this.customStop=j();this.filterForm=new It({interval:new Ve("NO_LIMIT"),customStart:new Ve(null),customStop:new Ve(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new ie;p.setTitle("File transfer")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(t=>{if(t==="CUSTOM"){let e=new Date,n=this.validStart||e,a=this.validStop||e;this.filterForm.get("customStart").setValue(E.toISOString(n)),this.filterForm.get("customStop").setValue(E.toISOString(a))}else t==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=t,this.loadData()):t&&(this.validStop=new Date,this.validStart=E.subtractDuration(this.validStop,t),this.appliedInterval=t,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=this.customStart();this.filterForm.get("customStart").setValue(t),this.validStart=E.toDate(t);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=E.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=E.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:t}=this.filterForm;this.validStart=E.toDate(t.customStart.value),this.validStop=E.toDate(t.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let t={service:"FileTransferApi"};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,t).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:t}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?t.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?t.customStop.value:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(e){return new(e||i)(F($),F(ge),F(Ae),F($e),F(Re))}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},decls:25,vars:7,consts:[[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"text"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(r(0,"app-instance-page")(1,"app-instance-toolbar"),s(2,"File transfer"),o(),r(3,"div",0),T(4,"app-file-transfer-tabs"),r(5,"form",1)(6,"div",2),T(7,"ya-select",3),d(8,wi,4,1)(9,Di,2,0,"ya-button"),o()(),r(10,"table",4),x(11,5),d(12,Ei,2,0,"th",6)(13,Oi,3,3,"td",7),y(),x(14,8),d(15,Mi,2,0,"th",6)(16,Pi,2,1,"td",7),y(),x(17,9),d(18,ki,2,0,"th",6)(19,Ii,2,1,"td",7),y(),x(20,10),d(21,Ni,1,0,"th",11)(22,Li,1,0,"td",7),y(),d(23,Ri,1,0,"tr",12)(24,$i,1,0,"tr",13),o()()()),e&2&&(l(5),m("formGroup",n.filterForm),l(2),m("options",n.intervalOptions),l(),f(n.filterForm.value.interval==="CUSTOM"?8:-1),l(),f(n.filterForm.value.interval!=="CUSTOM"?9:-1),l(),m("dataSource",n.dataSource),l(13),m("matHeaderRowDef",n.displayedColumns),l(),m("matRowDefColumns",n.displayedColumns))},dependencies:[Se,it,tt,P,pe,ce,me,de,fe,Y,We,Xe,qe,Ge,Ke,ee,H,te,G,Qt,ve,Qe,Je,W],encapsulation:2,changeDetection:0})}};var Ai=()=>["parent"];function Bi(i,t){i&1&&(r(0,"th",14),s(1,"Name"),o())}function Vi(i,t){if(i&1&&(r(0,"mat-icon",16),s(1,"folder"),o(),s(2),u(3,"filename")),i&2){let e=c().$implicit;l(2),h(" ",_(3,1,e.name)," ")}}function ji(i,t){if(i&1&&(r(0,"mat-icon",16),s(1,"description"),o(),r(2,"span",17),s(3),u(4,"filename"),o()),i&2){let e=c().$implicit,n=c(2);l(2),m("ngClass",n.foldersOnly?"disabled":""),l(),R(_(4,2,e.name))}}function Ui(i,t){if(i&1&&(r(0,"td",15),d(1,Vi,4,3)(2,ji,5,4),o()),i&2){let e=t.$implicit;l(),f(e.folder?1:2)}}function zi(i,t){i&1&&(r(0,"th",18),s(1,"Date modified"),o())}function Yi(i,t){if(i&1&&(r(0,"td",15)(1,"span",17),s(2),u(3,"datetime"),o()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),h(" ",_(3,2,e.modified)||"-"," ")}}function Hi(i,t){i&1&&(r(0,"th",19),s(1,"Size"),o())}function Gi(i,t){if(i&1&&(r(0,"td",15)(1,"span",17),s(2),u(3,"formatBytes"),o()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),h(" ",_(3,2,e.size)||"-"," ")}}function Wi(i,t){if(i&1&&(r(0,"td",20)(1,"mat-icon",21),s(2," description "),o(),s(3," .. "),o()),i&2){let e=c(2);ae("colspan",e.displayedColumns.length)}}function qi(i,t){if(i&1){let e=b();r(0,"tr",22),g("click",function(){v(e);let a=c(2);return S(a.clearSelection())}),o()}}function Xi(i,t){if(i&1){let e=b();r(0,"tr",23),u(1,"async"),g("click",function(){v(e);let a=c(2);return S(a.selectParent())}),o()}if(i&2){let e=c(2);k("hide",!_(1,2,e.currentPrefix$))}}function Ki(i,t){if(i&1){let e=b();r(0,"tr",24),g("click",function(a){let p=v(e).$implicit,w=c(2);return S(w.selectFile(a,p))}),o()}if(i&2){let e=t.$implicit,n=c(2);k("selected",n.isSelected(e))}}function Qi(i,t){if(i&1&&(r(0,"table",1),x(1,2),d(2,Bi,2,0,"th",3)(3,Ui,3,1,"td",4),y(),x(4,5),d(5,zi,2,0,"th",6)(6,Yi,4,4,"td",4),y(),x(7,7),d(8,Hi,2,0,"th",8)(9,Gi,4,4,"td",4),y(),x(10,9),d(11,Wi,4,1,"td",10),y(),d(12,qi,1,0,"tr",11)(13,Xi,2,4,"tr",12)(14,Ki,1,2,"tr",13),o()),i&2){let e=c();k("no-frame",e.noFrame)("no-select",e.noSelect),m("dataSource",e.dataSource),l(12),m("cdkHeaderRowDef",e.displayedColumns),l(),m("cdkHeaderRowDef",M(8,Ai)),l(),m("cdkRowDefColumns",e.displayedColumns)}}var ot=class i{constructor(t,e){this.changeDetection=e;this.noFrame=!1;this.noSelect=!1;this.allowFolderSelection=!1;this.prefixChange=new Fe;this.displayedColumns=["name","size","modified"];this.dataSource=new ie([]);this.currentPrefix$=new D(null);this.selectedFileNames=new Set;this.onChange=t=>{};this.onTouched=()=>{};this.storageClient=t.createStorageClient()}ngOnChanges(){this.bucket&&this.loadCurrentFolder()}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){let e={delimiter:"/"};t&&(e.prefix=t),this.storageClient.listObjects(this.bucket.name,e).then(n=>{this.changedir(n);let a=t||null;a!==this.currentPrefix$.value&&(this.currentPrefix$.next(a),this.prefixChange.emit(a))})}changedir(t){this.selectedFileNames.clear(),this.updateFileNames();let e=[];for(let n of t.prefixes||[])e.push({folder:!0,name:n});for(let n of t.objects||[])n.name.endsWith("/")||e.push({folder:!1,name:n.name,modified:n.created,size:n.size,objectUrl:this.storageClient.getObjectURL(this.bucket.name,n.name)});this.dataSource.data=e,this.changeDetection.detectChanges()}selectFile(t,e){if(e.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(e):this.loadCurrentFolder(e.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(e);else if(this.isMultiSelect&&t.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===e.name)this.flipRowSelection(e);else{let n=!1;for(let a of this.dataSource.data)(a.name===e.name||a.name===this.lastSelected.name)&&(n=!n),n&&this.selectedFileNames.add(a.name);this.selectedFileNames.add(e.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(e.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(e.name));this.selectedFileNames.has(e.name)&&(this.lastSelected=e)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){let t=this.currentPrefix$.value;if(t){let e=t.slice(0,-1),n=e.lastIndexOf("/");if(n){let a=e.substring(0,n+1);this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(a)}}}writeValue(t){this.path=t}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription&&this.selectionSubscription.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(F($),F(Ne))}}static{this.\u0275cmp=O({type:i,selectors:[["app-object-selector"]],inputs:{bucket:"bucket",isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",noFrame:"noFrame",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection"},outputs:{prefixChange:"prefixChange"},features:[ke([{provide:Be,useExisting:Ee(()=>i),multi:!0}]),Oe],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand",3,"dataSource","no-frame","no-select"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"]],template:function(e,n){e&1&&d(0,Qi,15,9,"table",0),e&2&&f(n.dataSource?0:-1)},dependencies:[P,se,J,Ce,_e,Ye,he,He,z,Y,ee,H,te,G,W,et,ne],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"],changeDetection:0})}};var Ji=()=>["parent"],Zi=()=>["progress"];function en(i,t){i&1&&T(0,"th",21)}function tn(i,t){if(i&1&&(r(0,"mat-icon"),s(1," check "),o()),i&2){let e=c().$implicit;Tt("visibility",e.checked?"visible":"hidden")}}function nn(i,t){if(i&1){let e=b();r(0,"button",25),g("click",function(){let a=v(e).$implicit,p=c().$implicit,w=c(2);return S(w.runFileAction(p.name,a))}),d(1,tn,2,2,"mat-icon",26),s(2),o()}if(i&2){let e=t.$implicit;m("disabled",!e.enabled),l(),f(e.style==="CHECK_BOX"?1:-1),l(),h(" ",e.label," ")}}function an(i,t){if(i&1&&(r(0,"td",22)(1,"ya-more",23),N(2,nn,3,3,"button",24,I),o()()),i&2){let e=c(2);l(),m("padding",!1),l(),L(e.fileActions)}}function on(i,t){i&1&&(r(0,"th",27),s(1,"Name"),o())}function rn(i,t){if(i&1&&(r(0,"mat-icon",29),s(1,"folder"),o(),s(2),u(3,"filename")),i&2){let e,n=c().$implicit;l(2),h(" ",(e=n.displayName)!==null&&e!==void 0?e:_(3,1,n.name),"/ ")}}function ln(i,t){if(i&1&&(r(0,"mat-icon",29),s(1,"description"),o(),r(2,"span",30),s(3),u(4,"filename"),o()),i&2){let e,n=c().$implicit,a=c(2);l(2),m("ngClass",a.foldersOnly?"disabled":""),l(),h(" ",(e=n.displayName)!==null&&e!==void 0?e:_(4,2,n.name)," ")}}function sn(i,t){if(i&1&&(r(0,"td",28),d(1,rn,4,3)(2,ln,5,4),o()),i&2){let e=t.$implicit;l(),f(e.folder?1:2)}}function cn(i,t){i&1&&(r(0,"th",31),s(1,"Date modified"),o())}function mn(i,t){if(i&1&&(r(0,"td",28)(1,"span",30),s(2),u(3,"datetime"),o()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),h(" ",_(3,2,e.modified)||"-"," ")}}function pn(i,t){i&1&&(r(0,"th",32),s(1,"Size"),o())}function dn(i,t){if(i&1&&(r(0,"td",28)(1,"span",30),s(2),u(3,"formatBytes"),o()()),i&2){let e=t.$implicit,n=c(2);l(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),l(),h(" ",_(3,2,e.size)||"-"," ")}}function fn(i,t){if(i&1&&(r(0,"td",33),u(1,"async"),r(2,"mat-icon",34),s(3," description "),o(),s(4," .. "),o()),i&2){let e,n=c(2);ae("colspan",(e=_(1,1,n.displayedColumns$))==null?null:e.length)}}function un(i,t){if(i&1&&(r(0,"td",35),u(1,"async"),s(2),T(3,"ya-dots",36),o()),i&2){let e,n=c(2);ae("colspan",(e=_(1,2,n.displayedColumns$))==null?null:e.length),l(2),h(" ",n.progressMessage()," ")}}function _n(i,t){if(i&1&&(r(0,"th",38),s(1),o()),i&2){let e=c().$implicit;l(),R(e.label)}}function hn(i,t){if(i&1&&s(0),i&2){let e,n=c().$implicit,a=c().$implicit;h(" ",(e=n.extra[a.id])!==null&&e!==void 0?e:"-"," ")}}function Cn(i,t){i&1&&s(0," - ")}function gn(i,t){if(i&1&&(r(0,"td",28),d(1,hn,1,1)(2,Cn,1,0),o()),i&2){let e=t.$implicit;l(),f(e.extra?1:2)}}function vn(i,t){if(i&1&&(x(0,16),d(1,_n,2,1,"th",37)(2,gn,3,1,"td",7),y()),i&2){let e=t.$implicit;m("cdkColumnDef",e.id)}}function Sn(i,t){if(i&1){let e=b();r(0,"tr",39),g("click",function(){v(e);let a=c(2);return S(a.clearSelection())}),o()}}function xn(i,t){if(i&1){let e=b();r(0,"tr",40),u(1,"async"),g("click",function(){v(e);let a=c(2);return S(a.selectParent())}),o()}if(i&2){let e=c(2);k("hide",!_(1,2,e.currentPrefix$))}}function yn(i,t){if(i&1){let e=b();r(0,"tr",41),g("click",function(a){let p=v(e).$implicit,w=c(2);return S(w.selectFile(a,p))}),o()}if(i&2){let e=t.$implicit,n=c(2);k("selected",n.isSelected(e))}}function Tn(i,t){if(i&1&&T(0,"tr",42),i&2){let e=c(2);k("hide",!e.progressMessage())}}function bn(i,t){if(i&1&&(r(0,"table",1),x(1,2),d(2,en,1,0,"th",3)(3,an,4,1,"td",4),y(),x(4,5),d(5,on,2,0,"th",6)(6,sn,3,1,"td",7),y(),x(7,8),d(8,cn,2,0,"th",9)(9,mn,4,4,"td",7),y(),x(10,10),d(11,pn,2,0,"th",11)(12,dn,4,4,"td",7),y(),x(13,12),d(14,fn,5,3,"td",13),y(),x(15,14),d(16,un,4,4,"td",15),y(),N(17,vn,3,1,"ng-container",16,I),u(19,"async"),d(20,Sn,1,0,"tr",17),u(21,"async"),d(22,xn,2,4,"tr",18)(23,yn,1,2,"tr",19),u(24,"async"),d(25,Tn,1,2,"tr",20),o()),i&2){let e=c();k("no-select",e.noSelect),m("dataSource",e.dataSource),l(17),L(_(19,7,e.extraColumns$)),l(3),m("cdkHeaderRowDef",_(21,9,e.displayedColumns$)),l(2),m("cdkHeaderRowDef",M(13,Ji)),l(),m("cdkRowDefColumns",_(24,11,e.displayedColumns$)),l(2),m("cdkFooterRowDef",M(14,Zi))}}var lt=class i{constructor(t){this.changeDetection=t;this.noSelect=!1;this.allowFolderSelection=!1;this.fileListExtraColumns=[];this.fileActions=[];this.prefixChange=new Fe;this.onAction=new Fe;this.displayedColumns$=new D(["name","size","modified"]);this.extraColumns$=new D([]);this.dataSource=new ie([]);this.progressMessage=Me(null);this.currentPrefix$=new D(null);this.selectedFileNames=new Set;this.onChange=t=>{};this.onTouched=()=>{}}ngOnChanges(){this.loadCurrentFolder();let t=[];this.fileActions.length&&t.push("actions"),t.push("name");for(let e of this.fileListExtraColumns)t.push(e.id);t.push("size"),t.push("modified"),this.extraColumns$.next(this.fileListExtraColumns),this.displayedColumns$.next(t)}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){if((t||null)!==this.currentPrefix$.value){let n={files:[],destination:"",remotePath:"",listTime:""};this.setFolderContent(t,n)}}setFolderContent(t,e){this.changeDir(e);let n=t||null;n!==this.currentPrefix$.value&&(this.currentPrefix$.next(n),this.prefixChange.emit(n))}changeDir(t){this.selectedFileNames.clear(),this.updateFileNames();let e=[],n=t.remotePath?t.remotePath+"/":"";for(let a of t.files||[]){let p=n+a.name;e.push({folder:a.isDirectory,name:p,displayName:a.displayName??a.name,modified:a.modified,size:a.size,extra:a.extra||{}})}this.progressMessage.set(t.progressMessage||null),this.dataSource.data=e,this.changeDetection.detectChanges()}selectFile(t,e){if(e.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(e):this.loadCurrentFolder(e.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(e);else if(this.isMultiSelect&&t.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===e.name)this.flipRowSelection(e);else{let n=!1;for(let a of this.dataSource.data)(a.name===e.name||a.name===this.lastSelected.name)&&(n=!n),n&&this.selectedFileNames.add(a.name);this.selectedFileNames.add(e.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(e.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(e.name));this.selectedFileNames.has(e.name)&&(this.lastSelected=e)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}runFileAction(t,e){this.onAction.emit({file:t,action:e})}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){let t=this.currentPrefix$.value;if(t){let e=t.slice(0,-1),n=e.lastIndexOf("/"),a=n!=-1?e.substring(0,n+1):void 0;this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(a)}}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}writeValue(t){this.path=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(F(Ne))}}static{this.\u0275cmp=O({type:i,selectors:[["app-remote-file-selector"]],inputs:{isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection",fileListExtraColumns:"fileListExtraColumns",fileActions:"fileActions"},outputs:{prefixChange:"prefixChange",onAction:"onAction"},features:[ke([{provide:Be,useExisting:Ee(()=>i),multi:!0}]),Oe],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource","no-select"],["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource"],["cdkColumnDef","actions"],["mat-header-cell","","class","status","width","1",4,"cdkHeaderCellDef"],["mat-cell","","class","status",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["cdkColumnDef","progress"],["mat-footer-cell","",4,"cdkFooterCellDef"],[3,"cdkColumnDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-footer-row","","class","progress-row",3,"hide",4,"cdkFooterRowDef"],["mat-header-cell","","width","1",1,"status"],["mat-cell","",1,"status"],[3,"padding"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click","disabled"],[3,"visibility"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-footer-cell",""],[2,"vertical-align","middle"],["mat-header-cell","","width","1",4,"cdkHeaderCellDef"],["mat-header-cell","","width","1"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"],["mat-footer-row","",1,"progress-row"]],template:function(e,n){e&1&&d(0,bn,26,15,"table",0),e&2&&f(n.dataSource?0:-1)},dependencies:[P,se,J,Ce,_e,Ye,zt,he,He,Yt,z,ue,Y,ee,H,Ht,te,G,Gt,ti,ai,W,et,ne],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}td.status[_ngcontent-%COMP%]{padding:0;padding-left:0!important;padding-right:0!important}.ya-data-table[_ngcontent-%COMP%]   td.status[_ngcontent-%COMP%] + td[_ngcontent-%COMP%], .ya-data-table[_ngcontent-%COMP%]   th.status[_ngcontent-%COMP%] + th[_ngcontent-%COMP%]{padding-left:2px!important}"],changeDetection:0})}};var Dn=["objectSelector"],En=["remoteSelector"],vi=()=>({visibility:"hidden"}),Si=i=>({"no-filelist":i}),On=i=>({selected:i}),gi=()=>[];function Mn(i,t){if(i&1&&(r(0,"span"),s(1),u(2,"formatBytes"),u(3,"formatBytes"),o()),i&2){let e=c().$implicit;l(),Pe("",_(2,2,e.size),"/",_(3,4,e.maxSize),"")}}function Pn(i,t){if(i&1&&T(0,"ya-progress",33),i&2){let e=c().$implicit;m("value",e.size)("total",e.maxSize)}}function kn(i,t){if(i&1&&(r(0,"td",31),u(1,"formatBytes"),r(2,"span")(3,"mat-icon",32),s(4,"shopping_basket"),o(),s(5),o(),d(6,Mn,4,6,"span")(7,Pn,1,2,"ya-progress",33),o()),i&2){let e=t.$implicit,n=c();m("title",_(1,4,e.maxSize-e.size)+" available"),l(5),h(" \xA0 ",e.name," "),l(),f(n.showBucketSize$.value?6:-1),l(),f(n.showBucketSize$.value?7:-1)}}function In(i,t){if(i&1){let e=b();r(0,"tr",34),u(1,"async"),g("click",function(){let a=v(e).$implicit,p=c();return S(p.selectBucket(a))}),o()}if(i&2){let e=t.$implicit,n=c();m("ngClass",Ie(3,On,e===_(1,1,n.selectedBucket$)))}}function Nn(i,t){if(i&1&&(r(0,"option",17),s(1),o()),i&2){let e=t.$implicit;m("value",e.name),l(),Pe("",e.name," [id=",e.id,"]")}}function Ln(i,t){if(i&1){let e=b();r(0,"ya-breadcrumb",37),g("click",function(){let a=v(e).$implicit,p=c(2);return S(p.changeLocalPrefix(a.prefix))}),o()}if(i&2){let e=t.$implicit;m("label",e.name)("action",!0)}}function Rn(i,t){if(i&1){let e=b();r(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",35),g("click",function(){v(e);let a=c();return S(a.changeLocalPrefix(""))}),o(),N(2,Ln,1,2,"ya-breadcrumb",36,I),o()}i&2&&(m("showMargin",!1),l(),m("action",!0),l(),L(t))}function $n(i,t){if(i&1){let e=b();r(0,"app-object-selector",38,0),g("prefixChange",function(a){v(e);let p=c();return S(p.updateLocalBreadcrumb(a))}),o()}i&2&&m("bucket",t)("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("noFrame",!0)("allowFolderSelection",!0)}function An(i,t){if(i&1){let e=b();r(0,"ya-button",39),g("click",function(){v(e);let a=c();return S(a.startUpload())}),s(1," UPLOAD "),o()}if(i&2){let e=c();m("disabled",!e.isUploadEnabled)}}function Bn(i,t){if(i&1&&(r(0,"option",17),s(1),o()),i&2){let e=t.$implicit;m("value",e.name),l(),Pe("",e.name," [id=",e.id,"]")}}function Vn(i,t){if(i&1){let e=b();r(0,"ya-breadcrumb",37),g("click",function(){let a=v(e).$implicit,p=c(3);return S(p.changeRemotePrefix(a.prefix))}),o()}if(i&2){let e=t.$implicit;m("label",e.name)("action",!0)}}function jn(i,t){if(i&1){let e=b();r(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",35),g("click",function(){v(e);let a=c(2);return S(a.changeRemotePrefix(""))}),o(),N(2,Vn,1,2,"ya-breadcrumb",36,I),o()}i&2&&(m("showMargin",!1),l(),m("action",!0),l(),L(t))}function Un(i,t){i&1&&s(0),i&2&&h(" (",t,") ")}function zn(i,t){if(i&1){let e=b();r(0,"a",41),s(1),u(2,"async"),u(3,"datetime"),d(4,Un,1,1),u(5,"async"),s(6," \u25BE "),o(),r(7,"mat-menu",42,1)(9,"button",43),g("click",function(){v(e);let a=c(2);return S(a.requestFileList())}),s(10,"Refresh file list"),o()()}if(i&2){let e,n=K(8),a=c(2);m("matMenuTriggerFor",n),l(),h(" ",_(3,5,_(2,3,a.lastFileListTime$))||"No file list received"," "),l(3),f((e=_(5,7,a.lastFileListState$))?4:-1,e)}}function Yn(i,t){if(i&1&&(r(0,"div",24)(1,"label",8),s(2),r(3,"select",40),N(4,Bn,2,3,"option",17,I),o()(),d(6,jn,4,2,"ya-breadcrumb-trail",18),u(7,"async"),d(8,zn,11,9),o()),i&2){let e,n=c();m("ngClass",Ie(7,Si,!n.service.capabilities.fileList)),l(2),h(" Remote ",n.service.remoteEntities&&n.service.remoteEntities.length?"Entity":""," "),l(),m("ngStyle",!(n.service.remoteEntities&&n.service.remoteEntities.length)&&M(9,vi)),l(),L(n.service.remoteEntities),l(2),f((e=_(7,5,n.remoteBreadcrumb$))?6:-1,e),l(2),f(n.service.capabilities.fileList?8:-1)}}function Hn(i,t){if(i&1){let e=b();r(0,"div",44),g("click",function(a){v(e);let p=K(2),w=c();return S(w.clearSelection(a,p))}),r(1,"app-remote-file-selector",45,2),g("prefixChange",function(a){v(e);let p=c();return S(p.updateRemoteBreadcrumb(a))})("onAction",function(a){v(e);let p=c();return S(p.onActionRequest(a))}),o()()}if(i&2){let e=c();l(),m("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("allowFolderSelection",!0)("fileListExtraColumns",e.service.capabilities.fileListExtraColumns||M(6,gi))("fileActions",e.service.capabilities.fileActions||M(7,gi))}}function Gn(i,t){if(i&1){let e=b();r(0,"ya-button",46),g("click",function(){v(e);let a=c();return S(a.startDownload())}),s(1," DOWNLOAD "),o()}if(i&2){let e=c();m("disabled",!e.isDownloadEnabled)}}function Wn(i,t){if(i&1&&T(0,"input",28),i&2){let e,n=c();m("value",(e=n.form.get("remoteFilenames"))==null?null:e.value)}}function qn(i,t){if(i&1&&(r(0,"label",47),T(1,"input",51),s(2),o()),i&2){let e=c(),n=e.$implicit,a=e.$index,p=c();l(),m("formControlName",p.getControlName(n,a)),l(),h(" ",n.associatedText," ")}}function Xn(i,t){if(i&1&&(r(0,"option",17),s(1,"Custom"),o()),i&2){let e=c(3);m("value",e.CUSTOM_OPTION_VALUE)}}function Kn(i,t){if(i&1&&(r(0,"option",17),s(1),o()),i&2){let e=t.$implicit;m("value",e.value),l(),h(" ",e.verboseName!=null?e.verboseName:e.value," ")}}function Qn(i,t){if(i&1&&(r(0,"select",49),d(1,Xn,2,1,"option",17),N(2,Kn,2,2,"option",17,I),o()),i&2){let e=c(),n=e.$implicit,a=e.$index,p=c();m("formControlName",p.getControlName(n,a)+p.DROPDOWN_SUFFIX),l(),f(n.allowCustomOption?1:-1),l(),L(n.values)}}function Jn(i,t){if(i&1&&T(0,"input",50),i&2){let e=c(),n=e.$implicit,a=e.$index,p=c();m("formControlName",p.getControlName(n,a))("type",n.type==="DOUBLE"?"number":"text")("placeholder",n.associatedText||"")}}function Zn(i,t){if(i&1&&(r(0,"div",30)(1,"label"),s(2),o(),d(3,qn,3,2,"label",47),r(4,"div",48),d(5,Qn,4,2,"select",49)(6,Jn,1,3,"input",50),o()()),i&2){let e,n=t.$implicit,a=t.$index,p=c();m("title",n.description||""),l(2),R(n.title||n.name),l(),f(n.type==="BOOLEAN"?3:-1),l(2),f((n.type==="DOUBLE"||n.type==="STRING")&&n.values?5:-1),l(),f((n.type==="DOUBLE"||n.type==="STRING")&&(n.allowCustomOption&&((e=p.form.get(p.getControlName(n,a)+p.DROPDOWN_SUFFIX))==null?null:e.value)===p.CUSTOM_OPTION_VALUE||!n.values)?6:-1)}}var st=class i{constructor(t,e,n,a,p,w,A){this.dialogRef=t;this.yamcs=e;this.messageService=a;this.preferenceStore=p;this.snackBar=w;this.data=A;this.isDownloadEnabled=!1;this.isUploadEnabled=!1;this.dataSource=new ie;this.displayedColumns=["name"];this.prefPrefix="filetransfer.";this.selectedBucket$=new D(null);this.breadcrumb$=new D([]);this.remoteBreadcrumb$=new D([]);this.lastFileListTime$=new D("");this.lastFileListState$=new D(void 0);this.optionsMapping=new Map;this.DROPDOWN_SUFFIX="_Dropdown";this.CUSTOM_OPTION_VALUE="_CUSTOM_OPTION_";this.service=A.service,this.prefPrefix+=this.service.name+".",this.showBucketSize$=this.addPreference$("showBucketSize",!1),this.localDirectory$=this.addPreference$("localDirectory","");let B=this.service.localEntities&&this.service.localEntities.length?this.service.localEntities[0].name:"",oe=this.service.remoteEntities&&this.service.remoteEntities.length?this.service.remoteEntities[0].name:"",Te=this.addPreference$("localEntity",B),re=this.addPreference$("remoteEntity",oe);this.storageClient=e.createStorageClient(),this.storageClient.getBuckets().then(C=>{if(this.dataSource.data=C||[],C){let X=this.addPreference$("selectedBucket",C[0].name),U=C.find(V=>V.name===X.value);this.selectBucket(U||C[0])}}),this.fileListSubscription=this.yamcs.yamcsClient.createRemoteFileListSubscription({instance:this.yamcs.instance,serviceName:this.service.name},C=>{if(C.destination==this.form.get("remoteEntity").value){let X=this.remoteSelector.currentPrefix$.value||"";C.remotePath==X&&(this.remoteSelector.setFolderContent(X,C),this.lastFileListTime$.next(C.listTime),this.lastFileListState$.next(C.state))}});let Q={};this.service.transferOptions?.forEach((C,X)=>{let U=this.getControlName(C,X);if(this.optionsMapping.set(C,U),C.type==="BOOLEAN"){let V=this.addPreference$("options."+C.name,C.default?.toLowerCase()==="true");Q[U]=[V.value,[]]}else{let V=this.addPreference$("options."+C.name,C.default||""),le=C.values&&C.values.find(Ti=>Ti.value===V.value);Q[U]=[le==null?V.value:"",[]],Q[U+this.DROPDOWN_SUFFIX]=[le!=null?V.value:this.CUSTOM_OPTION_VALUE,[]]}}),this.form=n.group(be({localFilenames:["",[]],remoteFilenames:["",[]],localEntity:[Te.value,this.service.localEntities&&this.service.localEntities.length&&vt.required],remoteEntity:[re.value,this.service.remoteEntities&&this.service.remoteEntities.length&&vt.required]},Q)),this.form.get("localFilenames")?.valueChanges.subscribe(C=>{this.updateButtonStates(C,this.form.get("remoteFilenames")?.value,this.form.get("remoteFilenames")?.value)}),this.form.get("remoteFilenames")?.valueChanges.subscribe(C=>{this.updateButtonStates(this.form.get("localFilenames")?.value,C,this.form.get("remoteFilenames")?.value)}),this.form.get("localEntity")?.valueChanges.subscribe(C=>{this.setPreferenceValue("localEntity",C)}),this.form.get("remoteEntity")?.valueChanges.subscribe(C=>{this.setPreferenceValue("remoteEntity",C),this.getFileList(C,"")}),this.form.valueChanges.subscribe(async C=>{this.optionsMapping.forEach((X,U)=>{let V=this.form.get(X+this.DROPDOWN_SUFFIX)?.value,le=V==null||V===this.CUSTOM_OPTION_VALUE?this.form.get(X)?.value:V;switch(U.type){case"BOOLEAN":this.setPreferenceValue("options."+U.name,String(le)==="true");break;case"DOUBLE":case"STRING":this.setPreferenceValue("options."+U.name,le??"")}})});let q=this.addPreference$("remoteDirectory","");this.getFileList(re.value,q.value||"")}set content(t){if(!this.objectSelector){if(!t)return;this.objectSelector=t}this.changeLocalPrefix(this.localDirectory$.value)}getControlName(t,e){return"option"+e+t.name.replace(/\s/g,"")}selectBucket(t){this.selectedBucket$.next(t),this.setPreferenceValue("selectedBucket",t.name)}updateButtonStates(t,e,n){this.isDownloadEnabled=this.service.capabilities.download&&this.selectedBucket$.value&&e!=""&&this.form.valid,this.isUploadEnabled=this.service.capabilities.upload&&t!=""&&this.form.valid}getSelectedRemoteFolderPath(){let t=this.remoteBreadcrumb$.value;return t.length!=0?t[t.length-1].prefix+"/":""}getSelectedLocalFolderPath(){let t=this.breadcrumb$.value;return t.length!=0?t[t.length-1].prefix+"/":""}async startDownload(){return this.startTransfer(this.form.get("remoteEntity")?.value,this.form.get("localEntity")?.value,this.form.get("remoteFilenames")?.value,this.form.get("localFilenames")?.value,this.getSelectedRemoteFolderPath(),this.getSelectedLocalFolderPath(),"DOWNLOAD")}async startUpload(){return this.startTransfer(this.form.get("localEntity")?.value,this.form.get("remoteEntity")?.value,this.form.get("localFilenames")?.value,this.form.get("remoteFilenames")?.value,this.getSelectedLocalFolderPath(),this.getSelectedRemoteFolderPath(),"UPLOAD")}async startTransfer(t,e,n,a,p,w,A){let B=n.trim().split("|");if(!B[0])return;let oe=B.map(Q=>{let q;try{q=this.getTransferPaths(Q,a,p,w,A)}catch(C){throw this.messageService.showError(C),C}return A=="DOWNLOAD"&&(q=q.reverse()),this.yamcs.yamcsClient.createFileTransfer(this.yamcs.instance,this.service.name,{direction:A,bucket:this.selectedBucket$.value.name,objectName:q[0],remotePath:q[1],source:t,destination:e,options:this.getTransferOptions()})}),Te,re=0;for(let Q of oe)try{await Q}catch(q){Te=q,re++}Te&&(re===1?this.messageService.showError(Te):re===oe.length?this.messageService.showError("Failed to start any of the selected transfers. See server log."):this.messageService.showError("Some of the transfers failed to start. See server log.")),this.dialogRef.close()}getTransferPaths(t,e,n,a,p){t=t.trim(),t=t.startsWith(n)?t.replace(n,""):t;let w=n+t,A=t;if(p==="UPLOAD"&&this.service.capabilities.remotePath||p==="DOWNLOAD"){if(e=e.trim(),e.includes("|"))throw console.error(`Cannot ${p.toLowerCase()} file "${w}" to multiple destination filenames: ${e}`),new Error(`Cannot ${p.toLowerCase()} file "${w}" to multiple destination filenames: ${e}`);let B=e.startsWith(a)?e.replace(a,""):e;A=a+(B||t)}return[w,A]}requestFileList(){let t=this.remoteSelector.currentPrefix$.value||"";this.yamcs.yamcsClient.requestFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:this.form.value.remoteEntity,remotePath:t,options:this.getTransferOptions()})}getFileList(t,e){this.service.capabilities.fileList&&this.yamcs.yamcsClient.getFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:t,remotePath:e,options:this.getTransferOptions()}).then(n=>{this.remoteSelector.setFolderContent(e,n),this.setPreferenceValue("remoteDirectory",e),this.lastFileListTime$.next(n.listTime),this.lastFileListState$.next(n.state)})}getTransferOptions(){return this.service.transferOptions?.reduce((t,e)=>{let n=this.optionsMapping.get(e);if(!n)return t;let a=this.form.get(n+this.DROPDOWN_SUFFIX)?.value,p=a==null||a===this.CUSTOM_OPTION_VALUE?this.form.get(n)?.value:a;return e.type==="BOOLEAN"&&typeof p!="boolean"?p=String(p).toLowerCase()==="true":e.type==="DOUBLE"&&typeof p!="number"?p=Number(p):e.type==="STRING"&&typeof p!="string"&&(p=String(p)),De(be({},t),{[e.name]:p})},{})}updateLocalBreadcrumb(t){if(!t){this.breadcrumb$.next([]),this.setPreferenceValue("localDirectory","");return}t.endsWith("/")&&(t=t.substring(0,t.length-1));let e=[],n=t.split("/");for(let a=0;a<n.length;a++)e.push({name:n[a],prefix:n.slice(0,a+1).join("/")});this.breadcrumb$.next(e),this.setPreferenceValue("localDirectory",t)}changeLocalPrefix(t){t&&(t=t+"/"),this.objectSelector.changePrefix(t)}updateRemoteBreadcrumb(t){if(!t){this.remoteBreadcrumb$.next([]),this.getFileList(this.form.value.remoteEntity,"");return}let e=t.endsWith("/")?t.slice(0,-1):t,n=[],a=e.split("/");for(let p=0;p<a.length;p++)n.push({name:a[p],prefix:a.slice(0,p+1).join("/")});this.remoteBreadcrumb$.next(n),this.getFileList(this.form.value.remoteEntity,t)}changeRemotePrefix(t){t&&(t=t+"/"),this.remoteSelector.changePrefix(t)}clearSelection(t,e){t.currentTarget===t.target&&e.clearSelection()}onActionRequest(t){this.snackBar.open(`Running '${t.action.label}' ...`,void 0,{horizontalPosition:"end"});let e=this.form.value.remoteEntity;this.yamcs.yamcsClient.runFileAction(this.yamcs.instance,this.service.name,{remoteEntity:e,file:t.file,action:t.action.id}).then(()=>{this.snackBar.open(`'${t.action.label}' successful`,void 0,{duration:3e3,horizontalPosition:"end"})}).catch(n=>{this.messageService.showError(n),this.snackBar.open(`'${t.action.label}' failed`,void 0,{duration:3e3,horizontalPosition:"end"})})}toggleBucketSize(){this.setPreferenceValue("showBucketSize",!this.showBucketSize$.value)}addPreference$(t,e){return this.preferenceStore.addPreference$(this.prefPrefix+t,e)}setPreferenceValue(t,e){this.preferenceStore.setValue(this.prefPrefix+t,e)}ngOnDestroy(){this.fileListSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||i)(F(Bt),F($),F(At),F(ge),F(ei),F(Mt),F(Vt))}}static{this.\u0275cmp=O({type:i,selectors:[["app-transfer-file-dialog"]],viewQuery:function(e,n){if(e&1&&(ut(Dn,5),ut(En,5)),e&2){let a;_t(a=ht())&&(n.content=a.first),_t(a=ht())&&(n.remoteSelector=a.first)}},decls:40,vars:23,consts:[["objectSelector",""],["remoteMenu","matMenu"],["remoteSelector",""],[1,"transfer-files"],[1,"ya-form",3,"formGroup"],["mat-icon-button","","mat-dialog-close","",1,"close-button"],[1,"grid-container"],[1,"buckets-column","header"],[1,"table-caption"],[1,"column-action",3,"click"],[1,"buckets-column","table-wrapper"],["mat-table","",1,"ya-data-table","no-frame",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",3,"title",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"local-column","header"],["formControlName","localEntity",3,"ngStyle"],[3,"value"],[3,"showMargin"],[1,"local-column","table-wrapper",3,"click","ngClass"],["formControlName","localFilenames",3,"bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],[1,"local-column","footer"],["type","text","formControlName","localFilenames","placeholder","Local filename",3,"value"],["appearance","primary","icon","chevron_right",3,"disabled"],[1,"remote-column","header",3,"ngClass"],[1,"remote-column","table-wrapper"],[1,"remote-column","footer"],["appearance","primary","icon","chevron_left",3,"disabled"],["type","text","formControlName","remoteFilenames","placeholder","Remote filename",3,"value"],[1,"options-footer"],[3,"title"],["mat-cell","",3,"title"],[2,"vertical-align","middle"],[3,"value","total"],["mat-row","",3,"click","ngClass"],["icon","account_tree",3,"click","action"],[3,"label","action"],[3,"click","label","action"],["formControlName","localFilenames",3,"prefixChange","bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],["appearance","primary","icon","chevron_right",3,"click","disabled"],["formControlName","remoteEntity",3,"ngStyle"],["matTooltip","Last refresh. Click for actions",1,"lastFileListTime","column-action",3,"matMenuTriggerFor"],["overlapTrigger","false","xPosition","before","yPosition","below",1,"ya-menu"],["mat-menu-item","",3,"click"],[1,"remote-column","table-wrapper",3,"click"],["formControlName","remoteFilenames",3,"prefixChange","onAction","isMultiSelect","foldersOnly","noSelect","allowFolderSelection","fileListExtraColumns","fileActions"],["appearance","primary","icon","chevron_left",3,"click","disabled"],[1,"checkbox-label"],[2,"display","flex","column-gap","8px","flex-wrap","wrap"],[3,"formControlName"],[2,"width","120px",3,"formControlName","type","placeholder"],["type","checkbox",3,"formControlName"]],template:function(e,n){if(e&1&&(r(0,"div",3)(1,"form",4)(2,"h2")(3,"button",5)(4,"mat-icon"),s(5,"close"),o()(),s(6),o(),r(7,"div",6)(8,"div",7)(9,"label",8),s(10," Buckets "),r(11,"a",9),g("click",function(){return n.toggleBucketSize()}),s(12),o()()(),r(13,"div",10)(14,"table",11),x(15,12),d(16,kn,8,6,"td",13),y(),d(17,In,2,5,"tr",14),o()(),r(18,"div",15)(19,"label",8),s(20),r(21,"select",16),N(22,Nn,2,3,"option",17,I),o()(),d(24,Rn,4,2,"ya-breadcrumb-trail",18),u(25,"async"),o(),r(26,"div",19),g("click",function(p){return n.clearSelection(p,n.objectSelector)}),d(27,$n,2,6,"app-object-selector",20),u(28,"async"),o(),r(29,"div",21),T(30,"input",22),d(31,An,2,1,"ya-button",23),o(),d(32,Yn,9,10,"div",24)(33,Hn,3,8,"div",25),r(34,"div",26),d(35,Gn,2,1,"ya-button",27)(36,Wn,1,1,"input",28),o(),r(37,"div",29),N(38,Zn,7,5,"div",30,I),o()()()()),e&2){let a,p,w;l(),m("formGroup",n.form),l(5),h(" New ",n.service.capabilities.download&&n.service.capabilities.upload?"Transfer":n.service.capabilities.upload?"Upload":"Download"," "),l(6),h(" ",n.showBucketSize$.value?"hide":"show"," size "),l(2),m("dataSource",n.dataSource),l(3),m("cdkRowDefColumns",n.displayedColumns),l(3),h(" Local ",n.service.localEntities&&n.service.localEntities.length?"Entity":""," "),l(),m("ngStyle",!(n.service.localEntities&&n.service.localEntities.length)&&M(20,vi)),l(),L(n.service.localEntities),l(2),f((a=_(25,16,n.breadcrumb$))?24:-1,a),l(2),m("ngClass",Ie(21,Si,!n.service.capabilities.fileList)),l(),f((p=_(28,18,n.selectedBucket$))?27:-1,p),l(3),m("value",(w=n.form.get("localFilenames"))==null?null:w.value),l(),f(n.service.capabilities.upload?31:-1),l(),f(n.service.remoteEntities&&n.service.remoteEntities.length||n.service.capabilities.fileList?32:-1),l(),f(n.service.capabilities.fileList?33:-1),l(2),f(n.service.capabilities.download?35:-1),l(),f(n.service.capabilities.download||n.service.capabilities.remotePath?36:-1),l(2),L(n.service.transferOptions)}},dependencies:[ot,P,se,bt,J,pe,Rt,$t,kt,Pt,Lt,ce,me,de,fe,Ce,_e,he,Et,Ut,z,Ue,ue,ze,Y,H,G,je,Zt,Jt,ve,Ze,W,ne,lt],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.transfer-files[_ngcontent-%COMP%]{height:100%}.close-button[_ngcontent-%COMP%]{float:right}.ya-form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.grid-container[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-template-rows:[header] min-content [tables] auto [footer] min-content [options-footer] min-content;grid-template-columns:[buckets] 140px [local] auto [remote] auto;column-gap:8px;flex:1;min-height:0}.header[_ngcontent-%COMP%]{grid-row:header;position:relative;overflow:hidden;font-family:Roboto,sans-serif}.table-wrapper[_ngcontent-%COMP%]{grid-row:tables;overflow:auto;border:1px solid #d3d3d3}.footer[_ngcontent-%COMP%]{grid-row:footer;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content;font-family:Roboto,sans-serif}.options-footer[_ngcontent-%COMP%]{grid-row:options-footer;grid-column:local / span 2;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content;font-family:Roboto,sans-serif}.buckets-column[_ngcontent-%COMP%]{grid-column:buckets}.local-column[_ngcontent-%COMP%]{grid-column:local}.remote-column[_ngcontent-%COMP%]{grid-column:remote}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{position:absolute;bottom:0;line-height:24px}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{float:right}.buckets-column[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;column-gap:10px;flex-wrap:wrap;justify-content:space-between}a.column-action[_ngcontent-%COMP%]{font-weight:400;font-size:11px;color:#707070;-webkit-user-select:none;user-select:none;cursor:pointer}a.column-action[_ngcontent-%COMP%]:hover{text-decoration:underline}.local-column.table-wrapper.no-filelist[_ngcontent-%COMP%]{grid-column:local / span 2}.local-column.footer[_ngcontent-%COMP%]{flex-wrap:wrap-reverse;align-items:flex-end}.remote-column.header.no-filelist[_ngcontent-%COMP%] > ya-breadcrumb-trail[_ngcontent-%COMP%]{visibility:hidden}label.table-caption[_ngcontent-%COMP%]{margin:0;bottom:0}label.table-caption[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;width:auto;margin:0 4px}ya-breadcrumb-trail[_ngcontent-%COMP%]{display:inline-block}.lastFileListTime[_ngcontent-%COMP%]{min-width:0;line-height:24px;float:right}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-shrink:1}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{flex-grow:1}.footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-grow:5}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.checkbox-label[_ngcontent-%COMP%]{font-weight:unset;font-size:unset;letter-spacing:unset;line-height:unset;color:unset;text-transform:unset;cursor:unset;position:unset;display:inline-block;margin:3px 0 0;-webkit-user-select:none;user-select:none}.checkbox-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 3px 0 4px}"]})}};function ea(i,t){if(i&1&&(r(0,"mat-icon",0),s(1,"check_circle"),o()),i&2){let e=c();m("matTooltip",e.state)}}function ta(i,t){if(i&1&&(r(0,"mat-icon",1),s(1,"cached"),o()),i&2){let e=c();m("matTooltip",e.state)}}function ia(i,t){if(i&1&&(r(0,"mat-icon",2),s(1,"highlight_off"),o()),i&2){let e=c();m("matTooltip",e.state)}}function na(i,t){if(i&1&&(r(0,"mat-icon",3),s(1,"cached"),o()),i&2){let e=c();m("matTooltip",e.state)}}function aa(i,t){if(i&1&&(r(0,"mat-icon",4),s(1,"pause_circle"),o()),i&2){let e=c();m("matTooltip",e.state)}}function oa(i,t){if(i&1&&(r(0,"mat-icon",5),s(1,"pending"),o()),i&2){let e=c();m("matTooltip",e.state)}}function ra(i,t){if(i&1&&d(0,ea,2,1,"mat-icon",0)(1,ta,2,1,"mat-icon",1)(2,ia,2,1,"mat-icon",2)(3,na,2,1,"mat-icon",3)(4,aa,2,1,"mat-icon",4)(5,oa,2,1,"mat-icon",5),i&2){let e=t;f(e.state==="COMPLETED"?0:e.state==="RUNNING"?1:e.state==="FAILED"?2:e.state==="CANCELLING"?3:e.state==="PAUSED"?4:e.state==="QUEUED"?5:-1)}}var ct=class i{constructor(){this.transfer=j.required()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-icon"]],inputs:{transfer:[1,"transfer"]},decls:1,vars:1,consts:[[1,"completed",3,"matTooltip"],[1,"running",3,"matTooltip"],[1,"failed",3,"matTooltip"],[1,"cancelling",3,"matTooltip"],[1,"paused",3,"matTooltip"],[3,"matTooltip"]],template:function(e,n){if(e&1&&d(0,ra,6,1),e&2){let a;f((a=n.transfer())?0:-1,a)}},dependencies:[P,z,je],styles:[".completed[_ngcontent-%COMP%]{color:#00c752}.running[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yspin 2s infinite linear}.cancelling[_ngcontent-%COMP%]{color:var(--y-warning-color);animation:_ngcontent-%COMP%_yspin 2s infinite linear}.failed[_ngcontent-%COMP%]{color:var(--y-error-color)}.paused[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_yblink 1s linear infinite}@keyframes _ngcontent-%COMP%_yblink{50%{opacity:0}}@keyframes _ngcontent-%COMP%_yspin{0%{-webkit-transform:rotate(0deg) scaleX(-1);transform:rotate(0) scaleX(-1)}to{-webkit-transform:rotate(359deg) scaleX(-1);transform:rotate(359deg) scaleX(-1)}}"],changeDetection:0})}};var mt=class{constructor(t){this.watermarkObserver=t;this.dirty=!1;this.archiveTransfers=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(t){this.archiveTransfers=this.archiveTransfers.concat(t),this.dirty=!0}addRealtimeTransfer(t){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveTransfers=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let t=[...this.archiveTransfers];return this.realtimeBuffer.map(e=>{if(!e)return;let n=t.findIndex(a=>a.id===e.id);n===-1?t.push(e):t[n]=e}),t.sort((e,n)=>{let a=e.creationTime||e.startTime||"";return(n.creationTime||n.startTime||"").localeCompare(a)}),t}compact(t){let e=this.snapshot();e.length=Math.min(t,e.length),this.reset(),this.archiveTransfers=e,this.dirty=!0}};var pt=class{constructor(t,e){this.transfer=t;this.objectUrl=e}get id(){return this.transfer.id}get creationTime(){return this.transfer.creationTime}get startTime(){return this.transfer.startTime}get direction(){return this.transfer.direction}get localEntity(){return this.transfer.localEntity}get remoteEntity(){return this.transfer.remoteEntity}get state(){return this.transfer.state}get bucket(){return this.transfer.bucket}get objectName(){return this.transfer.objectName}get remotePath(){return this.transfer.remotePath}get totalSize(){return this.transfer.totalSize}get sizeTransferred(){return this.transfer.sizeTransferred}get failureReason(){return this.transfer.failureReason}get transferType(){return this.transfer.transferType}};var dt=class extends Ot{constructor(e,n,a){super();this.yamcs=e;this.storageClient=a;this.pageSize=100;this.transfers$=new D([]);this.loading$=new D(!1);this.streaming$=new D(!1);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitTransfers(),this.buffer.dirty=!1)}),this.buffer=new mt(()=>{this.buffer.compact(500)})}connect(e){return this.transfers$}emitTransfers(){let e=this.buffer.snapshot();this.transfers$.next(e)}loadTransfers(e,n){return this.loading$.next(!0),Promise.all([this.loadPage(e,De(be({},n),{limit:this.pageSize}))]).then(a=>{let p=a[0].map(w=>this.toItem(w));return this.loading$.next(!1),this.buffer.reset(),this.buffer.addArchiveData(p),this.emitTransfers(),p})}loadPage(e,n){return this.options=n,this.yamcs.yamcsClient.getFileTransfers(this.yamcs.instance,e.name,n).then(a=>a.transfers||[])}startStreaming(e){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e.name,ongoingOnly:!0},n=>{!this.loading$.getValue()&&this.matchesFilter(n)&&this.buffer.addRealtimeTransfer(this.toItem(n))})}toItem(e){let n=e.objectName?this.storageClient.getObjectURL(e.bucket,e.objectName):"";return new pt(e,n)}matchesFilter(e){return!(this.options&&(this.options.direction&&e.direction!==this.options.direction||this.options.localEntityId&&e.localEntity.id!==this.options.localEntityId||this.options.remoteEntityId&&e.remoteEntity.id!==this.options.remoteEntityId||this.options.state?.length&&this.options.state.indexOf(e.state)===-1))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(e){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.transfers$.complete(),this.loading$.complete(),this.streaming$.complete()}};var la=()=>["detail"];function sa(i,t){if(i&1){let e=b();r(0,"button",38),g("click",function(){let a=v(e).$implicit,p=c(2);return S(p.switchService(a))}),s(1),o()}if(i&2){let e=t.$implicit;l(),h(" ",e.name," ")}}function ca(i,t){if(i&1&&(r(0,"ya-page-button",35),s(1),o(),r(2,"mat-menu",36,0),N(4,sa,2,1,"button",37,I),o()),i&2){let e,n=K(3),a=c();m("matMenuTriggerFor",n),l(),h(" ",((e=a.service())==null?null:e.name)||"select service"," "),l(3),L(a.services())}}function ma(i,t){if(i&1){let e=b();r(0,"ya-page-button",40),g("clicked",function(){v(e);let a=c(),p=c();return S(p.showCreateTransferDialog(a))}),s(1),o()}if(i&2){let e=c();m("icon",e.capabilities.download&&e.capabilities.upload?"cloud":e.capabilities.upload?"cloud_upload":"cloud_download"),l(),h(" New ",e.capabilities.download&&e.capabilities.upload?"transfer":e.capabilities.upload?"upload":"download"," ")}}function pa(i,t){if(i&1&&d(0,ma,2,2,"ya-page-button",39),i&2){let e=t,n=c();f(n.mayControlFileTransfers()&&(e.capabilities.download||e.capabilities.upload)?0:-1)}}function da(i,t){if(i&1){let e=b();T(0,"ya-date-time-input",41)(1,"ya-date-time-input",42),r(2,"ya-button",43),g("click",function(){v(e);let a=c();return S(a.applyCustomDates())}),s(3," Apply "),o()}if(i&2){let e=c();l(2),m("disabled",e.filterForm.invalid)}}function fa(i,t){if(i&1){let e=b();r(0,"ya-button",44),g("click",function(){v(e);let a=c();return S(a.jumpToNow())}),s(1,"Jump to now"),o()}}function ua(i,t){i&1&&(r(0,"th",45),s(1,"Started"),o())}function _a(i,t){if(i&1&&(r(0,"td",46),s(1),u(2,"datetime"),o()),i&2){let e=t.$implicit;l(),h(" ",_(2,1,e.startTime)," ")}}function ha(i,t){i&1&&(r(0,"th",45),s(1,"Local entity"),o())}function Ca(i,t){if(i&1&&(r(0,"td",47),s(1),o()),i&2){let e,n=t.$implicit;l(),h(" ",(e=(e=n.localEntity==null?null:n.localEntity.name)!==null&&e!==void 0?e:n.localEntity==null?null:n.localEntity.id)!==null&&e!==void 0?e:"-"," ")}}function ga(i,t){i&1&&(r(0,"th",45),s(1,"Local file"),o())}function va(i,t){if(i&1&&(r(0,"span"),s(1),u(2,"storageUrl"),o()),i&2){let e=c().$implicit;l(),h(" ",gt(2,1,e.objectName,e.bucket)||"-"," ")}}function Sa(i,t){if(i&1&&(r(0,"a",49),s(1),u(2,"storageUrl"),o()),i&2){let e=c().$implicit;m("href",e.objectUrl,yt),l(),h(" ",gt(2,2,e.objectName,e.bucket)||"-"," ")}}function xa(i,t){if(i&1&&(r(0,"td",48),d(1,va,3,4,"span")(2,Sa,3,5,"a",49),o()),i&2){let e=t.$implicit;l(),f(e.direction==="DOWNLOAD"&&e.state!=="COMPLETED"||!e.objectUrl?1:2)}}function ya(i,t){i&1&&(r(0,"th",45),s(1,"Direction"),o())}function Ta(i,t){i&1&&(r(0,"mat-icon"),s(1,"west"),o())}function ba(i,t){i&1&&(r(0,"mat-icon",51),s(1,"east"),o())}function Fa(i,t){if(i&1&&(r(0,"td",50),d(1,Ta,2,0,"mat-icon")(2,ba,2,0,"mat-icon",51),o()),i&2){let e=t.$implicit;l(),f(e.direction==="DOWNLOAD"?1:-1),l(),f(e.direction==="UPLOAD"?2:-1)}}function wa(i,t){i&1&&(r(0,"th",45),s(1,"Remote entity"),o())}function Da(i,t){if(i&1&&(r(0,"td",47),s(1),o()),i&2){let e,n=t.$implicit;l(),h(" ",(e=(e=n.remoteEntity==null?null:n.remoteEntity.name)!==null&&e!==void 0?e:n.remoteEntity==null?null:n.remoteEntity.id)!==null&&e!==void 0?e:"-"," ")}}function Ea(i,t){i&1&&(r(0,"th",45),s(1,"Remote file"),o())}function Oa(i,t){if(i&1&&(r(0,"td",48),s(1),o()),i&2){let e=t.$implicit;l(),h(" ",e.remotePath||"-"," ")}}function Ma(i,t){i&1&&(r(0,"th",45),s(1,"Size"),o())}function Pa(i,t){if(i&1&&(r(0,"td",47),s(1),u(2,"formatBytes"),o()),i&2){let e,n=t.$implicit;l(),h(" ",(e=_(2,1,n.totalSize))!==null&&e!==void 0?e:"-"," ")}}function ka(i,t){i&1&&T(0,"th",52)}function Ia(i,t){if(i&1&&(r(0,"td",53),T(1,"app-file-transfer-icon",54),o()),i&2){let e=t.$implicit;l(),m("transfer",e)}}function Na(i,t){i&1&&(r(0,"th",45),s(1,"Transferred"),o())}function La(i,t){if(i&1&&(r(0,"td",47),s(1),u(2,"formatBytes"),o()),i&2){let e,n=t.$implicit;l(),h(" ",(e=_(2,1,n.sizeTransferred))!==null&&e!==void 0?e:"-"," ")}}function Ra(i,t){i&1&&(r(0,"th",45),s(1,"Transfer type"),o())}function $a(i,t){if(i&1&&(r(0,"td",47),s(1),o()),i&2){let e=t.$implicit;l(),R(e.transferType||"-")}}function Aa(i,t){i&1&&T(0,"th",55)}function Ba(i,t){if(i&1){let e=b();r(0,"ya-text-action",59),g("click",function(){v(e);let a=c(2).$implicit,p=c();return S(p.pauseTransfer(a))}),s(1," PAUSE "),o()}}function Va(i,t){if(i&1){let e=b();r(0,"ya-text-action",60),g("click",function(){v(e);let a=c(2).$implicit,p=c();return S(p.resumeTransfer(a))}),s(1," RESUME "),o()}}function ja(i,t){if(i&1&&d(0,Ba,2,0,"ya-text-action",57)(1,Va,2,0,"ya-text-action",58),i&2){let e=c().$implicit;f(e.state==="RUNNING"?0:-1),l(),f(e.state==="PAUSED"?1:-1)}}function Ua(i,t){if(i&1){let e=b();r(0,"ya-text-action",61),g("click",function(){v(e);let a=c().$implicit,p=c();return S(p.cancelTransfer(a))}),s(1," CANCEL "),o()}}function za(i,t){if(i&1&&(r(0,"td",47),d(1,ja,2,2)(2,Ua,2,0,"ya-text-action",56),o()),i&2){let e,n=t.$implicit,a=c();l(),f(!((e=a.service())==null||e.capabilities==null)&&e.capabilities.pauseResume?1:-1),l(),f(n.state!=="COMPLETED"&&n.state!=="FAILED"?2:-1)}}function Ya(i,t){if(i&1&&T(0,"ya-progress",63),i&2){let e=c().$implicit,n=c();m("value",n.transferPercent(e))("total",1)}}function Ha(i,t){if(i&1&&(r(0,"span",64),s(1),o()),i&2){let e=c().$implicit;l(),h(" ",e.failureReason," ")}}function Ga(i,t){if(i&1&&(r(0,"td",47),u(1,"async"),r(2,"div",62),d(3,Ya,1,2,"ya-progress",63),r(4,"span"),s(5),u(6,"formatBytes"),o(),d(7,Ha,2,1,"span",64),o()()),i&2){let e=t.$implicit,n=c();ae("colspan",_(1,4,n.displayedColumns$).length),l(3),f(e.state==="RUNNING"||e.state==="PAUSED"||e.state==="CANCELLING"?3:-1),l(2),R(_(6,6,e.sizeTransferred)),l(2),f(e.failureReason?7:-1)}}function Wa(i,t){i&1&&T(0,"tr",65)}function qa(i,t){if(i&1&&T(0,"tr",66),i&2){let e=t.$implicit;k("upload",e.direction==="UPLOAD")("nodetail",e.state==="COMPLETED")}}function Xa(i,t){if(i&1&&T(0,"tr",67),i&2){let e=t.$implicit;k("upload",e.direction==="UPLOAD")}}function Ka(i,t){i&1&&(r(0,"ya-empty-message",34)(1,"p"),s(2,"This instance has no file transfer services configured."),o()())}var xi="NO_LIMIT",ft=class i{constructor(t,e,n,a,p,w,A,B){this.yamcs=e;this.router=n;this.route=a;this.messageService=p;this.authService=w;this.dialog=A;this.services=j.required();this.requestedServiceName=j(null,{alias:"service"});this.requestedService=Le(()=>{let t=null,e=this.services();for(let n of e)if(this.requestedServiceName()===n.name){t=n;break}return!t&&!this.requestedServiceName()&&(t=e.length?e[0]:null),t});this.service=Me(null);this.localEntityOptions=Le(()=>{let t=[{id:"ANY",label:"Any local entity"}];for(let e of this.service()?.localEntities||[])t.push({id:String(e.id),label:e.name});return t});this.remoteEntityOptions=Le(()=>{let t=[{id:"ANY",label:"Any remote entity"}];for(let e of this.service()?.remoteEntities||[])t.push({id:String(e.id),label:e.name});return t});this.isIncomplete=(t,e)=>e.state!=="COMPLETED";this.filterForm=new Nt({interval:new Z(xi),customStart:new Z(null),customStop:new Z(null),direction:new Z("ANY"),state:new Z([]),localEntityId:new Z("ANY"),remoteEntityId:new Z("ANY")});this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.directionOptions=[{id:"ANY",label:"Any direction"},{id:"DOWNLOAD",label:"Download"},{id:"UPLOAD",label:"Upload"}];this.stateOptions=[{id:"QUEUED",label:"Queued"},{id:"RUNNING",label:"Running"},{id:"PAUSED",label:"Paused"},{id:"CANCELLING",label:"Cancelling"},{id:"FAILED",label:"Failed"},{id:"COMPLETED",label:"Completed"}];this.defaultColumns=["status","startTime","localEntity","localFile","direction","remoteEntity","remoteFile","size","actions"];this.displayedColumns$=new D([]);this.state=[];t.setTitle("File transfer");let oe=e.createStorageClient();this.dataSource=new dt(e,B,oe)}ngOnInit(){let t=this.requestedService();this.switchService(t)}switchService(t){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{service:t?.name||null},queryParamsHandling:"merge"}),this.dataSource.stopStreaming(),this.service.set(t),t&&this.dataSource.startStreaming(t);let e=[...this.defaultColumns];t?.capabilities?.hasTransferType&&e.splice(e.length-1,0,"transferType"),this.displayedColumns$.next(e),this.initializeOptions(),this.loadData(),this.filterForm.get("direction").valueChanges.forEach(n=>{this.direction=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("state").valueChanges.forEach(n=>{this.state=n,this.loadData()}),this.filterForm.get("localEntityId").valueChanges.forEach(n=>{this.localEntityId=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("remoteEntityId").valueChanges.forEach(n=>{this.remoteEntityId=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(n=>{if(n==="CUSTOM"){let a=this.validStart||this.yamcs.getMissionTime(),p=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(E.toISOString(a)),this.filterForm.get("customStop").setValue(E.toISOString(p))}else n==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=n,this.loadData()):(this.validStop=this.yamcs.getMissionTime(),this.validStart=E.subtractDuration(this.validStop,n),this.appliedInterval=n,this.loadData())})}initializeOptions(){let t=this.route.snapshot.queryParamMap;if(t.has("direction")&&(this.direction=t.get("direction"),this.filterForm.get("direction").setValue(this.direction)),t.has("state")&&(this.state=t.getAll("state"),this.filterForm.get("state").setValue(this.state)),t.has("localEntityId")&&(this.localEntityId=t.get("localEntityId"),this.filterForm.get("localEntityId").setValue(this.localEntityId)),t.has("remoteEntityId")&&(this.remoteEntityId=t.get("remoteEntityId"),this.filterForm.get("remoteEntityId").setValue(this.remoteEntityId)),t.has("interval"))if(this.appliedInterval=t.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=t.get("customStart");this.filterForm.get("customStart").setValue(e),this.validStart=E.toDate(e);let n=t.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=E.toDate(n)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=E.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=xi,this.validStop=null,this.validStart=null}mayControlFileTransfers(){return this.authService.getUser().hasSystemPrivilege("ControlFileTransfers")}showCreateTransferDialog(t){this.dialog.open(st,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{service:t}})}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=E.toDate(this.filterForm.value.customStart),this.validStop=E.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let t={};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString()),this.direction&&(t.direction=this.direction),this.localEntityId&&(t.localEntityId=this.localEntityId),this.remoteEntityId&&(t.remoteEntityId=this.remoteEntityId),this.state.length&&(t.state=this.state);let e=this.service();e&&this.dataSource.loadTransfers(e,t).catch(n=>this.messageService.showError(n))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{direction:this.direction||null,state:this.state.length?this.state:null,localEntityId:this.localEntityId||null,remoteEntityId:this.remoteEntityId||null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}transferPercent(t){return t.totalSize!=0?t.sizeTransferred/t.totalSize:0}pauseTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.pauseFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}resumeTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.resumeFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}cancelTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.cancelFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}static{this.\u0275fac=function(e){return new(e||i)(F(Re),F($),F(Ae),F($e),F(ge),F(si),F(jt),F(Kt))}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-list"]],inputs:{services:[1,"services"],requestedServiceName:[1,"service","requestedServiceName"]},decls:59,vars:21,consts:[["serviceMenu","matMenu"],[1,"table-wrapper"],[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["formControlName","direction",3,"options"],["formControlName","state","emptyOption","Any status",3,"options"],["formControlName","localEntityId",3,"options"],["formControlName","remoteEntityId",3,"options"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","startTime"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","white-space: nowrap",4,"matCellDef"],["matColumnDef","localEntity"],["mat-cell","",4,"matCellDef"],["matColumnDef","localFile"],["mat-cell","","class","file-column",4,"matCellDef"],["matColumnDef","direction"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","remoteEntity"],["matColumnDef","remoteFile"],["matColumnDef","size"],["matColumnDef","status"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","transferred"],["matColumnDef","transferType"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"upload","nodetail",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",3,"upload",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["headerTitle","File Transfer"],["dropdown","true",3,"matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[3,"icon"],[3,"clicked","icon"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell","",2,"white-space","nowrap"],["mat-cell",""],["mat-cell","",1,"file-column"],["download","",3,"href"],["mat-cell","",2,"text-align","center"],[1,"upload"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"transfer"],["mat-header-cell","",1,"expand"],["icon","not_interested"],["icon","pause_circle_outline"],["icon","play_circle_outline"],["icon","pause_circle_outline",3,"click"],["icon","play_circle_outline",3,"click"],["icon","not_interested",3,"click"],[1,"detail-layout"],["width","200px",3,"value","total"],[1,"error"],["mat-header-row",""],["mat-row","",1,"item-row"],["mat-row","",1,"item-detail"]],template:function(e,n){if(e&1&&(r(0,"app-instance-page")(1,"app-instance-toolbar"),s(2," File transfer\xA0\xA0\xA0\xA0 "),d(3,ca,6,2)(4,pa,1,1),o(),r(5,"div",1)(6,"div",2),T(7,"app-file-transfer-tabs"),r(8,"form",3)(9,"div",4),T(10,"ya-select",5)(11,"ya-multi-select",6)(12,"ya-select",7)(13,"ya-select",8)(14,"ya-select",9),d(15,da,4,1)(16,fa,2,0,"ya-button"),o()(),r(17,"table",10),x(18,11),d(19,ua,2,0,"th",12)(20,_a,3,3,"td",13),y(),x(21,14),d(22,ha,2,0,"th",12)(23,Ca,2,1,"td",15),y(),x(24,16),d(25,ga,2,0,"th",12)(26,xa,3,1,"td",17),y(),x(27,18),d(28,ya,2,0,"th",12)(29,Fa,3,2,"td",19),y(),x(30,20),d(31,wa,2,0,"th",12)(32,Da,2,1,"td",15),y(),x(33,21),d(34,Ea,2,0,"th",12)(35,Oa,2,1,"td",17),y(),x(36,22),d(37,Ma,2,0,"th",12)(38,Pa,3,3,"td",15),y(),x(39,23),d(40,ka,1,0,"th",24)(41,Ia,2,1,"td",25),y(),x(42,26),d(43,Na,2,0,"th",12)(44,La,3,3,"td",15),y(),x(45,27),d(46,Ra,2,0,"th",12)(47,$a,2,1,"td",15),y(),x(48,28),d(49,Aa,1,0,"th",29)(50,za,3,2,"td",15),y(),x(51,30),d(52,Ga,8,8,"td",15),y(),d(53,Wa,1,0,"tr",31),u(54,"async"),d(55,qa,1,4,"tr",32),u(56,"async"),d(57,Xa,1,2,"tr",33),o(),d(58,Ka,3,0,"ya-empty-message",34),o()()()),e&2){let a;l(3),f(n.services().length?3:-1),l(),f((a=n.service())?4:-1,a),l(4),m("formGroup",n.filterForm),l(2),m("options",n.directionOptions),l(),m("options",n.stateOptions),l(),m("options",n.localEntityOptions()),l(),m("options",n.remoteEntityOptions()),l(),m("options",n.intervalOptions),l(),f(n.filterForm.value.interval==="CUSTOM"?15:-1),l(),f(n.filterForm.value.interval!=="CUSTOM"?16:-1),l(),m("dataSource",n.dataSource),l(36),m("matHeaderRowDef",_(54,16,n.displayedColumns$)),l(2),m("matRowDefColumns",_(56,18,n.displayedColumns$)),l(2),m("matRowDefColumns",M(20,la))("matRowDefWhen",n.isIncomplete),l(),f(n.services().length?-1:58)}},dependencies:[ct,Se,tt,it,P,J,pe,ce,me,de,fe,z,Ue,ue,ze,Y,We,Xe,qe,Ge,Ke,ee,H,te,G,ve,Qe,ii,oi,ri,Ze,Je,ni,W,ne,li],styles:["tr.item-row[_ngcontent-%COMP%]:not(.nodetail)   td[_ngcontent-%COMP%]{border-bottom-width:0}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}.detail-layout[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-layout[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:20px}.error[_ngcontent-%COMP%]{color:var(--y-error-color)}.file-column[_ngcontent-%COMP%]{white-space:normal!important;min-width:250px!important;max-width:250px!important;overflow-wrap:break-word}tr.upload[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f7f7f7}"],changeDetection:0})}};var yi=(i,t)=>{let e=xt($);return e.yamcsClient.getFileTransferServices(e.instance).then(n=>n.services)};var Dl=[{path:"",canActivate:[mi,ci],canActivateChild:[pi],runGuardsAndResolvers:"always",component:di,children:[{path:"",pathMatch:"full",component:ft,resolve:{services:yi}},{path:"log",component:nt}]}];export{Dl as ROUTES};
